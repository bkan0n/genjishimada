# Enable OAuth2 authentication
auth_backends.1 = oauth2
auth_backends.2 = internal

# OAuth2 Configuration matching PocketID federated settings
auth_oauth2.resource_server_id = rabbitmq
auth_oauth2.issuer = https://portal.bkan0n.com

# JWKS endpoint for token verification
auth_oauth2.jwks_url = https://portal.bkan0n.com/.well-known/jwks.json

# Algorithm (PocketID uses RS256)
auth_oauth2.algorithms.1 = RS256

# Audience verification (matches what you set in PocketID)
auth_oauth2.verify_aud = true
auth_oauth2.audience = rabbitmq

# Username claim mapping
auth_oauth2.preferred_username_claims.1 = sub
auth_oauth2.preferred_username_claims.2 = email
auth_oauth2.preferred_username_claims.3 = preferred_username
auth_oauth2.preferred_username_claims.4 = client_id
auth_oauth2.preferred_username_claims.5 = azp

# Default permissions for authenticated tokens
auth_oauth2.default_permissions.configure = .*
auth_oauth2.default_permissions.read = .*
auth_oauth2.default_permissions.write = .*

# Token validation
auth_oauth2.token_validation.verify_iss = true
auth_oauth2.token_validation.verify_exp = true

# OAuth2 provider configuration for Web UI
management.oauth_enabled = true
management.oauth_client_id = ${OAUTH_CLIENT_ID}
management.oauth_client_secret = ${OAUTH_CLIENT_SECRET}
management.oauth_provider_url = https://portal.bkan0n.com

# OAuth endpoints (RabbitMQ will try to discover these, but explicit is better)
management.oauth_authorize_uri = https://portal.bkan0n.com/oauth2/authorize
management.oauth_token_uri = https://portal.bkan0n.com/oauth2/token

# Scopes to request during login
management.oauth_scopes = openid profile email

# Optional: Custom label for login button
management.oauth_provider_name = PocketID