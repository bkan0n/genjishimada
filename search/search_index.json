{"config":{"lang":["en"],"separator":"[\\s\\-,:!=\\[\\]()\"/]+|(?!\\b)(?=[A-Z][a-z])|\\.(?!\\d)|&[lg]t;","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Genji Shimada","text":"<p>Welcome to the official documentation for Genji Shimada, the Discord bot and REST API powering the Genji Parkour community.</p>"},{"location":"#what-is-genji-shimada","title":"What is Genji Shimada?","text":"<p>Genji Shimada is a comprehensive platform built with Python 3.13+ that provides:</p> <ul> <li>Discord Bot - Interactive Discord bot for community engagement, completions tracking, and notifications</li> <li>REST API - Litestar-based API for maps, completions, user profiles, and more</li> <li>Shared SDK - Type-safe msgspec data models shared across all services</li> </ul>"},{"location":"#quick-links","title":"Quick Links","text":"<ul> <li> <p> Getting Started</p> <p>Install dependencies and run the bot or API locally in minutes</p> <p> Get Started</p> </li> <li> <p> Bot Documentation</p> <p>Learn about the bot's architecture, extensions, and queue consumers</p> <p> Explore Bot</p> </li> <li> <p> API Reference</p> <p>Browse the OpenAPI specification and authentication guides</p> <p> API Docs</p> </li> <li> <p> SDK</p> <p>Understand the shared data models and types</p> <p> SDK Guide</p> </li> </ul>"},{"location":"#architecture-overview","title":"Architecture Overview","text":"<p>The project is structured as a monorepo with three main components:</p> <pre><code>genjishimada/\n\u251c\u2500\u2500 apps/\n\u2502   \u251c\u2500\u2500 api/          # Litestar REST API\n\u2502   \u2514\u2500\u2500 bot/          # Discord.py bot\n\u2514\u2500\u2500 libs/\n    \u2514\u2500\u2500 sdk/          # Shared msgspec models\n</code></pre>"},{"location":"#key-technologies","title":"Key Technologies","text":"<ul> <li>Python 3.13+ with uv for package management</li> <li>Litestar for the REST API</li> <li>Discord.py for the Discord bot</li> <li>PostgreSQL 17 for data persistence</li> <li>RabbitMQ for async message passing</li> <li>msgspec for fast, type-safe serialization</li> </ul>"},{"location":"#community","title":"Community","text":"<ul> <li>Discord Server: discord.gg/genji</li> <li>GitHub: bkan0n/genjishimada</li> <li>Production API: api.genji.pk</li> </ul>"},{"location":"#contributing","title":"Contributing","text":"<p>Contributions are welcome! Check out the Contributing Guide to get started.</p>"},{"location":"api/","title":"API Documentation","text":"<p>The Genji Shimada API is a Litestar-based REST API that powers the Genji Parkour platform. It provides endpoints for maps, completions, user profiles, authentication, and more.</p>"},{"location":"api/#overview","title":"Overview","text":"<p>The API is built with:</p> <ul> <li>Litestar - Modern, fast Python web framework</li> <li>AsyncPG - High-performance PostgreSQL driver</li> <li>msgspec - Fast JSON serialization</li> <li>RabbitMQ - Asynchronous message passing to the bot</li> </ul>"},{"location":"api/#base-urls","title":"Base URLs","text":"<p>The API is served under the <code>/api/v3</code> prefix.</p> <ul> <li>Production: <code>https://api.genji.pk/api/v3</code></li> <li>Development: <code>https://dev-api.genji.pk/api/v3</code></li> <li>Local: <code>http://localhost:8000/api/v3</code></li> </ul>"},{"location":"api/#quick-links","title":"Quick Links","text":"<ul> <li> <p> OpenAPI Reference</p> <p>Browse the complete API specification</p> <p> OpenAPI Spec</p> </li> <li> <p> Authentication</p> <p>Learn how API keys and scopes work</p> <p> Auth Guide</p> </li> <li> <p> External API Docs</p> <p>Interactive Swagger UI hosted on the API server</p> <p> api.genji.pk/docs</p> </li> </ul>"},{"location":"api/#key-features","title":"Key Features","text":""},{"location":"api/#restful-endpoints","title":"RESTful Endpoints","text":"<p>Example endpoints (all under <code>/api/v3</code>):</p> <ul> <li><code>GET /maps</code> - List and search maps</li> <li><code>POST /completions</code> - Submit a completion</li> <li><code>GET /users/{user_id}</code> - Get user profile</li> <li><code>PUT /users/{user_id}/settings</code> - Update user settings</li> </ul>"},{"location":"api/#authentication","title":"Authentication","text":"<p>All endpoints require an API key unless explicitly excluded. See the Authentication Guide.</p>"},{"location":"api/#message-queue-integration","title":"Message Queue Integration","text":"<p>The API publishes events to RabbitMQ for asynchronous processing by the bot:</p> <pre><code>API \u2192 RabbitMQ \u2192 Bot\n</code></pre> <p>Examples: - Completion submissions trigger Discord notifications - Map updates notify subscribers - User achievements are announced in channels</p>"},{"location":"api/#database-architecture","title":"Database Architecture","text":"<p>The API uses PostgreSQL 17 with multiple schemas:</p> <ul> <li><code>core.*</code> - Users, maps, permissions</li> <li><code>maps.*</code> - Map metadata and ratings</li> <li><code>completions.*</code> - User completion records</li> <li><code>users.*</code> - Profiles and XP</li> </ul> <p>Migrations are located in <code>apps/api/migrations/</code>.</p>"},{"location":"api/#development","title":"Development","text":""},{"location":"api/#running-locally","title":"Running Locally","text":"<pre><code>just run-api\n</code></pre> <p>The API starts at <code>http://localhost:8000</code> with hot reload enabled.</p>"},{"location":"api/#interactive-docs","title":"Interactive Docs","text":"<p>Visit <code>http://localhost:8000/docs</code> for the Swagger UI.</p>"},{"location":"api/#testing","title":"Testing","text":"<p>Run the test suite:</p> <pre><code>just test-api\n</code></pre> <p>Tests use pytest with parallel execution (8 workers).</p>"},{"location":"api/#architecture-highlights","title":"Architecture Highlights","text":""},{"location":"api/#dependency-injection-pattern","title":"Dependency Injection Pattern","text":"<p>Business logic is separated from HTTP routing:</p> <ul> <li><code>apps/api/di/*.py</code> - DI modules with business logic</li> <li><code>apps/api/routes/*.py</code> - Thin HTTP handlers</li> </ul> <p>Example flow:</p> <ol> <li>Route handler receives request</li> <li>Validates parameters</li> <li>Calls DI function with database connection</li> <li>DI function performs business logic</li> <li>Returns serialized response</li> </ol>"},{"location":"api/#idempotency","title":"Idempotency","text":"<p>Most message queue operations are idempotent, tracked via <code>message_id</code> headers and database claims.</p>"},{"location":"api/#error-handling","title":"Error Handling","text":"<p>Custom exceptions in <code>utilities/errors.py</code> provide structured error responses:</p> <pre><code>from utilities.errors import CustomHTTPException\n\nraise CustomHTTPException(\n    status_code=404,\n    detail=\"Map not found\",\n)\n</code></pre>"},{"location":"api/#next-steps","title":"Next Steps","text":"<ul> <li>OpenAPI Reference - Full API specification</li> <li>Authentication - API key usage and scopes</li> <li>Architecture - Code structure and patterns</li> <li>Local Development - Run the API locally</li> <li>Deployment - Running in production</li> </ul>"},{"location":"api/architecture/","title":"Architecture","text":"<p>This page explains how the API is organized and why certain patterns were chosen.</p>"},{"location":"api/architecture/#entry-point-appsapiapppy","title":"Entry point (<code>apps/api/app.py</code>)","text":"<p>The API is assembled in a single entry point:</p> <ul> <li>RabbitMQ connection pools are created during lifespan startup and stored in app state.</li> <li>PostgreSQL is configured with <code>litestar_asyncpg.AsyncpgPlugin</code> for pooled connections.</li> <li>OpenAPI metadata is configured and served at <code>/docs</code>.</li> <li>Routing mounts a router at <code>/api/v3</code> using <code>route_handlers</code> discovered from <code>apps/api/routes</code>.</li> <li>Health check is available at <code>/healthcheck</code>.</li> </ul>"},{"location":"api/architecture/#dynamic-route-loading-appsapiroutes__init__py","title":"Dynamic route loading (<code>apps/api/routes/__init__.py</code>)","text":"<p>Routes are discovered dynamically:</p> <ul> <li>Modules under <code>apps/api/routes/</code> are imported automatically.</li> <li>Any <code>litestar.Router</code> instance or <code>litestar.Controller</code> subclass is registered.</li> </ul> <p>This keeps the entry point small and makes it easy to add new route modules.</p>"},{"location":"api/architecture/#controllers-and-dependency-injection","title":"Controllers and dependency injection","text":"<p>Controllers focus on HTTP concerns. Domain logic lives in DI services under <code>apps/api/di/</code>.</p> <p>Typical flow:</p> <ol> <li>Controller method parses input and validates types.</li> <li>It calls a DI service (e.g., <code>MapService</code>, <code>CompletionService</code>).</li> <li>Services perform DB work and publish events.</li> <li>The controller returns SDK response models.</li> </ol>"},{"location":"api/architecture/#message-publishing","title":"Message publishing","text":"<p>Services inherit from <code>BaseService</code>, which provides:</p> <ul> <li>Access to the <code>asyncpg</code> connection</li> <li>A <code>publish_message</code> helper that inserts a job row and publishes to RabbitMQ</li> <li>Optional idempotency tracking for queue messages</li> </ul> <p>Queues follow the pattern: <code>api.&lt;domain&gt;.&lt;action&gt;</code>.</p>"},{"location":"api/architecture/#authentication-and-guards","title":"Authentication and guards","text":"<ul> <li><code>CustomAuthenticationMiddleware</code> requires <code>X-API-KEY</code> on requests.</li> <li><code>scope_guard</code> enforces route-level scopes via <code>opt={\"required_scopes\": {...}}</code>.</li> <li>Routes can opt out with <code>opt={\"exclude_from_auth\": True}</code>.</li> </ul>"},{"location":"api/architecture/#sdk-integration","title":"SDK integration","text":"<p>The API uses models from <code>libs/sdk</code> (<code>genjishimada_sdk</code>) for request and response types, keeping shared schemas consistent across API, bot, and clients.</p>"},{"location":"api/architecture/#next-steps","title":"Next Steps","text":"<ul> <li>Local Development - Run the API locally</li> <li>Authentication - API keys and scopes</li> </ul>"},{"location":"api/authentication/","title":"Authentication","text":"<p>The Genji Shimada API uses API keys for all authenticated requests. This is the only supported method for service-to-service communication.</p>"},{"location":"api/authentication/#api-keys","title":"API Keys","text":"<p>Use case: Bot, internal services, or trusted backend clients.</p> <p>API keys are stored in the <code>public.api_tokens</code> table and attached to an auth user record.</p>"},{"location":"api/authentication/#using-an-api-key","title":"Using an API Key","text":"<p>Include the key in the <code>X-API-KEY</code> header:</p> <pre><code>curl -H \"X-API-KEY: your_api_key\" \\\n  https://api.genji.pk/api/v3/maps\n</code></pre> <p>Example (Python):</p> <pre><code>import httpx\n\nheaders = {\"X-API-KEY\": \"your_api_key\"}\nresponse = httpx.get(\"https://api.genji.pk/api/v3/maps\", headers=headers)\n</code></pre>"},{"location":"api/authentication/#scopes","title":"Scopes","text":"<p>API keys may be scoped. The middleware attaches <code>scopes</code> and <code>is_superuser</code> to the request auth token.</p> <p>Common scope examples:</p> <ul> <li><code>read:maps</code></li> <li><code>write:maps</code></li> <li><code>read:users</code></li> <li><code>write:completions</code></li> <li><code>admin:*</code></li> </ul> <p>Routes can require scopes via <code>required_scopes</code>:</p> <pre><code>@get(\n    \"/admin/users\",\n    opt={\"required_scopes\": {\"admin:users\"}},\n)\nasync def list_all_users() -&gt; list[User]:\n    ...\n</code></pre>"},{"location":"api/authentication/#middleware","title":"Middleware","text":"<p>Authentication is enforced by <code>CustomAuthenticationMiddleware</code> in <code>apps/api/middleware/auth.py</code>.</p>"},{"location":"api/authentication/#excluding-routes-from-auth","title":"Excluding Routes from Auth","text":"<p>Routes can opt out of authentication with <code>exclude_from_auth</code>:</p> <pre><code>@get(\"/healthcheck\", opt={\"exclude_from_auth\": True})\nasync def health_check() -&gt; dict:\n    return {\"status\": \"ok\"}\n</code></pre>"},{"location":"api/authentication/#best-practices","title":"Best Practices","text":"<ul> <li>Use least-privilege keys for each service.</li> <li>Rotate keys periodically.</li> <li>Store keys in environment variables, never in code.</li> </ul>"},{"location":"api/authentication/#troubleshooting","title":"Troubleshooting","text":""},{"location":"api/authentication/#missing-api-key","title":"Missing API Key","text":"<p>Error: <code>401 Unauthorized - Missing API key</code></p> <p>Solution: Ensure <code>X-API-KEY</code> is present on the request.</p>"},{"location":"api/authentication/#invalid-api-key","title":"Invalid API Key","text":"<p>Error: <code>401 Unauthorized - Invalid API key</code></p> <p>Solution: Verify the key is correct and active.</p>"},{"location":"api/authentication/#insufficient-permissions","title":"Insufficient Permissions","text":"<p>Error: <code>403 Forbidden - Missing required scopes: ...</code></p> <p>Solution: Update the key's scopes or use a superuser token.</p>"},{"location":"api/authentication/#next-steps","title":"Next Steps","text":"<ul> <li>OpenAPI Reference - Review endpoint auth requirements</li> <li>External API Docs - Interactive Swagger UI</li> </ul>"},{"location":"api/deployment/","title":"Deployment","text":"<p>This project deploys the API with Docker Compose. The exact deployment workflow (CI/CD, SSH, etc.) depends on your environment.</p>"},{"location":"api/deployment/#production-compose","title":"Production compose","text":"<p>The production compose file defines these services:</p> <ul> <li><code>genjishimada-api</code></li> <li><code>genjishimada-bot</code></li> <li><code>genjishimada-db</code></li> <li><code>genjishimada-rabbitmq</code></li> </ul> <p>Start them with:</p> <pre><code>docker compose -f docker-compose.prod.yml up -d\n</code></pre>"},{"location":"api/deployment/#environment-variables","title":"Environment variables","text":"<p>Create a production <code>.env</code> with the values required by the API and bot:</p> <pre><code>APP_ENVIRONMENT=production\nPOSTGRES_USER=genjishimada\nPOSTGRES_PASSWORD=your_password\nPOSTGRES_DB=genjishimada\nRABBITMQ_USER=admin\nRABBITMQ_PASS=your_password\nRABBITMQ_HOST=genjishimada-rabbitmq\nAPI_KEY=your_api_key_for_bot\n</code></pre> <p>Add any optional values (Sentry, R2, Resend) as needed.</p>"},{"location":"api/deployment/#health-checks","title":"Health checks","text":"<p>The API service includes a health check at <code>/healthcheck</code>. Within Docker, this runs on <code>http://localhost:8000/healthcheck</code> inside the container. Expose it through your reverse proxy if you need external access.</p>"},{"location":"api/deployment/#logs","title":"Logs","text":"<pre><code>docker compose -f docker-compose.prod.yml logs -f genjishimada-api\n</code></pre>"},{"location":"api/deployment/#notes","title":"Notes","text":"<p>RabbitMQ and Postgres are attached to the external <code>genji-network</code>. Ensure that network exists in your environment.</p>"},{"location":"api/local-development/","title":"Local Development","text":"<p>How to run the API locally for development and testing.</p>"},{"location":"api/local-development/#prerequisites","title":"Prerequisites","text":"<ul> <li>Docker and Docker Compose</li> <li>Python 3.13+</li> <li><code>uv</code> and <code>just</code></li> </ul>"},{"location":"api/local-development/#environment-variables","title":"Environment variables","text":"<p>Create a <code>.env</code> file at the repo root with at least:</p> <pre><code>APP_ENVIRONMENT=development\nPOSTGRES_USER=genjishimada\nPOSTGRES_PASSWORD=your_password\nPOSTGRES_DB=genjishimada\nRABBITMQ_USER=admin\nRABBITMQ_PASS=your_password\nRABBITMQ_HOST=localhost\nAPI_KEY=your_api_key_for_bot\n</code></pre> <p>If you are running the API in Docker, set <code>RABBITMQ_HOST=genjishimada-rabbitmq-dev</code>.</p> <p>If you are running the API on the host, set <code>PSQL_DSN</code> so it points at the mapped Postgres port:</p> <pre><code>PSQL_DSN=postgresql://genjishimada:your_password@localhost:65432/genjishimada\n</code></pre> <p>Add any optional values you need (Sentry, R2, Resend).</p>"},{"location":"api/local-development/#start-infrastructure","title":"Start infrastructure","text":"<p>Start the database and RabbitMQ only:</p> <pre><code>docker compose -f docker-compose.dev.yml up -d \\\n  genjishimada-db-dev \\\n  genjishimada-rabbitmq-dev\n</code></pre>"},{"location":"api/local-development/#run-the-api-on-the-host","title":"Run the API on the host","text":"<pre><code>just run-api\n</code></pre> <p>The API starts at <code>http://localhost:8000</code>.</p>"},{"location":"api/local-development/#health-check","title":"Health check","text":"<pre><code>curl http://localhost:8000/healthcheck\n</code></pre>"},{"location":"api/local-development/#swagger-ui","title":"Swagger UI","text":"<p>Open <code>http://localhost:8000/docs</code>.</p>"},{"location":"api/local-development/#run-the-api-in-docker-optional","title":"Run the API in Docker (optional)","text":"<p>If you want Docker to run everything, use the compose service:</p> <pre><code>docker compose -f docker-compose.dev.yml up -d genjishimada-api-dev\n</code></pre> <p>This expects the same <code>.env</code> variables.</p>"},{"location":"api/local-development/#troubleshooting","title":"Troubleshooting","text":"<ul> <li>Database connection errors: confirm <code>genjishimada-db-dev</code> is healthy.</li> <li>RabbitMQ connection errors: confirm <code>genjishimada-rabbitmq-dev</code> is healthy.</li> </ul>"},{"location":"api/local-development/#next-steps","title":"Next Steps","text":"<ul> <li>OpenAPI Reference</li> <li>Authentication</li> </ul>"},{"location":"api/openapi/","title":"OpenAPI Reference","text":"<p>The complete OpenAPI specification for the Genji Shimada API.</p> <p>Generated Specification</p> <p>This page contains the authoritative OpenAPI spec, generated directly from the Litestar application.</p>"},{"location":"api/openapi/#interactive-documentation","title":"Interactive Documentation","text":"<p>For a more interactive experience with request/response testing, visit:</p> <ul> <li>Production: https://api.genji.pk/docs</li> <li>Development: https://dev-api.genji.pk/docs</li> </ul> <p>Download Spec</p> <p>You can download the raw OpenAPI spec in JSON format: openapi.json</p>"},{"location":"api/openapi/#generating-the-spec-locally","title":"Generating the Spec Locally","text":"<p>To regenerate the OpenAPI spec from the Litestar app:</p> <pre><code>uv run --project apps/api python scripts/generate_openapi.py\n</code></pre> <p>To build the documentation site afterward:</p> <pre><code>uv run --project docs mkdocs build\n</code></pre>"},{"location":"api/openapi/#using-the-spec","title":"Using the Spec","text":""},{"location":"api/openapi/#import-into-postman","title":"Import into Postman","text":"<ol> <li>Download openapi.json</li> <li>Open Postman</li> <li>Click Import \u2192 Upload Files</li> <li>Select the downloaded <code>openapi.json</code></li> </ol>"},{"location":"api/openapi/#generate-client-sdks","title":"Generate Client SDKs","text":"<p>Use tools like openapi-generator to generate client libraries:</p> <pre><code>openapi-generator-cli generate \\\n  -i docs/openapi.json \\\n  -g python \\\n  -o ./generated-client\n</code></pre>"},{"location":"api/openapi/#validate-requests","title":"Validate Requests","text":"<p>Use the spec to validate API requests in your tests or CI/CD pipeline.</p>"},{"location":"api/openapi/#specification-details","title":"Specification Details","text":"<p>The OpenAPI spec includes:</p> <ul> <li>All endpoints with request/response schemas</li> <li>Authentication requirements (API key and scopes)</li> <li>Error responses with status codes and messages</li> <li>Data models for all request and response bodies</li> </ul>"},{"location":"api/openapi/#schema-highlights","title":"Schema Highlights","text":""},{"location":"api/openapi/#authentication","title":"Authentication","text":"<p>The spec documents API key authentication via the <code>X-API-KEY</code> header.</p>"},{"location":"api/openapi/#endpoints","title":"Endpoints","text":"<p>Major endpoint groups:</p> <ul> <li><code>/maps</code> - Map CRUD and search</li> <li><code>/completions</code> - Completion submissions and tracking</li> <li><code>/users</code> - User profiles and settings</li> <li><code>/auth</code> - Email-based authentication endpoints</li> <li><code>/notifications</code> - Notification delivery</li> <li><code>/lootbox</code> - Lootbox system</li> </ul>"},{"location":"api/openapi/#models","title":"Models","text":"<p>All request/response bodies use msgspec Struct definitions from <code>libs/sdk</code>.</p>"},{"location":"api/openapi/#next-steps","title":"Next Steps","text":"<ul> <li>Authentication Guide - Learn how to authenticate API requests</li> <li>External API Docs - Try the API interactively</li> </ul>"},{"location":"bot/","title":"Bot Documentation","text":"<p>The Genji Shimada Discord bot is built with discord.py and provides interactive features for the Genji Parkour community.</p>"},{"location":"bot/#overview","title":"Overview","text":"<p>The bot handles:</p> <ul> <li>User commands - Interactive Discord slash commands</li> <li>Event processing - Async message queue consumers</li> <li>Notifications - Discord notifications for completions, maps, and achievements</li> <li>Integration - Seamless integration with the REST API</li> </ul>"},{"location":"bot/#quick-links","title":"Quick Links","text":"<ul> <li> <p> Architecture</p> <p>Learn how the bot is structured</p> <p> Core Bot</p> </li> <li> <p> Messaging</p> <p>Understand RabbitMQ queue consumers</p> <p> Messaging</p> </li> <li> <p> Configuration</p> <p>Configure the bot for your environment</p> <p> Configuration</p> </li> </ul>"},{"location":"bot/#key-features","title":"Key Features","text":""},{"location":"bot/#slash-commands","title":"Slash Commands","text":"<p>The bot uses Discord's slash commands for user interaction:</p> <pre><code>@app_commands.command(name=\"map\")\nasync def map_command(interaction: discord.Interaction, map_code: str):\n    \"\"\"Search for a map by code.\"\"\"\n    ...\n</code></pre>"},{"location":"bot/#queue-consumers","title":"Queue Consumers","text":"<p>The bot consumes events from RabbitMQ:</p> <pre><code>@queue_consumer(\"api.completion.submission\", struct_type=CompletionCreatedEvent)\nasync def handle_completion(event: CompletionCreatedEvent, message: AbstractIncomingMessage) -&gt; None:\n    # Send Discord notification\n    ...\n</code></pre>"},{"location":"bot/#api-integration","title":"API Integration","text":"<p>The bot calls the API through <code>APIService</code> attached to <code>bot.api</code>:</p> <pre><code>map_data = await bot.api.get_map(map_code)\n</code></pre>"},{"location":"bot/#bot-structure","title":"Bot Structure","text":"<pre><code>apps/bot/\n\u251c\u2500\u2500 core/\n\u2502   \u2514\u2500\u2500 genji.py           # Main bot class\n\u251c\u2500\u2500 extensions/            # Feature modules\n\u2502   \u251c\u2500\u2500 rabbit.py          # RabbitMQ service\n\u2502   \u251c\u2500\u2500 api_service.py     # API client\n\u2502   \u251c\u2500\u2500 completions.py     # Completion handlers\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 configs/               # Configuration files\n\u2502   \u251c\u2500\u2500 dev.toml\n\u2502   \u2514\u2500\u2500 prod.toml\n\u2514\u2500\u2500 main.py                # Entry point\n</code></pre>"},{"location":"bot/#running-the-bot","title":"Running the Bot","text":""},{"location":"bot/#development","title":"Development","text":"<pre><code>docker compose -f docker-compose.dev.yml up -d genjishimada-bot-dev\n</code></pre> <p>If you run the bot on the host with <code>just run-bot</code>, ensure the API hostname (<code>genjishimada-api-dev</code>) resolves locally.</p>"},{"location":"bot/#production","title":"Production","text":"<pre><code>docker compose -f docker-compose.prod.yml up -d genjishimada-bot\n</code></pre>"},{"location":"bot/#next-steps","title":"Next Steps","text":"<ul> <li>Core Bot Architecture - Understand the bot's structure</li> <li>Messaging System - Learn about queue consumers</li> <li>Services - Explore shared services</li> <li>Configuration - Configure the bot</li> </ul>"},{"location":"bot/architecture/core-bot/","title":"Core Bot Lifecycle","text":"<p>This page details how the main Discord process boots, wires shared services, and loads extensions.</p>"},{"location":"bot/architecture/core-bot/#entry-point","title":"Entry point","text":"<p>The bot starts in <code>apps/bot/main.py</code> inside the <code>main()</code> coroutine. The sequence is:</p> <ol> <li>Configure Sentry (when <code>SENTRY_DSN</code> is present) and set up filtered Discord logging via <code>setup_logging()</code>.</li> <li>Create an <code>aiohttp.ClientSession</code> and instantiate <code>core.Genji</code>, passing the configured prefix (<code>\"?\"</code> in production, <code>\"!\"</code> otherwise).</li> <li>Start the asynchronous context manager for the bot and call <code>bot.start(DISCORD_TOKEN)</code> to connect to the Discord gateway.</li> </ol> <p><code>core/genji.py</code> defines the <code>Genji</code> subclass of <code>commands.Bot</code>. During <code>__init__</code> the class:</p> <ul> <li>Applies the gateway intents defined at module level.</li> <li>Stores the shared HTTP session and constructs a <code>VideoThumbnailService</code> helper.</li> <li>Loads <code>configs/prod.toml</code> when <code>APP_ENVIRONMENT</code> is <code>\"production\"</code>, or <code>configs/dev.toml</code> for all other environments, using the <code>utilities.config.decode</code> helper.</li> </ul>"},{"location":"bot/architecture/core-bot/#extension-loading","title":"Extension loading","text":"<p><code>Genji.setup_hook</code> runs once the Discord connection is preparing. It loads every module under <code>extensions/</code> (discovered via <code>pkgutil</code> in <code>extensions.__init__.EXTENSIONS</code>) plus the debugging cog <code>jishaku</code>. After extensions are loaded, the method schedules <code>self.rabbit.start()</code> on the bot loop so that queue consumers begin once all handlers are registered.</p> <p>Each extension exposes an async <code>setup(bot)</code> function that attaches services or cogs to the bot. Notable patterns include:</p> <ul> <li><code>extensions.api_service.setup</code> instantiates <code>APIService</code> and assigns it to <code>bot.api</code> for use across other modules.</li> <li><code>extensions.newsfeed.setup</code>, <code>extensions.completions.setup</code>, <code>extensions.playtest.setup</code>, and <code>extensions.xp.setup</code> create service classes that are stored on the bot for later access.</li> <li><code>extensions.notifications.setup</code> attaches <code>NotificationService</code> to <code>bot.notifications</code>.</li> <li><code>extensions.rabbit.setup</code> prepares the <code>RabbitService</code>, which <code>setup_hook</code> starts after all handlers are registered.</li> </ul>"},{"location":"bot/architecture/core-bot/#service-lifecycle","title":"Service lifecycle","text":"<p>Service classes that inherit from <code>utilities.base.BaseService</code> (for example <code>CompletionsService</code>, <code>PlaytestService</code>, and <code>XPService</code>) lazily resolve the configured guild and their target channels. The base class spawns a task that waits for the bot to become ready, fetches <code>bot.config.guild</code>, and calls each service's <code>_resolve_channels()</code> hook before handling work.</p> <p>When adding a new feature module:</p> <ol> <li>Create an extension module under <code>extensions/</code> with an <code>async def setup(bot)</code> entry point.</li> <li>Attach any long-lived service to the bot (optionally inheriting from <code>BaseService</code>).</li> <li>Register queue handlers with <code>queue_consumer</code> if the feature processes RabbitMQ events (see Messaging &amp; Queues).</li> <li>Ensure the module is importable so that <code>extensions.__init__</code> discovers it automatically during startup.</li> </ol>"},{"location":"bot/architecture/core-bot/#file-locations","title":"File Locations","text":"<p>All bot code is located in <code>apps/bot/</code>:</p> <pre><code>apps/bot/\n\u251c\u2500\u2500 main.py               # Entry point\n\u251c\u2500\u2500 core/\n\u2502   \u2514\u2500\u2500 genji.py          # Main bot class\n\u251c\u2500\u2500 extensions/           # Feature modules\n\u2502   \u251c\u2500\u2500 __init__.py       # Extension discovery\n\u2502   \u251c\u2500\u2500 api_service.py    # API client\n\u2502   \u251c\u2500\u2500 rabbit.py         # RabbitMQ service\n\u2502   \u251c\u2500\u2500 newsfeed.py       # Newsfeed service\n\u2502   \u251c\u2500\u2500 completions.py    # Completions service\n\u2502   \u251c\u2500\u2500 playtest.py       # Playtest service\n\u2502   \u251c\u2500\u2500 notifications.py  # Notification service\n\u2502   \u2514\u2500\u2500 xp.py             # XP service\n\u251c\u2500\u2500 utilities/            # Shared utilities\n\u2502   \u251c\u2500\u2500 base.py           # BaseService\n\u2502   \u251c\u2500\u2500 config.py         # Config schema\n\u2502   \u2514\u2500\u2500 formatter.py      # Embed formatters\n\u2514\u2500\u2500 configs/              # TOML configuration\n    \u251c\u2500\u2500 dev.toml\n    \u2514\u2500\u2500 prod.toml\n</code></pre>"},{"location":"bot/architecture/core-bot/#next-steps","title":"Next Steps","text":"<ul> <li>Services &amp; Extensions - Understand the service architecture</li> <li>Messaging &amp; Queues - Learn about queue consumers</li> <li>Configuration - Configure the bot</li> </ul>"},{"location":"bot/architecture/messaging/","title":"Messaging &amp; Queues","text":"<p>The bot consumes RabbitMQ queues to react to events emitted by the Genji Parkour API. Queue handlers live alongside their feature modules and are registered through a shared decorator.</p>"},{"location":"bot/architecture/messaging/#rabbitmq-integration","title":"RabbitMQ integration","text":"<ul> <li><code>extensions/_queue_registry.py</code> provides <code>queue_consumer</code>, which wraps handlers with decoding, idempotency, and pytest short-circuit logic.</li> <li><code>extensions/rabbit.RabbitService</code> opens pooled connections to RabbitMQ, declares queues (and matching dead-letter queues), wraps handlers for error handling, and tracks startup drain state. The client is created during the <code>extensions.rabbit</code> setup hook and started from <code>Genji.setup_hook</code>.</li> <li>Services can call <code>await bot.rabbit.wait_until_drained()</code> when they need to delay work until any startup backlog has been processed (for example, before sending verification embeds or playtest updates).</li> </ul>"},{"location":"bot/architecture/messaging/#queue-handler-lifecycle","title":"Queue handler lifecycle","text":"<ol> <li>Decorate an async function or method with <code>@queue_consumer(\"queue-name\", struct_type=...)</code> inside the relevant extension module.</li> <li>Parse the message body with <code>msgspec</code> models before touching Discord state.</li> <li>Perform the required Discord or API calls. The wrapper created by <code>RabbitService</code> manages acknowledgements and ensures failures are logged before the message is dead-lettered.</li> </ol>"},{"location":"bot/architecture/messaging/#queue-naming-convention","title":"Queue naming convention","text":"<p>Queues follow the pattern: <code>api.&lt;domain&gt;.&lt;action&gt;</code></p> <p>Examples: - <code>api.newsfeed.create</code> - <code>api.completion.submission</code> - <code>api.playtest.create</code></p>"},{"location":"bot/architecture/messaging/#queue-catalog","title":"Queue catalog","text":"Queue Handler Notes <code>api.newsfeed.create</code> <code>NewsfeedService._process_newsfeed_create</code> Fetches the new event and posts it to the configured newsfeed channel. <code>api.notification.delivery</code> <code>NotificationService._process_notification_delivery</code> Sends DMs or channel notifications based on user settings. <code>api.completion.autoverification.failed</code> <code>CompletionsService._process_autoverification_failed</code> Handles failed autoverification results. <code>api.completion.upvote</code> <code>CompletionsService._process_update_upvote_message</code> Forwards completion submissions into the upvote channel. <code>api.completion.submission</code> <code>CompletionsService._process_create_submission_message</code> Builds the verification queue embed for a new completion submission. <code>api.completion.verification</code> <code>CompletionsService._process_verification_status_change</code> Updates verification state and notifies users. <code>api.playtest.create</code> <code>PlaytestService._process_create_playtest_message</code> Creates playtest threads and posts the intake embed. <code>api.playtest.vote.cast</code> <code>PlaytestService._process_vote_cast_message</code> Records a new playtest vote and grants XP. <code>api.playtest.vote.remove</code> <code>PlaytestService._process_vote_remove_message</code> Handles vote removal events. <code>api.playtest.approve</code> <code>PlaytestService._process_playtest_approve_message</code> Posts approval summaries and cleans up playtest state. <code>api.playtest.force_accept</code> <code>PlaytestService._process_playtest_force_accept_message</code> Mirrors force-accept commands issued upstream. <code>api.playtest.force_deny</code> <code>PlaytestService._process_playtest_force_deny_message</code> Mirrors force-deny commands issued upstream. <code>api.playtest.reset</code> <code>PlaytestService._process_playtest_reset_message</code> Resets playtest runs and refreshes Discord embeds. <code>api.xp.grant</code> <code>XPService._process_grant_message</code> Applies XP rewards announced by the API. <code>api.map_edit.created</code> <code>MapEditorService._process_edit_created</code> Creates a verification view for new map edit requests. <code>api.map_edit.resolved</code> <code>MapEditorService._process_edit_resolved</code> Cleans up the verification queue message once resolved. <p>Keep this table current as new queues are introduced so on-call maintainers can trace message flow quickly.</p>"},{"location":"bot/architecture/messaging/#idempotency","title":"Idempotency","text":"<p>Most queues enforce idempotency using <code>message_id</code> headers:</p> <p>API side (publishing): <pre><code>await self.publish_message(\n    queue_name=\"api.completion.submission\",\n    message=event,\n    message_id=f\"completion-{completion_id}\",  # Unique ID\n)\n</code></pre></p> <p>Bot side (consuming): <pre><code>@queue_consumer(\"api.completion.submission\", struct_type=CompletionCreatedEvent, idempotent=True)\nasync def handle_completion(self, event: CompletionCreatedEvent, message: AbstractIncomingMessage) -&gt; None:\n    # Handler only runs once per message_id\n    ...\n</code></pre></p> <p>Claims are tracked in the database to prevent duplicate processing.</p>"},{"location":"bot/architecture/messaging/#pytest-short-circuit","title":"Pytest short-circuit","text":"<p>Queue consumers skip processing when a message header includes <code>x-pytest-enabled: 1</code>. This is used in integration tests to avoid side effects.</p>"},{"location":"bot/architecture/messaging/#dead-letter-queue-dlq","title":"Dead Letter Queue (DLQ)","text":"<p>Failed messages are moved to a dead letter queue (e.g., <code>api.completion.submission.dlq</code>) after exhausting retries.</p> <p>DLQ Processor (runs every 60 seconds): 1. Checks DLQ for messages 2. Posts alert to Discord with message details 3. Marks message with <code>dlq_notified</code> header 4. Prevents duplicate alerts</p>"},{"location":"bot/architecture/messaging/#next-steps","title":"Next Steps","text":"<ul> <li>Core Bot Lifecycle - Understand how the bot starts</li> <li>Services &amp; Extensions - Learn about service architecture</li> <li>SDK Documentation - See the msgspec event models</li> </ul>"},{"location":"bot/architecture/services/","title":"Services &amp; Extensions","text":"<p>Services encapsulate long-lived Discord behaviour, while extensions expose the asynchronous <code>setup</code> hook that registers those services and any associated cogs.</p>"},{"location":"bot/architecture/services/#service-catalog","title":"Service catalog","text":"Service Module / Class Responsibilities API client <code>extensions/api_service.py</code> \u2192 <code>APIService</code> Maintains an authenticated <code>aiohttp</code> session to the API and exposes helpers for maps, completions, playtests, and notifications. Stored on <code>bot.api</code>. RabbitMQ <code>extensions/rabbit.py</code> \u2192 <code>RabbitService</code> Connects to RabbitMQ using pooled channels, declares queues (and DLQs), wraps handlers registered through <code>queue_consumer</code>, and exposes helpers such as <code>publish</code> and <code>wait_until_drained</code>. Stored on <code>bot.rabbit</code>. Notifications <code>extensions/notifications.py</code> \u2192 <code>NotificationService</code> Determines whether a user has opted into specific notification bitmasks and sends DMs or channel pings accordingly. Stored on <code>bot.notifications</code>. Newsfeed <code>extensions/newsfeed.py</code> \u2192 <code>NewsfeedService</code> Registers builders for each newsfeed payload type, publishes events into the configured channel, and consumes <code>api.newsfeed.create</code> messages. Stored on <code>bot.newsfeed</code>. Completions <code>extensions/completions.py</code> \u2192 <code>CompletionsService</code> Resolves verification channels, renders verification views, emits follow-up newsfeed events, and handles completion-related queues. Stored on <code>bot.completions</code>. Playtest <code>extensions/playtest.py</code> \u2192 <code>PlaytestService</code> Manages playtest threads, queue-driven state changes, and XP grants tied to votes. Stored on <code>bot.playtest</code>. XP <code>extensions/xp.py</code> \u2192 <code>XPService</code> Resolves XP channels, applies XP grants from the <code>api.xp.grant</code> queue, and exposes helpers for other services to award XP. Stored on <code>bot.xp</code>. Map edits <code>extensions/moderator.py</code> \u2192 <code>MapEditorService</code> Manages map edit verification views and listens to map edit queues. Stored on <code>bot.map_editor</code>. Thumbnails <code>extensions/video_thumbnail.py</code> \u2192 <code>VideoThumbnailService</code> Generates video thumbnails for embeds and newsfeed entries. Stored on <code>bot.thumbnail_service</code>. <p>Extend this table as new extensions ship so there is a single map of the long-lived services attached to the bot instance.</p>"},{"location":"bot/architecture/services/#extension-anatomy","title":"Extension anatomy","text":"<ol> <li>Setup hook: Each extension defines <code>async def setup(bot)</code> and attaches services, cogs, or background tasks.</li> <li>Shared state: Services either use property setters on <code>Genji</code> (for example <code>bot.api</code>) or inherit from <code>utilities.base.BaseService</code> to gain guild/channel resolution helpers.</li> <li>Queue registration: Background work is tied to RabbitMQ queues by decorating handler coroutines with <code>@queue_consumer(\"queue-name\")</code>.</li> <li>Cross-extension collaboration: Services call into one another via the properties on <code>bot</code>. For example, the completions flow calls <code>bot.api</code> to fetch payloads, uses <code>bot.notifications</code> to determine DM preferences, and leverages <code>bot.xp</code> to grant XP during verification updates.</li> </ol>"},{"location":"bot/architecture/services/#baseservice","title":"BaseService","text":"<p>The <code>utilities.base.BaseService</code> class provides common functionality for services:</p> <pre><code>from utilities.base import BaseService\n\nclass MyService(BaseService):\n    async def _resolve_channels(self) -&gt; None:\n        \"\"\"Called after bot is ready and guild is resolved.\"\"\"\n        self.my_channel = await self.guild.fetch_channel(channel_id)\n\n    async def do_work(self) -&gt; None:\n        \"\"\"Service methods can access self.guild and resolved channels.\"\"\"\n        await self.my_channel.send(\"Hello!\")\n</code></pre> <p>Features: - Automatic guild resolution - Channel resolution hook - Access to bot instance</p>"},{"location":"bot/architecture/services/#creating-a-new-extension","title":"Creating a New Extension","text":"<p>To add a new feature to the bot:</p> <ol> <li> <p>Create the extension file:    <pre><code>apps/bot/extensions/my_feature.py\n</code></pre></p> </li> <li> <p>Define the setup function:    <pre><code>async def setup(bot):\n    service = MyService(bot)\n    bot.my_service = service\n</code></pre></p> </li> <li> <p>Optionally create a service:    <pre><code>from utilities.base import BaseService\n\nclass MyService(BaseService):\n    async def _resolve_channels(self) -&gt; None:\n        # Resolve channels here\n        pass\n</code></pre></p> </li> <li> <p>Register queue handlers (if needed):    <pre><code>from extensions._queue_registry import queue_consumer\n\n@queue_consumer(\"api.my_feature.event\", struct_type=MyEvent)\nasync def handle_event(self, event: MyEvent, message: AbstractIncomingMessage):\n    # Process the event\n    pass\n</code></pre></p> </li> <li> <p>Import in <code>extensions/__init__.py</code>:    <pre><code>EXTENSIONS = [\n    # ...\n    \"extensions.my_feature\",\n]\n</code></pre></p> </li> </ol> <p>Document queues, commands, and presentation helpers in the relevant sections when adding new functionality so future contributors can follow the established patterns.</p>"},{"location":"bot/architecture/services/#next-steps","title":"Next Steps","text":"<ul> <li>Core Bot Lifecycle - Understand bot startup</li> <li>Messaging &amp; Queues - Learn about queue handlers</li> <li>Newsfeed &amp; Embeds - UI guidelines</li> <li>Configuration - Configure the bot</li> </ul>"},{"location":"bot/operations/configuration/","title":"Configuration &amp; Deployment","text":"<p>Use this page to wire environment variables, TOML configuration, and deployment workflows for the Genji Shimada bot.</p>"},{"location":"bot/operations/configuration/#environment-configuration","title":"Environment configuration","text":"<p>Runtime settings come from a combination of environment variables and a TOML file loaded at startup.</p>"},{"location":"bot/operations/configuration/#core-variables","title":"Core variables","text":"<p>Required environment variables in <code>.env</code>:</p> <ul> <li><code>DISCORD_TOKEN</code> \u2013 Required by <code>bot.start()</code>. Obtain from Discord Developer Portal.</li> <li><code>APP_ENVIRONMENT</code> \u2013 Controls the command prefix and which TOML file is loaded:</li> <li><code>\"production\"</code> \u2192 loads <code>configs/prod.toml</code>, uses <code>\"?\"</code> prefix</li> <li>Any other value \u2192 loads <code>configs/dev.toml</code>, uses <code>\"!\"</code> prefix</li> <li><code>API_KEY</code> \u2013 Forwarded to the <code>APIService</code> for authenticated requests to the API.</li> <li>API hostnames are derived from <code>APP_ENVIRONMENT</code> (<code>genjishimada-api-dev</code> for development, <code>genjishimada-api</code> for production).</li> </ul>"},{"location":"bot/operations/configuration/#rabbitmq-variables","title":"RabbitMQ variables","text":"<p>Required for message queue integration:</p> <ul> <li><code>RABBITMQ_USER</code> \u2013 RabbitMQ username</li> <li><code>RABBITMQ_PASS</code> \u2013 RabbitMQ password</li> <li><code>RABBITMQ_HOST</code> \u2013 RabbitMQ host (e.g., <code>localhost</code> or <code>genjishimada-rabbitmq</code> in Docker)</li> </ul>"},{"location":"bot/operations/configuration/#optional-observability-variables","title":"Optional observability variables","text":"<p>For error tracking and monitoring:</p> <ul> <li><code>SENTRY_DSN</code> \u2013 Sentry DSN for error tracking</li> <li><code>SENTRY_AUTH_TOKEN</code> \u2013 Sentry auth token (optional)</li> <li><code>SENTRY_FEEDBACK_URL</code> \u2013 Custom feedback URL (optional)</li> </ul>"},{"location":"bot/operations/configuration/#toml-configuration","title":"TOML configuration","text":"<p>The TOML schema is defined in <code>utilities/config.py</code> and covers guild, role, and channel identifiers.</p>"},{"location":"bot/operations/configuration/#development-configuration","title":"Development configuration","text":"<p>Edit <code>apps/bot/configs/dev.toml</code> for development IDs:</p> <pre><code>[guild]\nid = 1234567890  # Your development Discord server ID\n\n[channels]\nnewsfeed = 1234567890\ncompletions_verification = 1234567890\ncompletions_upvote = 1234567890\nplaytest = 1234567890\nxp = 1234567890\nlogs = 1234567890\n\n[roles]\nadmin = 1234567890\nmoderator = 1234567890\nverified = 1234567890\n</code></pre>"},{"location":"bot/operations/configuration/#production-configuration","title":"Production configuration","text":"<p>Edit <code>apps/bot/configs/prod.toml</code> for production IDs:</p> <pre><code>[guild]\nid = 9876543210  # Production Discord server ID\n\n[channels]\nnewsfeed = 9876543210\ncompletions_verification = 9876543210\ncompletions_upvote = 9876543210\nplaytest = 9876543210\nxp = 9876543210\nlogs = 9876543210\n\n[roles]\nadmin = 9876543210\nmoderator = 9876543210\nverified = 9876543210\n</code></pre> <p>The <code>Genji</code> constructor reads the appropriate file on startup based on <code>APP_ENVIRONMENT</code>.</p>"},{"location":"bot/operations/configuration/#local-development-workflow","title":"Local development workflow","text":"<ol> <li> <p>Install dependencies:    <pre><code>just setup\n</code></pre></p> </li> <li> <p>Configure environment: create a <code>.env</code> file and add your variables.</p> </li> <li> <p>Edit development config:    <pre><code># Edit apps/bot/configs/dev.toml with your Discord IDs\n</code></pre></p> </li> <li> <p>Start infrastructure:    <pre><code>docker compose -f docker-compose.dev.yml up -d \\\n  genjishimada-db-dev \\\n  genjishimada-rabbitmq-dev\n</code></pre></p> </li> <li> <p>Run the bot:    <pre><code>docker compose -f docker-compose.dev.yml up -d genjishimada-bot-dev\n</code></pre></p> </li> </ol> <p>If you run the bot on the host with <code>just run-bot</code>, ensure the API hostname (<code>genjishimada-api-dev</code>) resolves locally.</p> <ol> <li>Lint before committing:    <pre><code>just lint-bot\n</code></pre></li> </ol>"},{"location":"bot/operations/configuration/#docker-deployment","title":"Docker deployment","text":""},{"location":"bot/operations/configuration/#development","title":"Development","text":"<p>If you run the bot inside Docker:</p> <pre><code>docker compose -f docker-compose.dev.yml up -d genjishimada-bot-dev\n</code></pre>"},{"location":"bot/operations/configuration/#production","title":"Production","text":"<p>Use the production compose file:</p> <pre><code>docker compose -f docker-compose.prod.yml up -d genjishimada-bot\n</code></pre>"},{"location":"bot/operations/configuration/#deployment-checklist","title":"Deployment checklist","text":"<p>Before deploying to production:</p> <ul> <li> Update <code>configs/prod.toml</code> with production Discord IDs</li> <li> Set all required environment variables in production <code>.env</code></li> <li> Ensure RabbitMQ and the Genji API are reachable</li> <li> Build and deploy the container image (or restart the process)</li> <li> Monitor Discord logs and Sentry events after rollout</li> <li> Verify bot appears online in Discord</li> <li> Test key commands and queue consumers</li> </ul>"},{"location":"bot/operations/configuration/#observability","title":"Observability","text":""},{"location":"bot/operations/configuration/#logging","title":"Logging","text":"<p><code>setup_logging()</code> in <code>main.py</code> configures log levels and filters:</p> <ul> <li>Filters noisy Discord messages</li> <li>Enables DEBUG logs for internal packages when <code>APP_ENVIRONMENT</code> is <code>\"development\"</code></li> <li>Logs to console by default</li> </ul> <p>View logs:</p> <pre><code># Local development\njust run-bot\n\n# Docker\ndocker compose -f docker-compose.prod.yml logs -f genjishimada-bot\n</code></pre>"},{"location":"bot/operations/configuration/#sentry","title":"Sentry","text":"<p><code>main()</code> initializes Sentry with trace and profile sampling when <code>SENTRY_DSN</code> is set:</p> <pre><code>import sentry_sdk\nfrom sentry_sdk.integrations.asyncio import AsyncioIntegration\n\nsentry_sdk.init(\n    dsn=SENTRY_DSN,\n    environment=APP_ENVIRONMENT,\n    integrations=[AsyncioIntegration()],\n)\n</code></pre> <p>Benefits: - Automatic exception capture - Performance traces - User context (Discord user info)</p> <p>View errors at sentry.io.</p>"},{"location":"bot/operations/configuration/#troubleshooting","title":"Troubleshooting","text":""},{"location":"bot/operations/configuration/#bot-wont-start","title":"Bot Won't Start","text":"<p>Check Discord token: <pre><code># Verify DISCORD_TOKEN is set\necho $DISCORD_TOKEN\n</code></pre></p> <p>Check permissions: - Ensure bot has required intents enabled in Discord Developer Portal - Verify bot is invited to the server with correct permissions</p> <p>Check logs: <pre><code>docker compose -f docker-compose.prod.yml logs genjishimada-bot\n</code></pre></p>"},{"location":"bot/operations/configuration/#queue-messages-not-processing","title":"Queue Messages Not Processing","text":"<p>Verify RabbitMQ connection: <pre><code># Check RabbitMQ is running\ndocker compose -f docker-compose.dev.yml ps genjishimada-rabbitmq-dev\n\n# Check bot logs for connection errors\ndocker compose -f docker-compose.prod.yml logs genjishimada-bot | grep -i rabbitmq\n</code></pre></p> <p>Check queue consumers: - Inspect bot logs for queue bindings and errors</p>"},{"location":"bot/operations/configuration/#api-requests-failing","title":"API Requests Failing","text":"<p>Verify API key: <pre><code># Check API_KEY is set\necho $API_KEY\n</code></pre></p> <p>Check API availability: <pre><code>curl -H \"X-API-KEY: $API_KEY\" http://localhost:8000/healthcheck\n</code></pre></p> <p>Check bot logs: <pre><code>docker compose -f docker-compose.prod.yml logs genjishimada-bot | grep -i api\n</code></pre></p>"},{"location":"bot/operations/configuration/#next-steps","title":"Next Steps","text":"<ul> <li>Core Bot Lifecycle - Understand bot startup</li> <li>Services &amp; Extensions - Learn about services</li> <li>Operations Guide - Infrastructure overview</li> <li>Docker Compose - Deployment guide</li> </ul>"},{"location":"bot/ux/newsfeed-and-embeds/","title":"Formattables &amp; Pretty Printing","text":"<p>This section covers how to format model data into readable, consistent strings for embeds and messages.</p>"},{"location":"bot/ux/newsfeed-and-embeds/#formattable-models","title":"Formattable models","text":"<p>A formattable model implements <code>to_format_dict()</code> and returns a mapping of display labels to string values. The formatter uses this mapping to build a nicely aligned, readable block for Discord.</p> <p>The interface lives in <code>apps/bot/utilities/formatter.py</code>:</p> <pre><code>class FormattableProtocol(Protocol):\n    def to_format_dict(self) -&gt; dict[str, str | None]:\n        ...\n</code></pre>"},{"location":"bot/ux/newsfeed-and-embeds/#formatter-classes","title":"Formatter classes","text":"<p>Two formatters are available in <code>apps/bot/utilities/formatter.py</code>:</p> <ul> <li><code>Formatter</code> - draws a tree-like list with <code>\u2523</code>/<code>\u2517</code> prefix characters.</li> <li><code>FilteredFormatter</code> - renders blockquote-style lines and lets you exclude fields.</li> </ul> <p>Both drop keys whose values are <code>None</code>, <code>False</code>, or empty strings.</p>"},{"location":"bot/ux/newsfeed-and-embeds/#example-format-a-completion-payload","title":"Example: format a completion payload","text":"<p><code>CompletionSubmissionModel</code> implements <code>to_format_dict()</code> in <code>apps/bot/utilities/completions.py</code>.</p> <pre><code>from utilities.completions import CompletionSubmissionModel\nfrom utilities.formatter import Formatter\n\nmodel = CompletionSubmissionModel(**payload)\nformatted = Formatter(model).format()\n\n# Use in an embed description or message body\nembed.description = formatted\n</code></pre>"},{"location":"bot/ux/newsfeed-and-embeds/#example-filter-fields","title":"Example: filter fields","text":"<p>Use <code>FilteredFormatter</code> when you want a smaller summary:</p> <pre><code>from utilities.maps import MapModel\nfrom utilities.formatter import FilteredFormatter\n\nmodel = MapModel(**payload)\nformatted = FilteredFormatter(\n    model,\n    filter_fields={\"Mechanics\", \"Restrictions\"},\n).format()\n</code></pre>"},{"location":"bot/ux/newsfeed-and-embeds/#implementing-a-new-formattable","title":"Implementing a new formattable","text":"<p>Wrap SDK models or view models in a small class that implements <code>to_format_dict()</code>.</p> <pre><code>class MyFormattable:\n    def __init__(self, name: str, score: int) -&gt; None:\n        self.name = name\n        self.score = score\n\n    def to_format_dict(self) -&gt; dict[str, str | None]:\n        return {\n            \"Name\": self.name,\n            \"Score\": str(self.score),\n        }\n</code></pre>"},{"location":"bot/ux/newsfeed-and-embeds/#tips","title":"Tips","text":"<ul> <li>Keep keys short and consistent (<code>Code</code>, <code>Map</code>, <code>Time</code>).</li> <li>Return <code>\"\"</code> for optional fields you want hidden.</li> <li>Use inline Markdown sparingly (e.g., <code>\"[Link](...)\"</code>).</li> </ul>"},{"location":"bot/ux/newsfeed-and-embeds/#next-steps","title":"Next Steps","text":"<ul> <li>Services &amp; Extensions - Understand service architecture</li> <li>Messaging &amp; Queues - Learn about queue events</li> <li>SDK Documentation - See payload models</li> </ul>"},{"location":"contributing/","title":"Contributing","text":"<p>Thank you for your interest in contributing to Genji Shimada! This guide will help you get started.</p>"},{"location":"contributing/#quick-start","title":"Quick Start","text":"<ol> <li>Fork and clone the repository</li> <li>Install dependencies: <code>just setup</code></li> <li>Create a branch for your changes</li> <li>Make your changes and test them</li> <li>Submit a pull request</li> </ol>"},{"location":"contributing/#code-of-conduct","title":"Code of Conduct","text":"<p>Be respectful, constructive, and welcoming to all contributors. We're building this together.</p>"},{"location":"contributing/#getting-started","title":"Getting Started","text":""},{"location":"contributing/#prerequisites","title":"Prerequisites","text":"<p>Ensure you have the required tools installed:</p> <ul> <li>Python 3.13+</li> <li>uv (package manager)</li> <li>Docker (for databases)</li> <li>just (task runner)</li> </ul> <p>See the Installation Guide for setup instructions.</p>"},{"location":"contributing/#development-workflow","title":"Development Workflow","text":"<ol> <li> <p>Create a feature branch:    <pre><code>git checkout -b feature/your-feature-name\n</code></pre></p> </li> <li> <p>Make changes to the codebase</p> </li> <li> <p>Run linters:    <pre><code>just lint-all\n</code></pre></p> </li> <li> <p>Run tests:    <pre><code>just test-all\n</code></pre></p> </li> <li> <p>Commit your changes:    <pre><code>git add .\ngit commit -m \"Add feature: your feature description\"\n</code></pre></p> </li> <li> <p>Push to your fork:    <pre><code>git push origin feature/your-feature-name\n</code></pre></p> </li> <li> <p>Open a pull request on GitHub</p> </li> </ol>"},{"location":"contributing/#project-structure","title":"Project Structure","text":"<pre><code>genjishimada/\n\u251c\u2500\u2500 apps/\n\u2502   \u251c\u2500\u2500 api/          # Litestar REST API\n\u2502   \u2502   \u251c\u2500\u2500 di/       # Business logic (DI modules)\n\u2502   \u2502   \u251c\u2500\u2500 routes/   # HTTP route handlers\n\u2502   \u2502   \u251c\u2500\u2500 middleware/ # Auth and request processing\n\u2502   \u2502   \u2514\u2500\u2500 tests/    # API tests\n\u2502   \u2514\u2500\u2500 bot/          # Discord bot\n\u2502       \u251c\u2500\u2500 core/     # Bot core (Genji class)\n\u2502       \u251c\u2500\u2500 extensions/ # Feature modules (cogs)\n\u2502       \u2514\u2500\u2500 docs/     # Bot-specific docs (legacy)\n\u251c\u2500\u2500 libs/\n\u2502   \u2514\u2500\u2500 sdk/          # Shared msgspec models\n\u2502       \u2514\u2500\u2500 src/genjishimada_sdk/\n\u251c\u2500\u2500 docs/             # Documentation (MkDocs)\n\u251c\u2500\u2500 infra/            # Infrastructure configs\n\u2514\u2500\u2500 ops/              # Operations scripts\n</code></pre>"},{"location":"contributing/#coding-standards","title":"Coding Standards","text":""},{"location":"contributing/#python-style","title":"Python Style","text":"<p>We use Ruff for formatting and linting, and BasedPyright for type checking.</p> <p>Key rules: - Line length: 120 characters - Docstring style: Google - Type hints required for all function signatures - Import sorting enabled</p> <p>Run linters: <pre><code>just lint-all\n</code></pre></p>"},{"location":"contributing/#type-annotations","title":"Type Annotations","text":"<p>All functions must have type annotations:</p> <pre><code># Good\nasync def get_map(map_id: int) -&gt; MapResponse:\n    ...\n\n# Bad\nasync def get_map(map_id):\n    ...\n</code></pre>"},{"location":"contributing/#docstrings","title":"Docstrings","text":"<p>Use Google-style docstrings:</p> <pre><code>def process_completion(completion_id: int, user_id: int) -&gt; bool:\n    \"\"\"Process a user's completion submission.\n\n    Args:\n        completion_id: The unique ID of the completion.\n        user_id: The ID of the user who submitted the completion.\n\n    Returns:\n        True if processing succeeded, False otherwise.\n\n    Raises:\n        ValueError: If the completion_id is invalid.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"contributing/#error-handling","title":"Error Handling","text":"<p>Use custom exceptions from <code>utilities/errors.py</code>:</p> <pre><code>from utilities.errors import CustomHTTPException\n\nif not map_exists:\n    raise CustomHTTPException(\n        status_code=404,\n        detail=\"Map not found\"\n    )\n</code></pre>"},{"location":"contributing/#testing","title":"Testing","text":""},{"location":"contributing/#writing-tests","title":"Writing Tests","text":"<p>Tests are located in <code>apps/api/tests/</code>.</p> <p>Example:</p> <pre><code>import pytest\nfrom httpx import AsyncClient\n\n@pytest.mark.asyncio\nasync def test_get_map(client: AsyncClient):\n    response = await client.get(\"/maps/1\")\n    assert response.status_code == 200\n    assert response.json()[\"name\"] == \"Test Map\"\n</code></pre>"},{"location":"contributing/#running-tests","title":"Running Tests","text":"<p>Run all tests: <pre><code>just test-all\n</code></pre></p> <p>Run API tests only: <pre><code>just test-api\n</code></pre></p> <p>Run specific test file: <pre><code>uv run --project apps/api pytest apps/api/tests/test_maps.py\n</code></pre></p>"},{"location":"contributing/#test-database","title":"Test Database","text":"<p>Tests use an isolated PostgreSQL database, automatically created and torn down by <code>pytest-databases</code>.</p>"},{"location":"contributing/#mocking","title":"Mocking","text":"<p>Use <code>pytest</code> fixtures for mocking:</p> <pre><code>@pytest.fixture\ndef mock_rabbitmq():\n    return AsyncMock()\n</code></pre>"},{"location":"contributing/#database-migrations","title":"Database Migrations","text":"<p>Migrations are manual. There is no migration runner in this repo.</p>"},{"location":"contributing/#creating-migrations","title":"Creating Migrations","text":"<ol> <li> <p>Create a new SQL file in <code>apps/api/migrations/</code>:    <pre><code>touch apps/api/migrations/0004_add_new_feature.sql\n</code></pre></p> </li> <li> <p>Write the migration:    <pre><code>CREATE TABLE new_feature (\n    id SERIAL PRIMARY KEY,\n    name TEXT NOT NULL\n);\n</code></pre></p> </li> <li> <p>Apply the migration manually using your preferred Postgres client. Example (dev container):    <pre><code>docker compose -f docker-compose.dev.yml exec genjishimada-db-dev \\\n  psql -U genjishimada -d genjishimada -f /path/to/migrations/0004_add_new_feature.sql\n</code></pre></p> </li> </ol>"},{"location":"contributing/#migration-guidelines","title":"Migration Guidelines","text":"<ul> <li>Name files sequentially: <code>0001</code>, <code>0002</code>, etc.</li> <li>Include comments explaining the purpose</li> <li>Test on a copy of production data</li> <li>Keep migrations small and focused</li> </ul>"},{"location":"contributing/#pull-request-process","title":"Pull Request Process","text":""},{"location":"contributing/#before-submitting","title":"Before Submitting","text":"<ol> <li>Lint your code: <code>just lint-all</code></li> <li>Run tests: <code>just test-all</code></li> <li>Update documentation if needed</li> <li>Write a clear commit message</li> </ol>"},{"location":"contributing/#pr-title-format","title":"PR Title Format","text":"<p>Use conventional commit format:</p> <ul> <li><code>feat: Add new map search endpoint</code></li> <li><code>fix: Resolve completion verification bug</code></li> <li><code>docs: Update API authentication guide</code></li> <li><code>refactor: Simplify DI module structure</code></li> <li><code>test: Add tests for lootbox system</code></li> </ul>"},{"location":"contributing/#pr-description","title":"PR Description","text":"<p>Include:</p> <ul> <li>What: What does this PR do?</li> <li>Why: Why is this change needed?</li> <li>How: How does it work?</li> <li>Testing: How was it tested?</li> </ul>"},{"location":"contributing/#review-process","title":"Review Process","text":"<ol> <li>A maintainer will review your PR</li> <li>Address any requested changes</li> <li>Once approved, your PR will be merged</li> </ol>"},{"location":"contributing/#areas-to-contribute","title":"Areas to Contribute","text":""},{"location":"contributing/#good-first-issues","title":"Good First Issues","text":"<p>Look for issues labeled <code>good first issue</code> on GitHub.</p>"},{"location":"contributing/#feature-requests","title":"Feature Requests","text":"<p>Have an idea? Open an issue to discuss it first.</p>"},{"location":"contributing/#documentation","title":"Documentation","text":"<p>Improve or expand the documentation in the <code>docs/</code> directory.</p>"},{"location":"contributing/#bug-fixes","title":"Bug Fixes","text":"<p>Found a bug? Submit a fix with tests.</p>"},{"location":"contributing/#communication","title":"Communication","text":"<ul> <li>GitHub Issues: For bug reports and feature requests</li> <li>Discord: Join the Genji Parkour server for discussions</li> </ul>"},{"location":"contributing/#next-steps","title":"Next Steps","text":"<ul> <li>Development Workflow - Detailed workflow guide</li> <li>Documentation Guide - Contributing to docs</li> <li>Getting Started - Set up your environment</li> </ul>"},{"location":"contributing/documentation/","title":"Documentation Guide","text":"<p>How to contribute to and maintain the Genji Shimada documentation.</p>"},{"location":"contributing/documentation/#overview","title":"Overview","text":"<p>The documentation is built with MkDocs Material and hosted on GitHub Pages at docs.genji.pk.</p>"},{"location":"contributing/documentation/#documentation-structure","title":"Documentation Structure","text":"<pre><code>docs/\n\u251c\u2500\u2500 index.md                    # Home page\n\u251c\u2500\u2500 domain/                     # Domain overview\n\u251c\u2500\u2500 services/                   # Service-level docs\n\u251c\u2500\u2500 getting-started/            # Installation and quickstart\n\u251c\u2500\u2500 bot/                        # Bot documentation\n\u251c\u2500\u2500 api/                        # API documentation\n\u251c\u2500\u2500 sdk/                        # SDK documentation\n\u251c\u2500\u2500 operations/                 # Infrastructure and deployment\n\u251c\u2500\u2500 contributing/               # Contribution guides\n\u251c\u2500\u2500 stylesheets/\n\u2502   \u2514\u2500\u2500 extra.css               # Custom Tailwind colors\n\u2514\u2500\u2500 openapi.json                # Generated OpenAPI spec\n</code></pre>"},{"location":"contributing/documentation/#local-development","title":"Local Development","text":""},{"location":"contributing/documentation/#preview-documentation","title":"Preview Documentation","text":"<p>Serve the docs locally with live reload:</p> <pre><code>just docs-serve\n</code></pre> <p>Visit <code>http://127.0.0.1:8000</code> to view the documentation.</p>"},{"location":"contributing/documentation/#build-documentation","title":"Build Documentation","text":"<p>Generate the OpenAPI spec and build the site:</p> <pre><code>uv run --project apps/api python scripts/generate_openapi.py\nuv run --project docs mkdocs build\n</code></pre> <p>Output is in <code>site/</code>.</p>"},{"location":"contributing/documentation/#writing-documentation","title":"Writing Documentation","text":""},{"location":"contributing/documentation/#markdown-basics","title":"Markdown Basics","text":"<p>Use GitHub-flavored Markdown with MkDocs Material extensions.</p> <p>Headings:</p> <pre><code># H1 - Page Title\n## H2 - Section\n### H3 - Subsection\n</code></pre> <p>Links:</p> <pre><code>[Link text](../other-page.md)\n[External link](https://example.com)\n</code></pre> <p>Code blocks:</p> <pre><code>```python\ndef hello():\n    print(\"Hello, world!\")\n```\n</code></pre> <p>Inline code:</p> <pre><code>Use `just run-api` to start the server.\n</code></pre>"},{"location":"contributing/documentation/#mkdocs-material-features","title":"MkDocs Material Features","text":""},{"location":"contributing/documentation/#admonitions","title":"Admonitions","text":"<p>Highlight important information:</p> <pre><code>!!! note\n    This is a note.\n\n!!! warning\n    This is a warning.\n\n!!! tip\n    This is a tip.\n\n!!! danger\n    This is a danger alert.\n</code></pre> <p>Result:</p> <p>Note</p> <p>This is a note.</p>"},{"location":"contributing/documentation/#code-annotations","title":"Code Annotations","text":"<p>Add explanations to code blocks:</p> <pre><code>```python\ndef process(data):  # (1)!\n    return data * 2\n```\n\n1. Multiply the input by 2\n</code></pre>"},{"location":"contributing/workflow/","title":"Development Workflow","text":"<p>Detailed guide for developing features and fixing bugs in Genji Shimada.</p>"},{"location":"contributing/workflow/#setting-up-your-environment","title":"Setting Up Your Environment","text":""},{"location":"contributing/workflow/#1-fork-the-repository","title":"1. Fork the Repository","text":"<p>Click \"Fork\" on GitHub to create your own copy:</p> <pre><code>https://github.com/bkan0n/genjishimada\n</code></pre>"},{"location":"contributing/workflow/#2-clone-your-fork","title":"2. Clone Your Fork","text":"<pre><code>git clone https://github.com/YOUR_USERNAME/genjishimada.git\ncd genjishimada\n</code></pre>"},{"location":"contributing/workflow/#3-add-upstream-remote","title":"3. Add Upstream Remote","text":"<pre><code>git remote add upstream https://github.com/bkan0n/genjishimada.git\n</code></pre>"},{"location":"contributing/workflow/#4-install-dependencies","title":"4. Install Dependencies","text":"<pre><code>just setup\n</code></pre>"},{"location":"contributing/workflow/#5-configure-environment","title":"5. Configure Environment","text":"<p>Create a <code>.env</code> file in the repo root and set the required variables.</p>"},{"location":"contributing/workflow/#6-start-infrastructure","title":"6. Start Infrastructure","text":"<pre><code>docker compose -f docker-compose.dev.yml up -d \\\n  genjishimada-db-dev \\\n  genjishimada-rabbitmq-dev\n</code></pre>"},{"location":"contributing/workflow/#daily-workflow","title":"Daily Workflow","text":""},{"location":"contributing/workflow/#1-sync-with-upstream","title":"1. Sync with Upstream","text":"<p>Before starting work, sync your fork:</p> <pre><code>git checkout main\ngit fetch upstream\ngit merge upstream/main\ngit push origin main\n</code></pre>"},{"location":"contributing/workflow/#2-create-a-feature-branch","title":"2. Create a Feature Branch","text":"<pre><code>git checkout -b feature/your-feature-name\n</code></pre> <p>Branch naming conventions: - <code>feature/</code> - New features - <code>fix/</code> - Bug fixes - <code>docs/</code> - Documentation changes - <code>refactor/</code> - Code refactoring - <code>test/</code> - Test improvements</p>"},{"location":"contributing/workflow/#3-make-changes","title":"3. Make Changes","text":"<p>Edit code, add tests, update documentation.</p>"},{"location":"contributing/workflow/#4-run-linters","title":"4. Run Linters","text":"<pre><code>just lint-all\n</code></pre> <p>This runs: - Ruff (formatting and linting) - BasedPyright (type checking)</p> <p>Fix linting issues: <pre><code># Format code\nuv run ruff format .\n\n# Auto-fix linting issues\nuv run ruff check --fix .\n</code></pre></p>"},{"location":"contributing/workflow/#5-run-tests","title":"5. Run Tests","text":"<pre><code>just test-all\n</code></pre> <p>For faster iteration, run specific tests:</p> <pre><code># API tests only\njust test-api\n\n# Specific test file\nuv run --project apps/api pytest apps/api/tests/test_maps.py\n\n# Specific test function\nuv run --project apps/api pytest apps/api/tests/test_maps.py::test_get_map\n</code></pre>"},{"location":"contributing/workflow/#6-commit-changes","title":"6. Commit Changes","text":"<p>Write clear, descriptive commit messages:</p> <pre><code>git add .\ngit commit -m \"feat: add map search endpoint\n\n- Add /maps/search route with query parameters\n- Implement full-text search using PostgreSQL\n- Add tests for search functionality\n\"\n</code></pre> <p>Commit message format:</p> <pre><code>&lt;type&gt;: &lt;short description&gt;\n\n&lt;detailed description&gt;\n\n&lt;footer (optional)&gt;\n</code></pre> <p>Types: - <code>feat</code> - New feature - <code>fix</code> - Bug fix - <code>docs</code> - Documentation - <code>refactor</code> - Code refactoring - <code>test</code> - Test improvements - <code>chore</code> - Maintenance tasks</p>"},{"location":"contributing/workflow/#7-push-to-your-fork","title":"7. Push to Your Fork","text":"<pre><code>git push origin feature/your-feature-name\n</code></pre>"},{"location":"contributing/workflow/#8-open-a-pull-request","title":"8. Open a Pull Request","text":"<ol> <li>Go to your fork on GitHub</li> <li>Click \"Compare &amp; pull request\"</li> <li>Fill out the PR template</li> <li>Submit the PR</li> </ol>"},{"location":"contributing/workflow/#working-on-the-api","title":"Working on the API","text":""},{"location":"contributing/workflow/#project-structure","title":"Project Structure","text":"<pre><code>apps/api/\n\u251c\u2500\u2500 di/                # Business logic (DI modules)\n\u2502   \u251c\u2500\u2500 base.py        # BaseService with RabbitMQ publishing\n\u2502   \u251c\u2500\u2500 auth.py        # Authentication logic\n\u2502   \u251c\u2500\u2500 maps.py        # Map CRUD operations\n\u2502   \u2514\u2500\u2500 completions.py # Completion tracking\n\u251c\u2500\u2500 routes/            # HTTP route handlers\n\u2502   \u251c\u2500\u2500 maps/          # Map-related routes\n\u2502   \u2514\u2500\u2500 completions.py # Completion endpoints\n\u251c\u2500\u2500 middleware/        # Auth and request processing\n\u2502   \u251c\u2500\u2500 auth.py        # CustomAuthenticationMiddleware\n\u2502   \u2514\u2500\u2500 guards.py      # Scope guards\n\u251c\u2500\u2500 utilities/         # Shared utilities\n\u2502   \u2514\u2500\u2500 errors.py      # Custom exceptions\n\u2514\u2500\u2500 tests/             # API tests\n</code></pre>"},{"location":"contributing/workflow/#adding-a-new-endpoint","title":"Adding a New Endpoint","text":"<ol> <li>Define the route handler in <code>routes/</code>:</li> </ol> <pre><code>from litestar import get\nfrom genjishimada_sdk.maps import MapResponse\n\n@get(\"/maps/{map_id:int}\")\nasync def get_map(map_id: int, conn: Connection) -&gt; MapResponse:\n    map_data = await maps_service.get_map(conn, map_id)\n    return map_data\n</code></pre> <ol> <li>Implement business logic in <code>di/</code>:</li> </ol> <pre><code>from asyncpg import Connection\nfrom genjishimada_sdk.maps import MapResponse\n\nasync def get_map(conn: Connection, map_id: int) -&gt; MapResponse:\n    row = await conn.fetchrow(\n        \"SELECT * FROM maps.maps WHERE id = $1\",\n        map_id\n    )\n    if not row:\n        raise CustomHTTPException(404, \"Map not found\")\n    return MapResponse(**row)\n</code></pre> <ol> <li>Add tests in <code>tests/</code>:</li> </ol> <pre><code>import pytest\nfrom httpx import AsyncClient\n\n@pytest.mark.asyncio\nasync def test_get_map(client: AsyncClient):\n    response = await client.get(\"/api/v3/maps/1\")\n    assert response.status_code == 200\n</code></pre> <ol> <li>Run tests:</li> </ol> <pre><code>just test-api\n</code></pre>"},{"location":"contributing/workflow/#database-queries","title":"Database Queries","text":"<p>Use AsyncPG with parameterized queries:</p> <pre><code># Good - parameterized query\nrow = await conn.fetchrow(\n    \"SELECT * FROM maps.maps WHERE id = $1\",\n    map_id\n)\n\n# Bad - SQL injection risk\nrow = await conn.fetchrow(\n    f\"SELECT * FROM maps.maps WHERE id = {map_id}\"\n)\n</code></pre>"},{"location":"contributing/workflow/#publishing-messages","title":"Publishing Messages","text":"<p>Use <code>BaseService.publish_message()</code>:</p> <pre><code>from di.base import BaseService\nfrom genjishimada_sdk.completions import CompletionCreatedEvent\n\nclass CompletionsService(BaseService):\n    async def create_completion(self, user_id: int, map_id: int) -&gt; int:\n        # Create in database\n        completion_id = await insert_completion(...)\n\n        # Publish event\n        event = CompletionCreatedEvent(\n            completion_id=completion_id,\n        )\n        await self.publish_message(\n            queue_name=\"api.completion.submission\",\n            message=event,\n            message_id=f\"completion-{completion_id}\",\n        )\n\n        return completion_id\n</code></pre>"},{"location":"contributing/workflow/#working-on-the-bot","title":"Working on the Bot","text":""},{"location":"contributing/workflow/#project-structure_1","title":"Project Structure","text":"<pre><code>apps/bot/\n\u251c\u2500\u2500 core/\n\u2502   \u2514\u2500\u2500 genji.py       # Main bot class\n\u251c\u2500\u2500 extensions/        # Feature modules (cogs)\n\u2502   \u251c\u2500\u2500 rabbit.py      # RabbitMQ service\n\u2502   \u251c\u2500\u2500 api_service.py # API client\n\u2502   \u2514\u2500\u2500 completions.py # Completion handlers\n\u2514\u2500\u2500 configs/           # Configuration files\n    \u251c\u2500\u2500 dev.toml\n    \u2514\u2500\u2500 prod.toml\n</code></pre>"},{"location":"contributing/workflow/#adding-a-queue-consumer","title":"Adding a Queue Consumer","text":"<ol> <li>Define the consumer in an extension:</li> </ol> <pre><code>from extensions._queue_registry import queue_consumer\nfrom genjishimada_sdk.completions import CompletionCreatedEvent\n\n@queue_consumer(\n    \"api.completion.submission\",\n    struct_type=CompletionCreatedEvent,\n    idempotent=True\n)\nasync def handle_completion(\n    self,\n    event: CompletionCreatedEvent,\n    message: AbstractIncomingMessage,\n) -&gt; None:\n    # Send Discord notification\n    channel = self.bot.get_channel(COMPLETION_CHANNEL_ID)\n    await channel.send(f\"New completion: {event.completion_id}\")\n</code></pre> <ol> <li>Test manually:</li> </ol> <p>Trigger the event from the API and verify the bot processes it.</p>"},{"location":"contributing/workflow/#calling-the-api","title":"Calling the API","text":"<p>Use the shared <code>APIService</code> attached to the bot:</p> <pre><code>async def get_user(user_id: int):\n    return await bot.api.get_user(user_id)\n</code></pre>"},{"location":"contributing/workflow/#working-on-the-sdk","title":"Working on the SDK","text":""},{"location":"contributing/workflow/#adding-a-new-model","title":"Adding a New Model","text":"<ol> <li>Define the model in <code>libs/sdk/src/genjishimada_sdk/</code>:</li> </ol> <pre><code>import msgspec\n\nclass Achievement(msgspec.Struct):\n    id: int\n    name: str\n    description: str\n    icon_url: str | None\n    xp_reward: int\n</code></pre> <ol> <li>Export from <code>__init__.py</code>:</li> </ol> <pre><code>from .achievements import Achievement\n\n__all__ = [\"Achievement\", ...]\n</code></pre> <ol> <li>Use in API and bot:</li> </ol> <pre><code>from genjishimada_sdk import Achievement\n\nachievement = Achievement(\n    id=1,\n    name=\"First Completion\",\n    description=\"Complete your first map\",\n    icon_url=None,\n    xp_reward=100,\n)\n</code></pre> <ol> <li>Run linters:</li> </ol> <pre><code>just lint-sdk\n</code></pre>"},{"location":"contributing/workflow/#debugging","title":"Debugging","text":""},{"location":"contributing/workflow/#api-debugging","title":"API Debugging","text":"<ol> <li>Add debug logging:</li> </ol> <pre><code>import logging\n\nlogger = logging.getLogger(__name__)\nlogger.debug(f\"Processing completion: {completion_id}\")\n</code></pre> <ol> <li>Run with debug mode:</li> </ol> <pre><code>cd apps/api\nuv run litestar run --debug\n</code></pre> <ol> <li>Check logs:</li> </ol> <p>Logs appear in the terminal.</p>"},{"location":"contributing/workflow/#bot-debugging","title":"Bot Debugging","text":"<ol> <li>Add debug logging:</li> </ol> <pre><code>import logging\n\nlogger = logging.getLogger(__name__)\nlogger.debug(f\"Received event: {event}\")\n</code></pre> <ol> <li>Run the bot:</li> </ol> <pre><code>just run-bot\n</code></pre> <ol> <li>Check logs:</li> </ol> <p>Logs appear in the terminal.</p>"},{"location":"contributing/workflow/#database-debugging","title":"Database Debugging","text":"<ol> <li>Connect to PostgreSQL:</li> </ol> <pre><code>docker compose -f docker-compose.dev.yml exec genjishimada-db-dev \\\n  psql -U genjishimada\n</code></pre> <ol> <li>Run queries:</li> </ol> <pre><code>SELECT * FROM maps.maps LIMIT 10;\n</code></pre>"},{"location":"contributing/workflow/#common-issues","title":"Common Issues","text":""},{"location":"contributing/workflow/#import-errors","title":"Import Errors","text":"<p>If you see import errors, re-sync dependencies:</p> <pre><code>just sync\n</code></pre>"},{"location":"contributing/workflow/#database-connection-failed","title":"Database Connection Failed","text":"<p>Ensure Docker services are running:</p> <pre><code>docker compose -f docker-compose.dev.yml ps\n</code></pre>"},{"location":"contributing/workflow/#tests-failing","title":"Tests Failing","text":"<p>Run tests with verbose output:</p> <pre><code>uv run --project apps/api pytest -vv apps/api/tests/\n</code></pre>"},{"location":"contributing/workflow/#type-errors","title":"Type Errors","text":"<p>Run BasedPyright to see all type errors:</p> <pre><code>uv run basedpyright apps/api\n</code></pre>"},{"location":"contributing/workflow/#next-steps","title":"Next Steps","text":"<ul> <li>Contributing Guide - General contribution guidelines</li> <li>Documentation Guide - Update documentation</li> <li>Bot Architecture - Understand the bot</li> <li>API Documentation - Explore the API</li> </ul>"},{"location":"domain/","title":"Domain Overview","text":"<p>Genji Shimada orchestrates messaging, automation, and content workflows across multiple services. Each service is scoped to a clear responsibility, while shared practices such as deployment and configuration keep the system consistent.</p>"},{"location":"domain/#architecture-snapshot","title":"Architecture Snapshot","text":"<ul> <li>Bot: Orchestrates interactions with Discord and routes user intents.</li> <li>API: Exposes HTTP interfaces for clients and internal consumers.</li> <li>Database: Persists application and operational data.</li> <li>RabbitMQ: Coordinates asynchronous tasks and event delivery between services.</li> <li>OCR: Extracts structured data from parkour screenshots for downstream automation.</li> </ul>"},{"location":"domain/#operational-practices","title":"Operational Practices","text":"<ul> <li>Environment-specific configuration for development vs production.</li> <li>Health checks to validate deployments.</li> <li>Centralized logging and error tracking.</li> </ul>"},{"location":"getting-started/","title":"Getting Started","text":"<p>Welcome to Genji Shimada! This guide will help you get the project running locally for development or testing.</p>"},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<p>Before you begin, ensure you have the following installed:</p> <ul> <li>Python 3.13+ - Download Python</li> <li>uv - Fast Python package manager (Installation Guide)</li> <li>Docker - Required for PostgreSQL and RabbitMQ (Get Docker)</li> <li>just - Command runner (Installation Guide)</li> <li>Git - Version control</li> </ul>"},{"location":"getting-started/#installation","title":"Installation","text":"<p>Follow these steps to set up the project:</p>"},{"location":"getting-started/#1-clone-the-repository","title":"1. Clone the Repository","text":"<pre><code>git clone https://github.com/bkan0n/genjishimada.git\ncd genjishimada\n</code></pre>"},{"location":"getting-started/#2-install-dependencies","title":"2. Install Dependencies","text":"<p>Use <code>just</code> to install all dependencies across the monorepo:</p> <pre><code>just setup\n</code></pre> <p>This command runs <code>uv sync --all-groups</code>, which installs dependencies for all workspaces (API, bot, SDK, and docs).</p>"},{"location":"getting-started/#3-configure-environment-variables","title":"3. Configure Environment Variables","text":"<p>Create a <code>.env</code> file in the repository root and set the required variables:</p> <pre><code># Discord\nDISCORD_TOKEN=your_discord_bot_token\n\n# Database\nPOSTGRES_USER=genjishimada\nPOSTGRES_PASSWORD=your_password\nPOSTGRES_DB=genjishimada\n\n# RabbitMQ\nRABBITMQ_USER=admin\nRABBITMQ_PASS=your_password\nRABBITMQ_HOST=localhost\n\n# API\nAPI_KEY=your_api_key_for_bot\nAPP_ENVIRONMENT=development\n\n# S3-compatible storage (Cloudflare R2)\nAWS_ACCESS_KEY_ID=your_access_key\nAWS_SECRET_ACCESS_KEY=your_secret_key\nR2_ACCOUNT_ID=your_r2_account_id\n\n# Email\nRESEND_API_KEY=your_resend_key\n\n# Monitoring\nSENTRY_DSN=your_sentry_dsn\n</code></pre> <p>If you are running the API on the host, set <code>PSQL_DSN</code> to point at the local Postgres port:</p> <pre><code>PSQL_DSN=postgresql://genjishimada:your_password@localhost:65432/genjishimada\n</code></pre>"},{"location":"getting-started/#4-start-infrastructure-services","title":"4. Start Infrastructure Services","text":"<p>Start the database and RabbitMQ only:</p> <pre><code>docker compose -f docker-compose.dev.yml up -d \\\n  genjishimada-db-dev \\\n  genjishimada-rabbitmq-dev\n</code></pre>"},{"location":"getting-started/#next-steps","title":"Next Steps","text":"<p>Now that you've installed the project, learn how to:</p> <ul> <li>Run the API and Bot - Start the services locally</li> <li>Understand the Architecture - Learn how the system works</li> <li>Make Your First Changes - Contributing guide</li> </ul>"},{"location":"getting-started/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/#uv-not-found","title":"<code>uv</code> Not Found","text":"<p>If <code>uv</code> is not installed, follow the official installation guide.</p>"},{"location":"getting-started/#docker-issues","title":"Docker Issues","text":"<p>Ensure Docker is running and you have sufficient resources allocated. On macOS, check Docker Desktop settings.</p>"},{"location":"getting-started/#database-connection-errors","title":"Database Connection Errors","text":"<p>Verify that PostgreSQL is running:</p> <pre><code>docker compose -f docker-compose.dev.yml ps genjishimada-db-dev\n</code></pre> <p>Check logs if the container is not healthy:</p> <pre><code>docker compose -f docker-compose.dev.yml logs genjishimada-db-dev\n</code></pre>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>Detailed installation instructions for Genji Shimada.</p> <p>Note</p> <p>If you haven't already, review the Getting Started Overview for prerequisites and initial setup steps.</p>"},{"location":"getting-started/installation/#system-requirements","title":"System Requirements","text":""},{"location":"getting-started/installation/#minimum-requirements","title":"Minimum Requirements","text":"<ul> <li>CPU: 2 cores</li> <li>RAM: 4 GB</li> <li>Disk: 5 GB free space</li> <li>OS: Linux, macOS, or Windows with WSL2</li> </ul>"},{"location":"getting-started/installation/#recommended-for-development","title":"Recommended for Development","text":"<ul> <li>CPU: 4+ cores</li> <li>RAM: 8+ GB</li> <li>Disk: 10+ GB free space (for Docker images and databases)</li> </ul>"},{"location":"getting-started/installation/#step-by-step-installation","title":"Step-by-Step Installation","text":""},{"location":"getting-started/installation/#1-install-python-313","title":"1. Install Python 3.13+","text":"macOSLinux (Ubuntu/Debian)Windows <p>Using Homebrew: <pre><code>brew install python@3.13\n</code></pre></p> <pre><code>sudo apt update\nsudo apt install python3.13 python3.13-venv python3.13-dev\n</code></pre> <p>Download from python.org and run the installer.</p> <p>Ensure \"Add Python to PATH\" is checked during installation.</p> <p>Verify installation:</p> <pre><code>python3.13 --version\n</code></pre>"},{"location":"getting-started/installation/#2-install-uv","title":"2. Install uv","text":"<p>The project uses <code>uv</code> for fast dependency management:</p> macOS/LinuxWindows <pre><code>curl -LsSf https://astral.sh/uv/install.sh | sh\n</code></pre> <pre><code>powershell -c \"irm https://astral.sh/uv/install.ps1 | iex\"\n</code></pre> <p>Verify installation:</p> <pre><code>uv --version\n</code></pre>"},{"location":"getting-started/installation/#3-install-just","title":"3. Install just","text":"<p><code>just</code> is used as a task runner for common development commands:</p> macOSLinuxWindows <pre><code>brew install just\n</code></pre> <pre><code>cargo install just\n</code></pre> <p>Or download from GitHub releases.</p> <pre><code>cargo install just\n</code></pre> <p>Verify installation:</p> <pre><code>just --version\n</code></pre>"},{"location":"getting-started/installation/#4-install-docker","title":"4. Install Docker","text":"<p>Docker is required for running PostgreSQL and RabbitMQ:</p> <ul> <li>macOS: Docker Desktop for Mac</li> <li>Linux: Docker Engine</li> <li>Windows: Docker Desktop for Windows</li> </ul> <p>Verify installation:</p> <pre><code>docker --version\ndocker compose version\n</code></pre>"},{"location":"getting-started/installation/#5-clone-the-repository","title":"5. Clone the Repository","text":"<pre><code>git clone https://github.com/bkan0n/genjishimada.git\ncd genjishimada\n</code></pre>"},{"location":"getting-started/installation/#6-install-project-dependencies","title":"6. Install Project Dependencies","text":"<p>Run the setup command to install all dependencies:</p> <pre><code>just setup\n</code></pre> <p>This command: 1. Creates virtual environments for all workspaces 2. Installs Python dependencies 3. Sets up development tools (Ruff, BasedPyright, pytest)</p>"},{"location":"getting-started/installation/#7-configure-environment","title":"7. Configure Environment","text":"<p>Create a <code>.env</code> file in the repo root and set the required values. See Configuration Guide for details. If you plan to run the API on the host, set <code>PSQL_DSN</code> to point at <code>localhost:65432</code>.</p>"},{"location":"getting-started/installation/#8-start-infrastructure","title":"8. Start Infrastructure","text":"<p>Start PostgreSQL and RabbitMQ using Docker Compose:</p> <pre><code>docker compose -f docker-compose.dev.yml up -d \\\n  genjishimada-db-dev \\\n  genjishimada-rabbitmq-dev\n</code></pre> <p>Check that services are healthy:</p> <pre><code>docker compose -f docker-compose.dev.yml ps\n</code></pre>"},{"location":"getting-started/installation/#verification","title":"Verification","text":"<p>Verify your installation by running the linters:</p> <pre><code>just lint-all\n</code></pre> <p>All checks should pass (or report only pre-existing issues).</p>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start Guide - Run the API and bot</li> <li>Configuration - Detailed environment setup</li> <li>Development Workflow - How to contribute</li> </ul>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>Get the API and bot running locally in minutes.</p> <p>Prerequisites</p> <p>This guide assumes you've completed the Installation steps and have Docker services running.</p>"},{"location":"getting-started/quickstart/#running-the-api","title":"Running the API","text":"<p>Start the Litestar API server:</p> <pre><code>just run-api\n</code></pre> <p>This command: - Changes to the <code>apps/api</code> directory - Runs <code>litestar run</code> with hot reload enabled - Serves on <code>http://localhost:8000</code></p> <p>If you are running the API on the host, set <code>PSQL_DSN</code> in <code>.env</code> so it points at <code>localhost:65432</code>.</p>"},{"location":"getting-started/quickstart/#verify-api-is-running","title":"Verify API is Running","text":"<p>Open your browser to:</p> <ul> <li>API Docs: http://localhost:8000/docs</li> <li>Health Check: http://localhost:8000/healthcheck</li> </ul> <p>You should see the interactive OpenAPI documentation.</p>"},{"location":"getting-started/quickstart/#running-the-bot","title":"Running the Bot","text":"<p>The bot is configured to call the API at the Docker service name (<code>genjishimada-api-dev</code> in development). The simplest local setup is to run the bot in Docker:</p> <pre><code>docker compose -f docker-compose.dev.yml up -d genjishimada-bot-dev\n</code></pre> <p>If you run the bot on the host with <code>just run-bot</code>, ensure the API hostname resolves (for example by running the API container and joining the same Docker network).</p>"},{"location":"getting-started/quickstart/#verify-bot-is-running","title":"Verify Bot is Running","text":"<p>Check the terminal output for:</p> <pre><code>Logged in as YourBotName#1234\nBot is ready.\n</code></pre> <p>In your Discord server, the bot should appear online.</p>"},{"location":"getting-started/quickstart/#running-both-services-in-docker-optional","title":"Running Both Services in Docker (optional)","text":"<p>If you want Docker to run everything:</p> <pre><code>docker compose -f docker-compose.dev.yml up -d\n</code></pre> <p>This will start API, bot, database, and RabbitMQ in containers.</p>"},{"location":"getting-started/quickstart/#testing-the-integration","title":"Testing the Integration","text":""},{"location":"getting-started/quickstart/#1-trigger-a-bot-command","title":"1. Trigger a Bot Command","text":"<p>In Discord, send a command to test the bot:</p> <pre><code>/map search parkour\n</code></pre>"},{"location":"getting-started/quickstart/#2-check-api-logs","title":"2. Check API Logs","text":"<p>In the API terminal, you should see incoming requests from the bot.</p>"},{"location":"getting-started/quickstart/#3-check-rabbitmq","title":"3. Check RabbitMQ","text":"<p>RabbitMQ is not exposed directly in this repo; it is typically proxied via Caddy in production. For local checks, use container logs:</p> <pre><code>docker compose -f docker-compose.dev.yml logs -f genjishimada-rabbitmq-dev\n</code></pre>"},{"location":"getting-started/quickstart/#development-workflow","title":"Development Workflow","text":""},{"location":"getting-started/quickstart/#make-code-changes","title":"Make Code Changes","text":"<p>The API runs with <code>--reload</code>, so changes are automatically picked up. For the bot, you'll need to restart the process.</p>"},{"location":"getting-started/quickstart/#run-tests","title":"Run Tests","text":"<p>Test the API:</p> <pre><code>just test-api\n</code></pre> <p>This runs pytest with 8 parallel workers.</p>"},{"location":"getting-started/quickstart/#lint-code","title":"Lint Code","text":"<p>Before committing, run linters:</p> <pre><code>just lint-all\n</code></pre> <p>This formats code with Ruff and type-checks with BasedPyright.</p>"},{"location":"getting-started/quickstart/#common-tasks","title":"Common Tasks","text":""},{"location":"getting-started/quickstart/#view-logs","title":"View Logs","text":"<p>API logs: Displayed in the terminal where <code>just run-api</code> is running</p> <p>Bot logs: Displayed in the terminal where <code>just run-bot</code> is running</p> <p>Database logs: <pre><code>docker compose -f docker-compose.dev.yml logs -f genjishimada-db-dev\n</code></pre></p> <p>RabbitMQ logs: <pre><code>docker compose -f docker-compose.dev.yml logs -f genjishimada-rabbitmq-dev\n</code></pre></p>"},{"location":"getting-started/quickstart/#stop-services","title":"Stop Services","text":"<p>Stop Docker services:</p> <pre><code>docker compose -f docker-compose.dev.yml down\n</code></pre> <p>Stop API/bot: Press <code>Ctrl+C</code> in their respective terminals.</p>"},{"location":"getting-started/quickstart/#re-sync-dependencies","title":"Re-sync Dependencies","text":"<p>After pulling changes or switching branches:</p> <pre><code>just sync\n</code></pre>"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>Bot Architecture - Understand how the bot works</li> <li>API Documentation - Learn about API endpoints</li> <li>Contributing Guide - Make your first contribution</li> </ul>"},{"location":"getting-started/quickstart/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/quickstart/#port-already-in-use","title":"Port Already in Use","text":"<p>If port 8000 is already in use, find and kill the process:</p> <pre><code>lsof -ti:8000 | xargs kill -9\n</code></pre>"},{"location":"getting-started/quickstart/#bot-wont-connect","title":"Bot Won't Connect","text":"<ol> <li>Verify <code>DISCORD_TOKEN</code> is set in <code>.env</code></li> <li>Check that the bot has proper permissions in your Discord server</li> <li>Ensure intents are enabled in the Discord Developer Portal</li> </ol>"},{"location":"getting-started/quickstart/#database-connection-failed","title":"Database Connection Failed","text":"<ol> <li> <p>Verify Docker services are running:    <pre><code>docker compose -f docker-compose.dev.yml ps\n</code></pre></p> </li> <li> <p>Check PostgreSQL logs:    <pre><code>docker compose -f docker-compose.dev.yml logs genjishimada-db-dev\n</code></pre></p> </li> <li> <p>Verify database credentials in <code>.env</code> match <code>docker-compose.dev.yml</code></p> </li> </ol>"},{"location":"operations/","title":"Operations","text":"<p>Guides for deploying, configuring, and maintaining Genji Shimada in production and development environments.</p>"},{"location":"operations/#overview","title":"Overview","text":"<p>This section covers:</p> <ul> <li>Infrastructure - PostgreSQL, RabbitMQ, and cloud services</li> <li>Docker Compose - Local and production deployments</li> <li>Configuration - Environment variables and config files</li> <li>Reverse Proxy - Caddy routing, domains, and TLS</li> <li>Identity &amp; Auth - Keycloak and oauth2-proxy</li> <li>Cloudflare - DNS and CDN configuration</li> <li>Monitoring - Grafana Alloy stack and dashboards</li> </ul>"},{"location":"operations/#quick-links","title":"Quick Links","text":"<ul> <li> <p> Infrastructure</p> <p>Learn about the services that power Genji Shimada</p> <p> Infrastructure Guide</p> </li> <li> <p> Docker Compose</p> <p>Deploy with Docker for development and production</p> <p> Docker Guide</p> </li> <li> <p> Reverse Proxy</p> <p>Caddy routing and Cloudflare TLS automation</p> <p> Reverse Proxy Guide</p> </li> <li> <p> Monitoring</p> <p>Set up Grafana Alloy, dashboards, and log collection</p> <p> Monitoring Guide</p> </li> <li> <p> Identity &amp; Auth</p> <p>Keycloak and oauth2-proxy configuration</p> <p> Identity &amp; Auth Guide</p> </li> <li> <p> Cloudflare</p> <p>DNS, CDN, and R2 configuration</p> <p> Cloudflare Guide</p> </li> </ul>"},{"location":"operations/#environment-configuration","title":"Environment Configuration","text":"<p>Create a <code>.env</code> file in the repo root with the variables required by your services. At minimum:</p> <pre><code>APP_ENVIRONMENT=development\nDISCORD_TOKEN=your_bot_token\nPOSTGRES_USER=genjishimada\nPOSTGRES_PASSWORD=secure_password\nPOSTGRES_DB=genjishimada\nRABBITMQ_USER=admin\nRABBITMQ_PASS=secure_password\nRABBITMQ_HOST=localhost\nAPI_KEY=secure_api_key_for_bot\n</code></pre> <p>Add optional values for Sentry, R2, and Resend as needed.</p> <p>If you run the API/bot in Docker, set <code>RABBITMQ_HOST</code> to the service name (<code>genjishimada-rabbitmq-dev</code> or <code>genjishimada-rabbitmq</code>).</p>"},{"location":"operations/#health-checks","title":"Health Checks","text":""},{"location":"operations/#api-health-check","title":"API Health Check","text":"<pre><code>curl http://localhost:8000/healthcheck\n</code></pre> <p>If the API runs in Docker without a port mapping, access it through your reverse proxy instead.</p>"},{"location":"operations/#database-health","title":"Database Health","text":"<pre><code>docker compose -f docker-compose.dev.yml exec genjishimada-db-dev pg_isready\n</code></pre>"},{"location":"operations/#rabbitmq-health","title":"RabbitMQ Health","text":"<p>RabbitMQ is not exposed directly in this repo; use container logs or your reverse proxy setup.</p>"},{"location":"operations/#next-steps","title":"Next Steps","text":"<ul> <li>Infrastructure Details - Deep dive into services</li> <li>Docker Compose Guide - Deployment strategies</li> <li>Bot Configuration - Bot-specific config</li> </ul>"},{"location":"operations/cloudflare/","title":"Cloudflare (DNS + CDN)","text":"<p>Genji Shimada uses Cloudflare for DNS, TLS, and CDN delivery. This page captures the relevant records and R2/CDN settings used by the stack.</p>"},{"location":"operations/cloudflare/#zones","title":"Zones","text":"<ul> <li><code>bkan0n.com</code></li> <li><code>genji.pk</code></li> </ul> <p>Both zones are proxied through Cloudflare. The origin IP is intentionally omitted from docs; store it in your private ops notes.</p>"},{"location":"operations/cloudflare/#dns-records-relevant-only","title":"DNS Records (Relevant Only)","text":"<p>Only records used by Genji Shimada and related infrastructure are listed below.</p>"},{"location":"operations/cloudflare/#bkan0ncom","title":"bkan0n.com","text":"<ul> <li><code>bkan0n.com</code> (A, proxied) -&gt; origin IP (private)</li> <li><code>auth.bkan0n.com</code> (CNAME, proxied) -&gt; <code>bkan0n.com</code></li> <li><code>portal.bkan0n.com</code> (CNAME, proxied) -&gt; <code>bkan0n.com</code></li> <li><code>grafana.bkan0n.com</code> (CNAME, proxied) -&gt; <code>bkan0n.com</code></li> <li><code>prometheus.bkan0n.com</code> (CNAME, proxied) -&gt; <code>bkan0n.com</code></li> <li><code>loki.bkan0n.com</code> (CNAME, proxied) -&gt; <code>bkan0n.com</code></li> <li><code>alloy.bkan0n.com</code> (CNAME, proxied) -&gt; <code>bkan0n.com</code></li> <li><code>cadvisor.bkan0n.com</code> (CNAME, proxied) -&gt; <code>bkan0n.com</code></li> <li><code>status.bkan0n.com</code> (CNAME, proxied) -&gt; <code>bkan0n.com</code></li> <li><code>translate.bkan0n.com</code> (CNAME, proxied) -&gt; <code>bkan0n.com</code></li> <li><code>dockhand.bkan0n.com</code> (CNAME, proxied) -&gt; <code>bkan0n.com</code></li> <li><code>cdn.bkan0n.com</code> (CNAME, proxied) -&gt; <code>public.r2.dev</code></li> </ul>"},{"location":"operations/cloudflare/#genjipk","title":"genji.pk","text":"<ul> <li><code>genji.pk</code> (A, proxied) -&gt; origin IP (private)</li> <li><code>api.genji.pk</code> (CNAME, proxied) -&gt; <code>genji.pk</code></li> <li><code>dev-api.genji.pk</code> (CNAME, proxied) -&gt; <code>genji.pk</code></li> <li><code>dev.genji.pk</code> (CNAME, proxied) -&gt; <code>genji.pk</code></li> <li><code>rabbitmq.genji.pk</code> (CNAME, proxied) -&gt; <code>genji.pk</code></li> <li><code>dev-rabbitmq.genji.pk</code> (CNAME, proxied) -&gt; <code>genji.pk</code></li> <li><code>db.genji.pk</code> (CNAME, proxied) -&gt; <code>genji.pk</code></li> <li><code>docs.genji.pk</code> (CNAME, proxied) -&gt; <code>genjishimada.github.io</code></li> <li><code>cdn.genji.pk</code> (CNAME, proxied) -&gt; <code>public.r2.dev</code></li> </ul>"},{"location":"operations/cloudflare/#ssltls","title":"SSL/TLS","text":"<ul> <li>Mode: Full</li> </ul>"},{"location":"operations/cloudflare/#r2-buckets-and-cdn","title":"R2 Buckets and CDN","text":"<p>Public CDN domains:</p> <ul> <li><code>cdn.bkan0n.com</code></li> <li><code>cdn.genji.pk</code></li> </ul> <p>Buckets in use:</p> <ul> <li><code>genji-db-backups</code></li> <li><code>genji-parkour-images</code></li> </ul>"},{"location":"operations/cloudflare/#r2-cors-policy","title":"R2 CORS Policy","text":"<p>Allowed origins:</p> <ul> <li><code>http://genji.test</code></li> <li><code>https://dev.genji.pk</code></li> <li><code>https://genji.pk</code></li> <li><code>http://localhost:3000</code></li> </ul> <p>Allowed methods: <code>GET</code>, <code>HEAD</code> Allowed headers: <code>*</code></p>"},{"location":"operations/cloudflare/#r2-response-headers","title":"R2 Response Headers","text":"<p>For wildcard hostnames <code>*.bkan0n.com</code> and <code>*.genji.pk</code>:</p> <ul> <li><code>Cross-Origin-Resource-Policy: cross-origin</code></li> <li><code>Vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers</code></li> </ul>"},{"location":"operations/cloudflare/#related-docs","title":"Related Docs","text":"<ul> <li>Reverse Proxy - Caddy routing and TLS automation</li> <li>Monitoring - Grafana/Prometheus/Loki endpoints</li> </ul>"},{"location":"operations/docker-compose/","title":"Docker Compose","text":"<p>Deploy Genji Shimada using Docker Compose for development and production environments.</p>"},{"location":"operations/docker-compose/#overview","title":"Overview","text":"<p>The project provides two Docker Compose configurations:</p> <ul> <li><code>docker-compose.dev.yml</code> - Development stack (API, bot, Postgres, RabbitMQ)</li> <li><code>docker-compose.prod.yml</code> - Production stack (API, bot, Postgres, RabbitMQ)</li> </ul> <p>Both files expect the external Docker network <code>genji-network</code> to exist.</p>"},{"location":"operations/docker-compose/#development-environment","title":"Development Environment","text":""},{"location":"operations/docker-compose/#services","title":"Services","text":"<p>The development compose file defines:</p> <pre><code>services:\n  genjishimada-api-dev:      # Litestar API\n  genjishimada-bot-dev:      # Discord bot\n  genjishimada-db-dev:       # PostgreSQL 17\n  genjishimada-rabbitmq-dev: # RabbitMQ\n</code></pre>"},{"location":"operations/docker-compose/#starting-development-services","title":"Starting Development Services","text":"<pre><code>docker compose -f docker-compose.dev.yml up -d\n</code></pre> <p>To run only infrastructure services:</p> <pre><code>docker compose -f docker-compose.dev.yml up -d \\\n  genjishimada-db-dev \\\n  genjishimada-rabbitmq-dev\n</code></pre>"},{"location":"operations/docker-compose/#ports","title":"Ports","text":"Service Port Description PostgreSQL 65432 Database (host: 127.0.0.1) <p>RabbitMQ management UI is not exposed directly in this repo.</p>"},{"location":"operations/docker-compose/#environment-variables","title":"Environment Variables","text":"<p>Required in <code>.env</code>:</p> <pre><code># PostgreSQL\nPOSTGRES_USER=genjishimada\nPOSTGRES_PASSWORD=dev_password\nPOSTGRES_DB=genjishimada\n\n# RabbitMQ\nRABBITMQ_USER=admin\nRABBITMQ_PASS=dev_password\n\n# API/Bot\nAPP_ENVIRONMENT=development\nAPI_KEY=your_api_key_for_bot\nDISCORD_TOKEN=your_discord_bot_token\n</code></pre>"},{"location":"operations/docker-compose/#verifying-services","title":"Verifying Services","text":"<p>Check service health:</p> <pre><code>docker compose -f docker-compose.dev.yml ps\n</code></pre>"},{"location":"operations/docker-compose/#production-environment","title":"Production Environment","text":""},{"location":"operations/docker-compose/#services_1","title":"Services","text":"<p>The production compose file runs:</p> <pre><code>services:\n  genjishimada-api:      # Litestar API\n  genjishimada-bot:      # Discord bot\n  genjishimada-db:       # PostgreSQL 17\n  genjishimada-rabbitmq: # RabbitMQ\n</code></pre>"},{"location":"operations/docker-compose/#starting-production-services","title":"Starting Production Services","text":"<pre><code>docker compose -f docker-compose.prod.yml up -d\n</code></pre>"},{"location":"operations/docker-compose/#ports_1","title":"Ports","text":"Service Port Description PostgreSQL 55432 Database (host: 127.0.0.1) <p>The API and RabbitMQ are not exposed directly; access is handled via your reverse proxy (e.g., Caddy).</p>"},{"location":"operations/docker-compose/#environment-variables_1","title":"Environment Variables","text":"<p>Create <code>.env</code> in the repository root:</p> <pre><code># Application\nAPP_ENVIRONMENT=production\n\n# Discord\nDISCORD_TOKEN=your_production_bot_token\n\n# PostgreSQL\nPOSTGRES_USER=genjishimada\nPOSTGRES_PASSWORD=secure_production_password\nPOSTGRES_DB=genjishimada\n\n# RabbitMQ\nRABBITMQ_USER=admin\nRABBITMQ_PASS=secure_production_password\n\n# API Authentication\nAPI_KEY=secure_api_key_for_bot\n\n# S3 Storage\nAWS_ACCESS_KEY_ID=your_key\nAWS_SECRET_ACCESS_KEY=your_secret\nR2_ACCOUNT_ID=your_account_id\n\n# Email\nRESEND_API_KEY=your_resend_key\n\n# Monitoring\nSENTRY_DSN=your_sentry_dsn\n</code></pre>"},{"location":"operations/docker-compose/#health-checks","title":"Health Checks","text":"<p>The API health check is:</p> <pre><code>healthcheck:\n  test: [\"CMD\", \"curl\", \"-fsS\", \"http://localhost:8000/healthcheck\"]\n</code></pre>"},{"location":"operations/docker-compose/#viewing-logs","title":"Viewing Logs","text":"<p>All services: <pre><code>docker compose -f docker-compose.prod.yml logs -f\n</code></pre></p> <p>Specific service: <pre><code>docker compose -f docker-compose.prod.yml logs -f genjishimada-api\n</code></pre></p>"},{"location":"operations/docker-compose/#restarting-services","title":"Restarting Services","text":"<pre><code>docker compose -f docker-compose.prod.yml restart genjishimada-api\n</code></pre>"},{"location":"operations/docker-compose/#networking","title":"Networking","text":"<p>Both compose files attach to <code>genji-network</code>:</p> <pre><code>networks:\n  genji-network:\n    external: true\n</code></pre> <p>Create it once if needed:</p> <pre><code>docker network create genji-network\n</code></pre>"},{"location":"operations/docker-compose/#volumes","title":"Volumes","text":"<p>The database and RabbitMQ use named volumes for persistence.</p>"},{"location":"operations/docker-compose/#next-steps","title":"Next Steps","text":"<ul> <li>Infrastructure Guide - Understand the services</li> <li>Operations Overview - Monitoring and backups</li> <li>Bot Configuration - Configure the bot</li> </ul>"},{"location":"operations/identity-and-auth/","title":"Identity &amp; Auth (Keycloak + OAuth2 Proxy)","text":"<p>Genji Shimada uses Keycloak for identity management and oauth2-proxy to protect internal services (Grafana, Prometheus, etc.) behind the reverse proxy. The Keycloak stack lives in <code>bkan0n/genjishimada-oidc</code>, and the reverse proxy routes Keycloak through <code>portal.bkan0n.com</code> and oauth2-proxy through <code>auth.bkan0n.com</code>.</p> <p>This page documents the deployed configuration and how it is wired to the reverse proxy and monitoring stack.</p>"},{"location":"operations/identity-and-auth/#how-it-fits-together","title":"How It Fits Together","text":"<ul> <li>Keycloak provides OIDC issuer at   <code>https://portal.bkan0n.com/realms/master</code>.</li> <li>oauth2-proxy uses Keycloak OIDC to gate monitoring endpoints.</li> <li>Caddy routes <code>portal.bkan0n.com</code> -&gt; <code>keycloak:8080</code> and   <code>auth.bkan0n.com</code> -&gt; <code>oauth2-proxy:4180</code>.</li> <li>Grafana is configured to use Keycloak (see monitoring docs).</li> </ul>"},{"location":"operations/identity-and-auth/#deployment-from-genjishimada-oidc","title":"Deployment (from genjishimada-oidc)","text":"<p>Keycloak and oauth2-proxy run in Docker with the following key settings:</p> <p>Keycloak</p> <ul> <li><code>KC_HOSTNAME=portal.bkan0n.com</code></li> <li><code>KC_PROXY_HEADERS=xforwarded</code></li> <li><code>KC_HTTP_ENABLED=true</code></li> </ul> <p>oauth2-proxy</p> <ul> <li><code>--provider=keycloak-oidc</code></li> <li><code>--client-id=oauth2-proxy</code></li> <li><code>--oidc-issuer-url=https://portal.bkan0n.com/realms/master</code></li> <li><code>--redirect-url=https://auth.bkan0n.com/oauth2/callback</code></li> <li><code>--allowed-group=monitoring</code></li> </ul> <p>Secrets are supplied via environment variables and should not be stored in docs:</p> <ul> <li><code>OAUTH2_PROXY_CLIENT_SECRET</code></li> <li><code>OAUTH2_PROXY_COOKIE_SECRET</code></li> </ul>"},{"location":"operations/identity-and-auth/#admin-console-configuration-summary","title":"Admin Console Configuration Summary","text":"<p>The current Keycloak realm export (redacted) shows:</p> <ul> <li>Realm: <code>master</code></li> <li>Registration: disabled</li> <li>Email login: enabled</li> <li>Required credentials: password</li> <li>OTP: TOTP enabled with 30s period and 6 digits</li> <li>Auth flows: browser, direct grant, and conditional OTP flows enabled</li> </ul> <p>Clients in the realm include built-in admin/account clients and service clients used by Keycloak itself. The oauth2-proxy client is defined in Keycloak and relies on OIDC standard scopes.</p>"},{"location":"operations/identity-and-auth/#roles-and-groups","title":"Roles and Groups","text":"<p>From the export (master realm):</p> <ul> <li>Realm roles:<ul> <li>Built-ins: <code>offline_access</code>, <code>uma_authorization</code>, <code>default-roles-master</code>, <code>admin</code>, <code>create-realm</code>.</li> <li>Grafana roles: <code>grafana-admin</code>, <code>grafana-editor</code>, <code>grafana-viewer</code> (used by Grafana role mapping).</li> <li>RabbitMQ roles:<ul> <li><code>rabbitmq.tag:administrator</code>, <code>rabbitmq.tag:management</code></li> <li><code>rabbitmq.configure:*/*/*</code>, <code>rabbitmq.write:*/*/*</code>, <code>rabbitmq.read:*/*/*</code></li> </ul> </li> </ul> </li> <li>Client roles: standard roles for <code>master-realm</code>, <code>account</code>, and <code>broker</code>.</li> <li>Groups:<ul> <li><code>monitoring</code> (for Grafana/Prometheus/Loki/cAdvisor access)</li> <li><code>RabbitMQ</code> (grants RabbitMQ tag roles)</li> </ul> </li> </ul> <p>If you are using oauth2-proxy group gating (for example <code>--allowed-group=monitoring</code>), make sure a <code>monitoring</code> group exists in the realm and that users are assigned to it.</p>"},{"location":"operations/identity-and-auth/#clients","title":"Clients","text":"<p>The realm includes built-in Keycloak clients plus service clients for internal apps. The notable custom clients are below:</p> <ul> <li>oauth2-proxy<ul> <li>Redirect: <code>https://auth.bkan0n.com/oauth2/callback</code></li> <li>Standard flow enabled, confidential client</li> <li>Default scopes include <code>groups</code> so oauth2-proxy can enforce group gating</li> </ul> </li> <li>grafana-oauth<ul> <li>Root/Admin URL: <code>https://grafana.bkan0n.com</code></li> <li>Redirect: <code>https://grafana.bkan0n.com/login/generic_oauth</code></li> <li>Protocol mappers: realm roles + hardcoded <code>aud=grafana-oauth</code></li> </ul> </li> <li>rabbitmq-prod<ul> <li>Root/Admin URL: <code>https://rabbitmq.genji.pk</code></li> <li>Redirect: <code>https://rabbitmq.genji.pk/*</code></li> <li>Protocol mapper: hardcoded <code>aud=rabbitmq</code></li> </ul> </li> <li>rabbitmq-dev<ul> <li>Root/Admin URL: <code>https://dev-rabbitmq.genji.pk</code></li> <li>Redirect: <code>https://dev-rabbitmq.genji.pk/*</code></li> <li>Protocol mapper: hardcoded <code>aud=rabbitmq</code></li> </ul> </li> </ul> <p>Built-in clients also exist: <code>account</code>, <code>account-console</code>, <code>admin-cli</code>, <code>broker</code>, <code>master-realm</code>, <code>security-admin-console</code>.</p>"},{"location":"operations/identity-and-auth/#client-scopes-and-mappers","title":"Client Scopes and Mappers","text":"<ul> <li>groups client scope adds a <code>groups</code> claim via   <code>oidc-group-membership-mapper</code> (used by oauth2-proxy).</li> <li>grafana-oauth uses realm-role mapping and a hardcoded audience claim.</li> <li>rabbitmq clients include a hardcoded <code>aud</code> claim of <code>rabbitmq</code>.</li> </ul>"},{"location":"operations/identity-and-auth/#related-docs","title":"Related Docs","text":"<ul> <li>Reverse Proxy - Caddy routes and auth wiring</li> <li>Monitoring - Grafana OAuth config</li> </ul>"},{"location":"operations/infrastructure/","title":"Infrastructure","text":"<p>Detailed guide to the infrastructure services that power Genji Shimada.</p>"},{"location":"operations/infrastructure/#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Discord Users  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n    \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502   Discord Bot       \u2502\n    \u2502  (discord.py)       \u2502\n    \u2514\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2518\n      \u2502                \u2502\n      \u2502                \u2502\n \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n \u2502 RabbitMQ \u2502\u25c4\u2500\u2500\u2500\u2524  REST API \u2502\n \u2502          \u2502    \u2502 (Litestar)\u2502\n \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n                       \u2502\n                 \u250c\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                 \u2502 PostgreSQL \u2502\n                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"operations/infrastructure/#postgresql","title":"PostgreSQL","text":""},{"location":"operations/infrastructure/#overview","title":"Overview","text":"<p>PostgreSQL 17 is the primary data store for all persistent data.</p>"},{"location":"operations/infrastructure/#schema-organization","title":"Schema Organization","text":"<p>The database uses multiple schemas for logical separation:</p> <pre><code>genjishimada (database)\n\u251c\u2500\u2500 core              # Users, maps, permissions\n\u251c\u2500\u2500 maps              # Map metadata, ratings\n\u251c\u2500\u2500 completions       # User completion records\n\u251c\u2500\u2500 playtests         # Map playtesting data\n\u251c\u2500\u2500 users             # Profiles, XP, rank cards\n\u251c\u2500\u2500 lootbox           # Lootbox system\n\u251c\u2500\u2500 rank_card         # Rank card customization\n\u2514\u2500\u2500 public            # Jobs, sessions, idempotency\n</code></pre>"},{"location":"operations/infrastructure/#backups","title":"Backups","text":"<p>Create a full backup:</p> <pre><code>pg_dump -U genjishimada -h localhost -p 65432 genjishimada &gt; backup_$(date +%Y%m%d).sql\n</code></pre>"},{"location":"operations/infrastructure/#rabbitmq","title":"RabbitMQ","text":""},{"location":"operations/infrastructure/#overview_1","title":"Overview","text":"<p>RabbitMQ is used for asynchronous message passing between the API and bot.</p> <p>Key Features: - Queue-based messaging for event processing - Dead letter queues (DLQ) for failed messages - Message persistence for reliability - Idempotency tracking to prevent duplicate processing</p>"},{"location":"operations/infrastructure/#queue-naming-convention","title":"Queue Naming Convention","text":"<p>Queues follow the pattern: <code>api.&lt;domain&gt;.&lt;action&gt;</code></p> <p>Examples: - <code>api.completion.submission</code> - <code>api.notification.delivery</code> - <code>api.map_edit.created</code></p>"},{"location":"operations/infrastructure/#monitoring","title":"Monitoring","text":"<p>RabbitMQ is not exposed directly in this repo. Production access is handled via your reverse proxy (e.g., Caddy). For local debugging, use container logs:</p> <pre><code>docker compose -f docker-compose.dev.yml logs -f genjishimada-rabbitmq-dev\n</code></pre>"},{"location":"operations/infrastructure/#cloudflare-r2","title":"Cloudflare R2","text":""},{"location":"operations/infrastructure/#overview_2","title":"Overview","text":"<p>Cloudflare R2 is used for S3-compatible object storage.</p> <p>Use cases: - Completion videos and screenshots - User rank card images - Map thumbnails</p>"},{"location":"operations/infrastructure/#configuration","title":"Configuration","text":"<p>Set environment variables:</p> <pre><code>AWS_ACCESS_KEY_ID=your_key\nAWS_SECRET_ACCESS_KEY=your_secret\nR2_ACCOUNT_ID=your_account_id\n</code></pre>"},{"location":"operations/infrastructure/#bucket-details","title":"Bucket Details","text":"<p>The API uploads screenshots to the <code>genji-parkour-images</code> bucket and returns public URLs via the <code>cdn.bkan0n.com</code> domain.</p>"},{"location":"operations/infrastructure/#sentry","title":"Sentry","text":""},{"location":"operations/infrastructure/#overview_3","title":"Overview","text":"<p>Sentry provides error tracking and performance monitoring.</p>"},{"location":"operations/infrastructure/#configuration_1","title":"Configuration","text":"<p>Set the DSN in <code>.env</code>:</p> <pre><code>SENTRY_DSN=https://your_key@sentry.io/your_project\n</code></pre>"},{"location":"operations/infrastructure/#integration","title":"Integration","text":"<p>API (<code>apps/api/app.py</code>): <pre><code>import sentry_sdk\n\nsentry_sdk.init(\n    dsn=SENTRY_DSN,\n    environment=APP_ENVIRONMENT,\n    traces_sample_rate=0.1,\n)\n</code></pre></p> <p>Bot (<code>apps/bot/main.py</code>): <pre><code>import sentry_sdk\nfrom sentry_sdk.integrations.asyncio import AsyncioIntegration\n\nsentry_sdk.init(\n    dsn=SENTRY_DSN,\n    environment=APP_ENVIRONMENT,\n    integrations=[AsyncioIntegration()],\n)\n</code></pre></p>"},{"location":"operations/infrastructure/#email-resend","title":"Email (Resend)","text":""},{"location":"operations/infrastructure/#overview_4","title":"Overview","text":"<p>Resend is used for transactional email delivery.</p>"},{"location":"operations/infrastructure/#configuration_2","title":"Configuration","text":"<pre><code>RESEND_API_KEY=your_resend_api_key\nRESEND_FROM_EMAIL=noreply@genji.pk\n</code></pre>"},{"location":"operations/infrastructure/#next-steps","title":"Next Steps","text":"<ul> <li>Docker Compose Guide - Deploy these services</li> <li>Reverse Proxy - Caddy routing and TLS for Genji and monitoring</li> <li>Bot Configuration - Configure the bot</li> <li>API Documentation - Understand the API</li> </ul>"},{"location":"operations/monitoring/","title":"Monitoring","text":"<p>Genji Shimada uses a Grafana Alloy-based monitoring stack in a separate repo: <code>genjishimada-monitoring</code>. It collects metrics and logs from the host and Docker containers, stores metrics in Prometheus and logs in Loki, and exposes dashboards through Grafana.</p>"},{"location":"operations/monitoring/#what-it-includes","title":"What It Includes","text":"<ul> <li>Grafana Alloy for metrics and log collection.</li> <li>Prometheus for metrics storage and queries.</li> <li>Loki for log storage and queries.</li> <li>cAdvisor for Docker container metrics.</li> <li>Grafana dashboards and alerting UI.</li> </ul>"},{"location":"operations/monitoring/#setup-brief","title":"Setup (Brief)","text":"<ol> <li>Clone the monitoring repo on the server:</li> </ol> <pre><code>git clone https://github.com/bkan0n/genjishimada-monitoring.git\ncd genjishimada-monitoring\n</code></pre> <ol> <li>Create the external network for your reverse proxy (Caddy):</li> </ol> <pre><code>docker network create caddy-network\n</code></pre> <ol> <li>Copy and edit the env file:</li> </ol> <pre><code>cp .env.example .env\n</code></pre> <p>Set: - <code>HOSTNAME</code> to your server hostname (used as a label in metrics/logs). - <code>GRAFANA_ADMIN_PASSWORD</code> to a strong password. - <code>TZ</code> if you want consistent dashboard timestamps.</p> <ol> <li>Start the stack:</li> </ol> <pre><code>docker compose up -d\n</code></pre>"},{"location":"operations/monitoring/#grafana-access-and-auth","title":"Grafana Access and Auth","text":"<p>Grafana is configured for Keycloak OAuth in <code>config/grafana/grafana.ini</code>. If you are not using the same Keycloak domain, update the <code>auth.generic_oauth</code> section (client id, URLs, and redirect targets), or disable OAuth and use basic auth.</p> <p>By default, Grafana listens on port 3000. If you front it with Caddy, route the public domain to the <code>grafana</code> service on the <code>caddy-network</code>.</p>"},{"location":"operations/monitoring/#what-to-expect","title":"What to Expect","text":"<ul> <li>Dashboards are auto-provisioned from <code>dashboards/</code>:</li> <li>Docker Containers (CPU, memory, network, tables)</li> <li>Host System Metrics (CPU, memory, disk, network)</li> <li>Logs Explorer (container logs + journald + host logs)</li> <li>Datasources are pre-provisioned:</li> <li>Prometheus at <code>http://prometheus:9090</code></li> <li>Loki at <code>http://loki:3100</code></li> <li>Log sources include Docker containers, systemd journal, and <code>/var/log</code>.</li> <li>Alloy UI is available at <code>http://localhost:12345</code> for debugging.</li> </ul>"},{"location":"operations/monitoring/#notes","title":"Notes","text":"<ul> <li>Alloy runs with elevated permissions and mounts host paths for metrics/logs.</li> <li>If you are not running a reverse proxy, Grafana is still reachable at   <code>http://localhost:3000</code> on the host.</li> </ul>"},{"location":"operations/reverse-proxy/","title":"Reverse Proxy (Caddy)","text":"<p>Genji Shimada relies on a shared Caddy reverse proxy that also fronts the monitoring stack and other services. The reverse proxy lives in a separate repo: <code>bkan0n/reverse-proxy</code>. This page explains how it connects to Genji Shimada and which environment variables are required.</p>"},{"location":"operations/reverse-proxy/#how-it-fits-together","title":"How It Fits Together","text":"<p>The reverse proxy runs on the same Docker host and attaches to multiple external networks so it can route traffic to:</p> <ul> <li>Genji services on <code>genji-network</code></li> <li>Monitoring stack on <code>caddy-network</code></li> <li>Other stacks (bkan0n, doom, etc.)</li> </ul> <p>This means the Genji API, RabbitMQ UI, and monitoring endpoints are reachable through the same proxy and share TLS automation via Cloudflare DNS.</p>"},{"location":"operations/reverse-proxy/#genji-routes","title":"Genji Routes","text":"<p>From <code>Caddyfile</code>:</p> <ul> <li><code>api.genji.pk</code> -&gt; <code>genjishimada-api:8000</code></li> <li><code>dev-api.genji.pk</code> -&gt; <code>genjishimada-api-dev:8000</code></li> <li><code>rabbitmq.genji.pk</code> -&gt; <code>genjishimada-rabbitmq:15672</code></li> <li><code>dev-rabbitmq.genji.pk</code> -&gt; <code>genjishimada-rabbitmq-dev:15672</code></li> <li><code>genji.pk</code> / <code>dev.genji.pk</code> -&gt; web containers</li> <li><code>db.genji.pk</code> -&gt; <code>visualdb:80</code></li> </ul>"},{"location":"operations/reverse-proxy/#monitoring-routes","title":"Monitoring Routes","text":"<p>The reverse proxy exposes the monitoring stack and protects some endpoints with OAuth2 proxy auth:</p> <ul> <li><code>grafana.bkan0n.com</code> -&gt; <code>grafana:3000</code></li> <li><code>prometheus.bkan0n.com</code> -&gt; <code>prometheus:9090</code> (auth)</li> <li><code>loki.bkan0n.com</code> -&gt; <code>loki:3100</code> (auth)</li> <li><code>alloy.bkan0n.com</code> -&gt; <code>alloy:12345</code> (auth)</li> <li><code>cadvisor.bkan0n.com</code> -&gt; <code>cadvisor:8080</code> (auth)</li> <li><code>auth.bkan0n.com</code> -&gt; <code>oauth2-proxy:4180</code></li> <li><code>portal.bkan0n.com</code> -&gt; <code>keycloak:8080</code></li> </ul> <p>Keycloak is already wired through the proxy for auth-related services.</p>"},{"location":"operations/reverse-proxy/#required-environment-variables","title":"Required Environment Variables","text":"<p>These env vars are used by the reverse proxy for Cloudflare DNS-01 TLS automation. They are required for Caddy to issue and renew certificates:</p> <ul> <li><code>BKAN0N_COM_CF_API_TOKEN</code> - Certificates for <code>bkan0n.com</code> and subdomains.</li> <li><code>GENJI_PK_CF_API_TOKEN</code> - Certificates for <code>genji.pk</code> and subdomains.</li> <li><code>YOUNGNEBULA_COM_CF_API_TOKEN</code> - Certificates for <code>youngnebula.com</code>.</li> <li><code>DOOM_PK_CF_API_TOKEN</code> - Certificates for <code>doom.pk</code>.</li> <li><code>FROMSKYTOCENTER_COM_CF_API_TOKEN</code> - Certificates for <code>fromskytocenter.com</code>.</li> <li><code>WAITFORMEIN_SPACE_CF_API_TOKEN</code> - Certificates for <code>waitformein.space</code>.</li> </ul>"},{"location":"operations/reverse-proxy/#genji-service-environment-notes","title":"Genji Service Environment Notes","text":"<p>These Genji services are routed through the proxy and need to be reachable on the <code>genji-network</code>:</p> <ul> <li>API container (<code>genjishimada-api</code> / <code>genjishimada-api-dev</code>)</li> <li>RabbitMQ management UI (<code>genjishimada-rabbitmq</code> / <code>genjishimada-rabbitmq-dev</code>)</li> <li>Web container (<code>genjishimada-web</code> / <code>genjishimada-web-dev</code>)</li> </ul> <p>If you change service names or ports in your compose files, update the <code>Caddyfile</code> routes accordingly.</p>"},{"location":"operations/reverse-proxy/#related-docs","title":"Related Docs","text":"<ul> <li>Monitoring - Grafana Alloy stack details</li> <li>Docker Compose - Genji service deployment</li> </ul>"},{"location":"sdk/","title":"SDK Documentation","text":"<p>The Genji Shimada SDK (<code>genjishimada-sdk</code>) is a shared library containing msgspec Struct definitions used across the API and bot.</p>"},{"location":"sdk/#overview","title":"Overview","text":"<p>The SDK provides:</p> <ul> <li>Type-safe data models using msgspec</li> <li>Shared validation logic between services</li> <li>Fast serialization/deserialization with msgspec</li> <li>IDE auto-completion for all data structures</li> </ul>"},{"location":"sdk/#package-structure","title":"Package Structure","text":"<pre><code>libs/sdk/\n\u251c\u2500\u2500 src/\n\u2502   \u2514\u2500\u2500 genjishimada_sdk/\n\u2502       \u251c\u2500\u2500 __init__.py\n\u2502       \u251c\u2500\u2500 maps.py          # Map-related models\n\u2502       \u251c\u2500\u2500 completions.py   # Completion models\n\u2502       \u251c\u2500\u2500 users.py         # User profile models\n\u2502       \u251c\u2500\u2500 notifications.py # Notification models\n\u2502       \u251c\u2500\u2500 lootbox.py       # Lootbox models\n\u2502       \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 pyproject.toml\n</code></pre>"},{"location":"sdk/#why-msgspec","title":"Why msgspec?","text":"<p>The SDK uses msgspec instead of Pydantic for several reasons:</p> <ul> <li>Performance - Fast serialization</li> <li>Smaller memory footprint - Efficient encoding</li> <li>Type safety - Strict validation at runtime</li> <li>Minimal overhead - Lightweight dependency graph</li> </ul>"},{"location":"sdk/#installation","title":"Installation","text":"<p>The SDK is installed automatically when you run:</p> <pre><code>just setup\n</code></pre>"},{"location":"sdk/#quick-example","title":"Quick Example","text":"<pre><code>import msgspec\nfrom genjishimada_sdk.users import UserCreateRequest\n\npayload = UserCreateRequest(\n    id=1234567890,\n    global_name=\"Player\",\n    nickname=\"Player\",\n)\n\njson_bytes = msgspec.json.encode(payload)\n</code></pre>"},{"location":"sdk/#next-steps","title":"Next Steps","text":"<ul> <li>SDK Reference - Auto-generated API docs</li> <li>Usage Examples - Common patterns and recipes</li> <li>API Documentation - See how the API uses the SDK</li> <li>Bot Architecture - Learn about message queue integration</li> </ul>"},{"location":"sdk/usage/","title":"SDK Usage","text":"<p>Common patterns and examples for using the Genji Shimada SDK.</p>"},{"location":"sdk/usage/#installation","title":"Installation","text":"<p>The SDK is a workspace member and is available automatically in API and bot code after:</p> <pre><code>just setup\n</code></pre>"},{"location":"sdk/usage/#basic-usage","title":"Basic Usage","text":""},{"location":"sdk/usage/#import-models","title":"Import Models","text":"<pre><code>from genjishimada_sdk.users import UserCreateRequest, UserResponse\nfrom genjishimada_sdk.maps import MapResponse\nfrom genjishimada_sdk.completions import CompletionResponse\n</code></pre>"},{"location":"sdk/usage/#create-instances","title":"Create Instances","text":"<p>Use request models when constructing payloads:</p> <pre><code>from genjishimada_sdk.users import UserCreateRequest\n\npayload = UserCreateRequest(\n    id=1234567890,\n    global_name=\"Player\",\n    nickname=\"Player\",\n)\n</code></pre>"},{"location":"sdk/usage/#deserialize-api-responses","title":"Deserialize API Responses","text":"<pre><code>import msgspec\nimport httpx\nfrom genjishimada_sdk.maps import MapResponse\n\nasync with httpx.AsyncClient() as client:\n    response = await client.get(\n        \"https://api.genji.pk/api/v3/maps/ABC123\",\n        headers={\"X-API-KEY\": api_key},\n    )\n\n    map_data = msgspec.json.decode(response.content, type=MapResponse)\n    print(map_data.map_name, map_data.difficulty)\n</code></pre>"},{"location":"sdk/usage/#api-patterns","title":"API Patterns","text":""},{"location":"sdk/usage/#request-handlers","title":"Request Handlers","text":"<p>Use SDK models for request/response bodies:</p> <pre><code>from litestar import post\nfrom genjishimada_sdk.users import UserCreateRequest, UserResponse\n\n@post(\"/users\")\nasync def create_user(data: UserCreateRequest) -&gt; UserResponse:\n    # Insert into database and return a UserResponse\n    return await create_user_in_db(data)\n</code></pre>"},{"location":"sdk/usage/#publishing-events","title":"Publishing Events","text":"<p>Publish SDK event models to RabbitMQ:</p> <pre><code>from genjishimada_sdk.completions import CompletionCreatedEvent\nfrom di.base import BaseService\n\nclass CompletionsService(BaseService):\n    async def create_completion(self, user_id: int, map_id: int) -&gt; int:\n        completion_id = await insert_completion(...)\n\n        event = CompletionCreatedEvent(\n            completion_id=completion_id,\n        )\n\n        await self.publish_message(\n            queue_name=\"api.completion.submission\",\n            message=event,\n        )\n\n        return completion_id\n</code></pre>"},{"location":"sdk/usage/#bot-patterns","title":"Bot Patterns","text":""},{"location":"sdk/usage/#queue-consumers","title":"Queue Consumers","text":"<p>Consume SDK event models from RabbitMQ:</p> <pre><code>from extensions._queue_registry import queue_consumer\nfrom genjishimada_sdk.completions import CompletionCreatedEvent\nfrom aio_pika.abc import AbstractIncomingMessage\n\n@queue_consumer(\n    \"api.completion.submission\",\n    struct_type=CompletionCreatedEvent,\n    idempotent=True,\n)\nasync def handle_completion(\n    self,\n    event: CompletionCreatedEvent,\n    message: AbstractIncomingMessage,\n) -&gt; None:\n    print(f\"Completion {event.completion_id} submitted\")\n</code></pre>"},{"location":"sdk/usage/#validation","title":"Validation","text":""},{"location":"sdk/usage/#type-validation","title":"Type Validation","text":"<p><code>msgspec</code> validates types at runtime:</p> <pre><code>from genjishimada_sdk.users import UserCreateRequest\n\n# Valid\npayload = UserCreateRequest(id=1, global_name=\"Player\", nickname=\"Player\")\n\n# Invalid - raises ValidationError\npayload = UserCreateRequest(id=\"not_an_int\", global_name=\"Player\", nickname=\"Player\")\n</code></pre>"},{"location":"sdk/usage/#advanced-patterns","title":"Advanced Patterns","text":""},{"location":"sdk/usage/#partial-updates","title":"Partial Updates","text":"<p>Use dictionaries for partial updates:</p> <pre><code>import msgspec\nfrom genjishimada_sdk.users import UserResponse\n\nuser = UserResponse(id=1, global_name=\"Player\", nickname=\"Player\", overwatch_usernames=None)\nupdates = {\"coins\": 200}\nupdated_user = msgspec.structs.replace(user, **updates)\n</code></pre>"},{"location":"sdk/usage/#next-steps","title":"Next Steps","text":"<ul> <li>API Documentation - See SDK models in API endpoints</li> <li>Bot Messaging - Event-driven patterns</li> </ul>"},{"location":"sdk/reference/","title":"SDK Reference","text":"<p>This section is generated automatically from the SDK source using mkdocstrings.</p> <p>Use the pages below to browse each SDK module and its models.</p>"},{"location":"sdk/reference/auth/","title":"Auth","text":""},{"location":"sdk/reference/auth/#genjishimada_sdk.auth","title":"<code>genjishimada_sdk.auth</code>","text":"<p>Authentication models for email-based users.</p>"},{"location":"sdk/reference/auth/#genjishimada_sdk.auth.AuthUserResponse","title":"<code>AuthUserResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Response after successful authentication.</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>int</code> <p>User ID (9-15 digits for email users, 17-19 for Discord).</p> <code>email</code> <code>str</code> <p>User's email address.</p> <code>username</code> <code>str</code> <p>Display name.</p> <code>email_verified</code> <code>bool</code> <p>Whether email is verified.</p> <code>coins</code> <code>int</code> <p>Current coin balance.</p> <code>is_mod</code> <code>bool</code> <p>Whether user has moderator/admin permissions.</p>"},{"location":"sdk/reference/auth/#genjishimada_sdk.auth.EmailAuthStatus","title":"<code>EmailAuthStatus</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Email verification status for a user.</p> <p>Attributes:</p> Name Type Description <code>email_verified</code> <code>bool</code> <p>Whether the user's email is verified.</p> <code>email</code> <code>str</code> <p>The user's email address (partially masked).</p>"},{"location":"sdk/reference/auth/#genjishimada_sdk.auth.EmailLoginRequest","title":"<code>EmailLoginRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Payload for email-based login.</p> <p>Attributes:</p> Name Type Description <code>email</code> <code>str</code> <p>User's email address.</p> <code>password</code> <code>str</code> <p>Plaintext password to verify.</p>"},{"location":"sdk/reference/auth/#genjishimada_sdk.auth.EmailRegisterRequest","title":"<code>EmailRegisterRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Payload for registering a new email-based user.</p> <p>Attributes:</p> Name Type Description <code>email</code> <code>str</code> <p>User's email address.</p> <code>password</code> <code>str</code> <p>Plaintext password (will be hashed server-side).</p> <code>username</code> <code>str</code> <p>Display name (stored in global_name/nickname).</p>"},{"location":"sdk/reference/auth/#genjishimada_sdk.auth.EmailVerifyRequest","title":"<code>EmailVerifyRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Payload for email verification.</p> <p>Attributes:</p> Name Type Description <code>token</code> <code>str</code> <p>The verification token from the email link.</p>"},{"location":"sdk/reference/auth/#genjishimada_sdk.auth.PasswordResetConfirmRequest","title":"<code>PasswordResetConfirmRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Payload for completing password reset.</p> <p>Attributes:</p> Name Type Description <code>token</code> <code>str</code> <p>The reset token from the email link.</p> <code>password</code> <code>str</code> <p>New plaintext password.</p>"},{"location":"sdk/reference/auth/#genjishimada_sdk.auth.PasswordResetRequest","title":"<code>PasswordResetRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Payload for initiating password reset.</p> <p>Attributes:</p> Name Type Description <code>email</code> <code>str</code> <p>User's email address.</p>"},{"location":"sdk/reference/auth/#genjishimada_sdk.auth.SessionInfo","title":"<code>SessionInfo</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Information about an active session.</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>str</code> <p>Session ID.</p> <code>last_activity</code> <code>str | None</code> <p>Last activity timestamp (ISO format).</p> <code>ip_address</code> <code>str | None</code> <p>Client IP address.</p> <code>user_agent</code> <code>str | None</code> <p>Client user agent string.</p>"},{"location":"sdk/reference/auth/#genjishimada_sdk.auth.SessionReadResponse","title":"<code>SessionReadResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Response from reading a session.</p> <p>Attributes:</p> Name Type Description <code>payload</code> <code>str | None</code> <p>Base64-encoded session data (null if not found).</p> <code>is_mod</code> <code>bool</code> <p>Whether the authenticated user has moderator permissions.</p>"},{"location":"sdk/reference/auth/#genjishimada_sdk.auth.SessionWriteRequest","title":"<code>SessionWriteRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Payload for writing session data.</p> <p>Attributes:</p> Name Type Description <code>payload</code> <code>str</code> <p>Base64-encoded session data.</p> <code>user_id</code> <code>int | None</code> <p>Optional authenticated user ID.</p>"},{"location":"sdk/reference/completions/","title":"Completions","text":""},{"location":"sdk/reference/completions/#genjishimada_sdk.completions","title":"<code>genjishimada_sdk.completions</code>","text":""},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.CamelConfig","title":"<code>CamelConfig</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Base struct that renames fields to camelCase during encoding/decoding.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.CompletionCreateRequest","title":"<code>CompletionCreateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for submitting a completion.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>user_id</code> <code>int</code> <p>Identifier for the submitting user.</p> <code>time</code> <code>float</code> <p>Completion time in seconds.</p> <code>screenshot</code> <code>GuideURL</code> <p>Proof screenshot URL.</p> <code>video</code> <code>GuideURL | None</code> <p>Optional video proof URL.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.CompletionCreateRequest2","title":"<code>CompletionCreateRequest2</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for submitting a completion.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>user_id</code> <code>int</code> <p>Identifier for the submitting user.</p> <code>time</code> <code>float</code> <p>Completion time in seconds.</p> <code>screenshot</code> <code>GuideURL</code> <p>Proof screenshot URL.</p> <code>video</code> <code>GuideURL | None</code> <p>Optional video proof URL.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.CompletionCreatedEvent","title":"<code>CompletionCreatedEvent</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Event emitted when a completion is created.</p> <p>Attributes:</p> Name Type Description <code>completion_id</code> <code>int</code> <p>Identifier of the new completion.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.CompletionModerateRequest","title":"<code>CompletionModerateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request for moderating a completion record.</p> <p>Attributes:</p> Name Type Description <code>moderated_by</code> <code>int</code> <p>Identifier of the moderator making the change.</p> <code>time</code> <code>float | UnsetType</code> <p>New completion time in seconds.</p> <code>time_change_reason</code> <code>str | UnsetType</code> <p>Required reason for changing the time.</p> <code>verified</code> <code>bool | UnsetType</code> <p>Whether the completion should be verified.</p> <code>verification_reason</code> <code>str | None | UnsetType</code> <p>Optional reason for verification change.</p> <code>mark_suspicious</code> <code>bool</code> <p>Whether to mark the completion as suspicious.</p> <code>unmark_suspicious</code> <code>bool</code> <p>Whether to unmark the completion as suspicious.</p> <code>suspicious_context</code> <code>str | UnsetType</code> <p>Context for marking as suspicious (required if mark_suspicious is True).</p> <code>suspicious_flag_type</code> <code>SuspiciousFlag | UnsetType</code> <p>Flag type for suspicious marking.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.CompletionPatchRequest","title":"<code>CompletionPatchRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Partial update payload for completion records.</p> <p>Attributes:</p> Name Type Description <code>message_id</code> <code>int | UnsetType</code> <p>Discord message identifier for the submission.</p> <code>completion</code> <code>bool | UnsetType</code> <p>Flag indicating completion status.</p> <code>verification_id</code> <code>int | UnsetType</code> <p>Identifier linking to verification metadata.</p> <code>legacy</code> <code>bool | UnsetType</code> <p>Whether the record predates current validation rules.</p> <code>legacy_medal</code> <code>str | None | UnsetType</code> <p>Medal tier used for legacy records.</p> <code>wr_xp_check</code> <code>bool | UnsetType</code> <p>Whether to perform world-record XP validation.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.CompletionResponse","title":"<code>CompletionResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Represents a completion entry with verification metadata.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>user_id</code> <code>int</code> <p>Identifier for the completing user.</p> <code>name</code> <code>str</code> <p>Display name of the runner.</p> <code>also_known_as</code> <code>str | None</code> <p>Alternate display name if available.</p> <code>time</code> <code>float</code> <p>Completion time in seconds.</p> <code>screenshot</code> <code>str</code> <p>Screenshot URL for proof.</p> <code>video</code> <code>GuideURL | None</code> <p>Optional video URL for proof.</p> <code>completion</code> <code>bool</code> <p>Whether the run qualifies as a completion.</p> <code>verified</code> <code>bool</code> <p>Whether the completion has been staff verified.</p> <code>rank</code> <code>int | None</code> <p>Leaderboard rank if available.</p> <code>medal</code> <code>MedalType | None</code> <p>Awarded medal tier for the run.</p> <code>map_name</code> <code>OverwatchMap</code> <p>Name of the Overwatch map.</p> <code>difficulty</code> <code>DifficultyAll</code> <p>Difficulty rating for the map.</p> <code>message_id</code> <code>int</code> <p>Discord message ID tied to the submission.</p> <code>legacy</code> <code>bool</code> <p>Whether the record predates current validation rules.</p> <code>legacy_medal</code> <code>MedalType | None</code> <p>Medal tier used for legacy records.</p> <code>suspicious</code> <code>bool</code> <p>Whether the run has raised suspicion flags.</p> <code>total_results</code> <code>int | None</code> <p>Total number of records in the query, when paginated.</p> <code>upvotes</code> <code>int</code> <p>Current upvote total for the submission.</p> <code>id</code> <code>int | None</code> <p>Completion record identifier (optional, used for moderation).</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.CompletionSubmissionJobResponse","title":"<code>CompletionSubmissionJobResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Job response for completion submissions.</p> <p>Attributes:</p> Name Type Description <code>job_status</code> <code>JobStatusResponse | None</code> <p>Asynchronous processing status for the submission.</p> <code>completion_id</code> <code>int</code> <p>Identifier of the submitted completion.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.CompletionSubmissionResponse","title":"<code>CompletionSubmissionResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Submission response returned immediately after creating a run.</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>int</code> <p>Identifier of the new submission.</p> <code>user_id</code> <code>int</code> <p>Identifier for the submitting user.</p> <code>time</code> <code>float</code> <p>Completion time in seconds.</p> <code>screenshot</code> <code>str</code> <p>Screenshot URL for proof.</p> <code>video</code> <code>GuideURL | None</code> <p>Optional video URL for proof.</p> <code>verified</code> <code>bool</code> <p>Whether the submission has been verified.</p> <code>completion</code> <code>bool</code> <p>Whether the run qualifies as a completion.</p> <code>inserted_at</code> <code>datetime</code> <p>Timestamp when the submission was recorded.</p> <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>difficulty</code> <code>DifficultyAll</code> <p>Difficulty rating for the map.</p> <code>map_name</code> <code>OverwatchMap</code> <p>Name of the Overwatch map.</p> <code>hypothetical_rank</code> <code>int | None</code> <p>Expected leaderboard rank if verified.</p> <code>hypothetical_medal</code> <code>MedalType | None</code> <p>Expected medal tier if verified.</p> <code>name</code> <code>str</code> <p>Display name of the runner.</p> <code>also_known_as</code> <code>str</code> <p>Alternate display name if available.</p> <code>verified_by</code> <code>int | None</code> <p>Identifier of the verifier, if verified.</p> <code>verification_id</code> <code>int | None</code> <p>Verification entry ID, if applicable.</p> <code>message_id</code> <code>int | None</code> <p>Discord message ID tied to the submission.</p> <code>suspicious</code> <code>bool</code> <p>Whether the run has raised suspicion flags.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.CompletionVerificationUpdateRequest","title":"<code>CompletionVerificationUpdateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Update verification metadata for a completion.</p> <p>Attributes:</p> Name Type Description <code>verified_by</code> <code>int</code> <p>Identifier of the staff member performing the verification.</p> <code>verified</code> <code>bool</code> <p>Whether the completion has been verified.</p> <code>reason</code> <code>str | None</code> <p>Optional reasoning for verification changes.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.ExtractedResultResponse","title":"<code>ExtractedResultResponse</code>","text":"<p>               Bases: <code>CamelConfig</code></p> <p>OCR output summarizing detected result details.</p> <p>Attributes:</p> Name Type Description <code>name</code> <code>str | None</code> <p>Detected player name, if any.</p> <code>time</code> <code>float | None</code> <p>Detected completion time in seconds.</p> <code>code</code> <code>str | None</code> <p>Detected workshop code.</p> <code>texts</code> <code>ExtractedTextsResponse</code> <p>Raw extracted text blocks from the image.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.ExtractedTextsResponse","title":"<code>ExtractedTextsResponse</code>","text":"<p>               Bases: <code>CamelConfig</code></p> <p>OCR text snippets extracted from a screenshot.</p> <p>Attributes:</p> Name Type Description <code>top_left</code> <code>str | None</code> <p>Raw text detected in the top-left area.</p> <code>top_left_white</code> <code>str | None</code> <p>White-colored text detected in the top-left area.</p> <code>top_left_cyan</code> <code>str | None</code> <p>Cyan-colored text detected in the top-left area.</p> <code>banner</code> <code>str | None</code> <p>Text detected in the banner region.</p> <code>top_right</code> <code>str | None</code> <p>Raw text detected in the top-right area.</p> <code>bottom_left</code> <code>str | None</code> <p>Raw text detected in the bottom-left area.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.FailedAutoverifyEvent","title":"<code>FailedAutoverifyEvent</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Event fired when automatic verification fails after OCR.</p> <p>Attributes:</p> Name Type Description <code>submitted_code</code> <code>OverwatchCode</code> <p>Workshop code submitted by the user.</p> <code>submitted_time</code> <code>float</code> <p>Completion time submitted by the user.</p> <code>user_id</code> <code>int</code> <p>Identifier of the submitting user.</p> <code>extracted</code> <code>ExtractedResultResponse</code> <p>OCR results extracted from the proof.</p> <code>code_match</code> <code>bool</code> <p>Whether the extracted code matched the submission.</p> <code>time_match</code> <code>bool</code> <p>Whether the extracted time matched the submission.</p> <code>user_match</code> <code>bool</code> <p>Whether the extracted user matched the submission.</p> <code>extracted_code_cleaned</code> <code>str | None</code> <p>Normalized code detected via OCR.</p> <code>extracted_time</code> <code>float | None</code> <p>Time detected via OCR.</p> <code>extracted_user_id</code> <code>float | None</code> <p>User identifier detected via OCR.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.MapRecordProgressionResponse","title":"<code>MapRecordProgressionResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Represents a historical record progression for a map.</p> <p>Attributes:</p> Name Type Description <code>time</code> <code>float</code> <p>Completion time in seconds.</p> <code>inserted_at</code> <code>datetime</code> <p>Timestamp when the record was recorded.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.OcrResponse","title":"<code>OcrResponse</code>","text":"<p>               Bases: <code>CamelConfig</code></p> <p>Top-level OCR response payload.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.PendingVerificationResponse","title":"<code>PendingVerificationResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Represents a completion waiting for verification.</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>int</code> <p>Identifier of the completion submission.</p> <code>verification_id</code> <code>int</code> <p>Identifier of the verification entry.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.QualityUpdateRequest","title":"<code>QualityUpdateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for submitting a quality rating.</p> <p>Attributes:</p> Name Type Description <code>user_id</code> <code>int</code> <p>Identifier of the user submitting the rating.</p> <code>quality</code> <code>Annotated[int, Meta(ge=1, le=6)]</code> <p>Numeric quality score between 1 and 6 inclusive.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.SuspiciousCompletionCreateRequest","title":"<code>SuspiciousCompletionCreateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for flagging a completion as suspicious.</p> <p>Attributes:</p> Name Type Description <code>context</code> <code>str</code> <p>Explanation of why the run is suspicious.</p> <code>flag_type</code> <code>SuspiciousFlag</code> <p>Category for the suspicion (e.g., cheating).</p> <code>flagged_by</code> <code>int</code> <p>Identifier of the moderator setting the flag.</p> <code>message_id</code> <code>int | None</code> <p>Discord message ID associated with the run.</p> <code>verification_id</code> <code>int | None</code> <p>Verification record ID, if applicable.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.SuspiciousCompletionResponse","title":"<code>SuspiciousCompletionResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Represents a stored suspicious completion entry.</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>int</code> <p>Identifier of the suspicious record.</p> <code>user_id</code> <code>int</code> <p>Identifier of the flagged user.</p> <code>context</code> <code>str</code> <p>Explanation of why the run is suspicious.</p> <code>flag_type</code> <code>SuspiciousFlag</code> <p>Category for the suspicion (e.g., cheating).</p> <code>message_id</code> <code>int | None</code> <p>Discord message ID associated with the run.</p> <code>verification_id</code> <code>int | None</code> <p>Verification record ID, if applicable.</p> <code>flagged_by</code> <code>int</code> <p>Identifier of the moderator setting the flag.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.TimePlayedPerRankResponse","title":"<code>TimePlayedPerRankResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Aggregated time played per rank bucket.</p> <p>Attributes:</p> Name Type Description <code>total_seconds</code> <code>float</code> <p>Total time played in seconds.</p> <code>difficulty</code> <code>DifficultyTop</code> <p>Rank or difficulty bucket represented.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.UpvoteCreateRequest","title":"<code>UpvoteCreateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for adding an upvote to a completion.</p> <p>Attributes:</p> Name Type Description <code>user_id</code> <code>int</code> <p>Identifier of the user casting the upvote.</p> <code>message_id</code> <code>int</code> <p>Discord message identifier for the completion message.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.UpvoteSubmissionJobResponse","title":"<code>UpvoteSubmissionJobResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Job response for upvote submissions.</p> <p>Attributes:</p> Name Type Description <code>job_status</code> <code>JobStatusResponse | None</code> <p>Asynchronous processing status for the upvote.</p> <code>upvotes</code> <code>int | None</code> <p>Updated upvote total after processing.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.UpvoteUpdateEvent","title":"<code>UpvoteUpdateEvent</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Event emitted when a completion's upvotes change.</p> <p>Attributes:</p> Name Type Description <code>user_id</code> <code>int</code> <p>Identifier of the user that triggered the change.</p> <code>message_id</code> <code>int</code> <p>Discord message identifier for the completion.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.VerificationChangedEvent","title":"<code>VerificationChangedEvent</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Event emitted when a completion's verification changes.</p> <p>Attributes:</p> Name Type Description <code>completion_id</code> <code>int</code> <p>Identifier of the affected completion.</p> <code>verified</code> <code>bool</code> <p>New verification state.</p> <code>verified_by</code> <code>int</code> <p>Identifier of the verifier.</p> <code>reason</code> <code>str | None</code> <p>Optional reason for the change.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.WorldRecordXPCheckResponse","title":"<code>WorldRecordXPCheckResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Result of checking whether a completion grants world-record XP.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>user_id</code> <code>int</code> <p>Identifier of the runner.</p>"},{"location":"sdk/reference/completions/#genjishimada_sdk.completions.to_camel","title":"<code>to_camel(name)</code>","text":"<p>Convert a snake_case field name to camelCase.</p>"},{"location":"sdk/reference/lootbox/","title":"Lootbox","text":""},{"location":"sdk/reference/lootbox/#genjishimada_sdk.lootbox","title":"<code>genjishimada_sdk.lootbox</code>","text":""},{"location":"sdk/reference/lootbox/#genjishimada_sdk.lootbox.LootboxKeyTypeResponse","title":"<code>LootboxKeyTypeResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Represents a lootbox key type.</p> <p>Attributes:</p> Name Type Description <code>name</code> <code>str</code> <p>Name of the key type.</p>"},{"location":"sdk/reference/lootbox/#genjishimada_sdk.lootbox.RewardTypeResponse","title":"<code>RewardTypeResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Reward definition returned from lootbox operations.</p> <p>Attributes:</p> Name Type Description <code>name</code> <code>str</code> <p>Display name of the reward.</p> <code>key_type</code> <code>LootboxKeyType</code> <p>Lootbox key type associated with the reward.</p> <code>rarity</code> <code>str</code> <p>Rarity tier of the reward.</p> <code>type</code> <code>str</code> <p>Reward category (e.g., spray, skin).</p> <code>duplicate</code> <code>bool</code> <p>Whether the reward is a duplicate.</p> <code>coin_amount</code> <code>int</code> <p>Coin payout when receiving a duplicate reward.</p> <code>url</code> <code>str | None</code> <p>Asset URL associated with the reward.</p>"},{"location":"sdk/reference/lootbox/#genjishimada_sdk.lootbox.RewardTypeResponse.__post_init__","title":"<code>__post_init__()</code>","text":"<p>Compute the asset URL for the reward.</p>"},{"location":"sdk/reference/lootbox/#genjishimada_sdk.lootbox.UserLootboxKeyAmountResponse","title":"<code>UserLootboxKeyAmountResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Amount of lootbox keys a user currently holds.</p> <p>Attributes:</p> Name Type Description <code>key_type</code> <code>LootboxKeyType</code> <p>Type of key counted.</p> <code>amount</code> <code>int</code> <p>Number of keys available.</p>"},{"location":"sdk/reference/lootbox/#genjishimada_sdk.lootbox.UserRewardResponse","title":"<code>UserRewardResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Represents a reward granted to a user.</p> <p>Attributes:</p> Name Type Description <code>user_id</code> <code>int</code> <p>Identifier of the rewarded user.</p> <code>earned_at</code> <code>datetime</code> <p>Timestamp when the reward was earned.</p> <code>name</code> <code>str</code> <p>Name of the reward item.</p> <code>type</code> <code>str</code> <p>Reward category (e.g., mastery, spray).</p> <code>rarity</code> <code>str</code> <p>Rarity tier of the reward.</p> <code>medal</code> <code>str | None</code> <p>Medal tier when the reward relates to mastery.</p> <code>url</code> <code>str | None</code> <p>Asset URL associated with the reward.</p>"},{"location":"sdk/reference/lootbox/#genjishimada_sdk.lootbox.UserRewardResponse.__post_init__","title":"<code>__post_init__()</code>","text":"<p>Compute the asset URL for the reward.</p>"},{"location":"sdk/reference/maps/","title":"Maps","text":""},{"location":"sdk/reference/maps/#genjishimada_sdk.maps","title":"<code>genjishimada_sdk.maps</code>","text":""},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.ArchivalStatusPatchRequest","title":"<code>ArchivalStatusPatchRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Bulk update for map archival status.</p> <p>Attributes:</p> Name Type Description <code>codes</code> <code>list[OverwatchCode]</code> <p>Workshop codes to update.</p> <code>status</code> <code>Literal['Archive', 'Unarchived']</code> <p>Desired archival status.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.GuideFullResponse","title":"<code>GuideFullResponse</code>","text":"<p>               Bases: <code>GuideResponse</code></p> <p>Guide response including author usernames.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.GuideResponse","title":"<code>GuideResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Represents a guide entry for a map.</p> <p>Attributes:</p> Name Type Description <code>url</code> <code>GuideURL</code> <p>URL of the guide content.</p> <code>user_id</code> <code>int</code> <p>Identifier of the guide author.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.LinkMapsCreateRequest","title":"<code>LinkMapsCreateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for linking an unofficial map to an official one.</p> <p>Attributes:</p> Name Type Description <code>official_code</code> <code>OverwatchCode</code> <p>Workshop code of the official map.</p> <code>unofficial_code</code> <code>OverwatchCode</code> <p>Workshop code of the unofficial map.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapCompletionStatisticsResponse","title":"<code>MapCompletionStatisticsResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Aggregate statistics for map completion times.</p> <p>Attributes:</p> Name Type Description <code>min</code> <code>float | None</code> <p>Minimum completion time.</p> <code>max</code> <code>float | None</code> <p>Maximum completion time.</p> <code>avg</code> <code>float | None</code> <p>Average completion time.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapCountsResponse","title":"<code>MapCountsResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Count of maps grouped by map name.</p> <p>Attributes:</p> Name Type Description <code>map_name</code> <code>OverwatchMap</code> <p>Overwatch map name.</p> <code>amount</code> <code>int</code> <p>Number of maps recorded.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapCreateRequest","title":"<code>MapCreateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Payload for creating a new map entry.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>map_name</code> <code>OverwatchMap</code> <p>Overwatch map name.</p> <code>category</code> <code>MapCategory</code> <p>Category describing the map type.</p> <code>creators</code> <code>Annotated[list[Creator], Meta(max_length=3)]</code> <p>List of map creators.</p> <code>checkpoints</code> <code>Annotated[int, Meta(gt=0)]</code> <p>Number of checkpoints in the map.</p> <code>difficulty</code> <code>DifficultyAll</code> <p>Difficulty rating for the map.</p> <code>official</code> <code>bool</code> <p>Whether the map is official.</p> <code>hidden</code> <code>bool</code> <p>Whether the map should be hidden from listings.</p> <code>playtesting</code> <code>PlaytestStatus</code> <p>Current playtest status.</p> <code>archived</code> <code>bool</code> <p>Whether the map is archived.</p> <code>mechanics</code> <code>list[Mechanics]</code> <p>Mechanics required for the map.</p> <code>restrictions</code> <code>list[Restrictions]</code> <p>Restrictions applied to the map.</p> <code>description</code> <code>str | None</code> <p>Optional map description.</p> <code>medals</code> <code>MedalsResponse | None</code> <p>Medal thresholds for the map.</p> <code>guide_url</code> <code>GuideURL | None</code> <p>URL to a primary guide.</p> <code>title</code> <code>str | None</code> <p>Optional display title for the map.</p> <code>custom_banner</code> <code>str | None</code> <p>Custom banner asset name.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapCreateRequest.primary_creator_id","title":"<code>primary_creator_id</code>  <code>property</code>","text":"<p>Get the primary creator.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapCreationJobResponse","title":"<code>MapCreationJobResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Job response for map creation requests.</p> <p>Attributes:</p> Name Type Description <code>job_status</code> <code>JobStatusResponse | None</code> <p>Status of the asynchronous map creation job.</p> <code>data</code> <code>MapResponse</code> <p>Map details produced by the creation process.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapEditCreateRequest","title":"<code>MapEditCreateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for creating a map edit request.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapEditCreateRequest.to_changes_dict","title":"<code>to_changes_dict()</code>","text":"<p>Convert to a dict of only the changed fields.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapEditCreatedEvent","title":"<code>MapEditCreatedEvent</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Event emitted when a map edit request is created.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapEditFieldChange","title":"<code>MapEditFieldChange</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Represents a single field change for display.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapEditResolveRequest","title":"<code>MapEditResolveRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request to resolve (accept/reject) an edit request.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapEditResolvedEvent","title":"<code>MapEditResolvedEvent</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Event emitted when a map edit request is resolved.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapEditResponse","title":"<code>MapEditResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Full map edit request response.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapEditSetMessageIdRequest","title":"<code>MapEditSetMessageIdRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request to set the verification queue message ID.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapEditSubmissionResponse","title":"<code>MapEditSubmissionResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Response when viewing an edit request for the queue.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapMasteryCreateRequest","title":"<code>MapMasteryCreateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for recording map mastery progress.</p> <p>Attributes:</p> Name Type Description <code>user_id</code> <code>int</code> <p>Identifier of the user earning mastery.</p> <code>map_name</code> <code>OverwatchMap</code> <p>Name of the Overwatch map.</p> <code>level</code> <code>str</code> <p>Mastery level achieved.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapMasteryCreateResponse","title":"<code>MapMasteryCreateResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Response returned after creating or updating mastery progress.</p> <p>Attributes:</p> Name Type Description <code>map_name</code> <code>OverwatchMap</code> <p>Name of the Overwatch map.</p> <code>medal</code> <code>str</code> <p>Medal earned for the mastery level.</p> <code>operation_status</code> <code>Literal['inserted', 'updated']</code> <p>Whether the record was inserted or updated.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapMasteryResponse","title":"<code>MapMasteryResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Aggregated mastery progress for a map.</p> <p>Attributes:</p> Name Type Description <code>map_name</code> <code>OverwatchMap</code> <p>Name of the Overwatch map.</p> <code>amount</code> <code>int</code> <p>Number of mastery completions.</p> <code>level</code> <code>str | None</code> <p>Computed mastery level name.</p> <code>icon_url</code> <code>str | None</code> <p>Asset URL for the mastery icon.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapMasteryResponse.__post_init__","title":"<code>__post_init__()</code>","text":"<p>Post init.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapPartialResponse","title":"<code>MapPartialResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Lightweight map response used for playtest listings.</p> <p>Attributes:</p> Name Type Description <code>map_id</code> <code>int</code> <p>Identifier of the map.</p> <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>difficulty</code> <code>DifficultyAll</code> <p>Difficulty rating for the map.</p> <code>creator_name</code> <code>str</code> <p>Primary creator name.</p> <code>map_name</code> <code>OverwatchMap</code> <p>Overwatch map name.</p> <code>checkpoints</code> <code>int</code> <p>Number of checkpoints in the map.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapPartialResponse.thread_name","title":"<code>thread_name</code>  <code>property</code>","text":"<p>Return the thread name.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapPatchRequest","title":"<code>MapPatchRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Partial update payload for map entries.</p> <p>Attributes mirror :class:<code>MapCreateRequest</code> but are optional for patching.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapPerDifficultyStatisticsResponse","title":"<code>MapPerDifficultyStatisticsResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Statistics grouped by difficulty level.</p> <p>Attributes:</p> Name Type Description <code>difficulty</code> <code>DifficultyTop</code> <p>Difficulty tier represented.</p> <code>amount</code> <code>int</code> <p>Number of maps in the tier.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapPlaytestResponse","title":"<code>MapPlaytestResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Playtest metadata associated with a map.</p> <p>Attributes:</p> Name Type Description <code>thread_id</code> <code>int</code> <p>Discord thread for the playtest discussion.</p> <code>vote_average</code> <code>float | None</code> <p>Average difficulty vote.</p> <code>vote_count</code> <code>int | None</code> <p>Number of votes cast.</p> <code>voters</code> <code>list[int] | None</code> <p>Identifiers of voters.</p> <code>verification_id</code> <code>int | None</code> <p>Verification entry for the playtest.</p> <code>initial_difficulty</code> <code>float</code> <p>Initial difficulty estimate.</p> <code>completed</code> <code>bool</code> <p>Whether the playtest is complete.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapResponse","title":"<code>MapResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Full map representation returned by API endpoints.</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>int</code> <p>Database identifier for the map.</p> <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>map_name</code> <code>OverwatchMap</code> <p>Overwatch map name.</p> <code>category</code> <code>MapCategory</code> <p>Category describing the map type.</p> <code>creators</code> <code>list[CreatorFull]</code> <p>Full creator details.</p> <code>checkpoints</code> <code>Annotated[int, Meta(gt=0)]</code> <p>Number of checkpoints in the map.</p> <code>difficulty</code> <code>DifficultyAll</code> <p>Difficulty rating for the map.</p> <code>official</code> <code>bool</code> <p>Whether the map is official.</p> <code>playtesting</code> <code>PlaytestStatus</code> <p>Current playtest status.</p> <code>archived</code> <code>bool</code> <p>Whether the map is archived.</p> <code>hidden</code> <code>bool</code> <p>Whether the map is hidden from listings.</p> <code>created_at</code> <code>datetime</code> <p>Timestamp when the map was created.</p> <code>updated_at</code> <code>datetime</code> <p>Timestamp when the map was last updated.</p> <code>ratings</code> <code>float | None</code> <p>Average community rating.</p> <code>playtest</code> <code>MapPlaytestResponse | None</code> <p>Playtest metadata for the map.</p> <code>guides</code> <code>list[GuideURL] | None</code> <p>List of guide URLs.</p> <code>raw_difficulty</code> <code>Annotated[float, Meta(ge=0, le=10)] | None</code> <p>Raw numerical difficulty score.</p> <code>mechanics</code> <code>list[Mechanics]</code> <p>Mechanics required for the map.</p> <code>restrictions</code> <code>list[Restrictions]</code> <p>Restrictions applied to the map.</p> <code>description</code> <code>str | None</code> <p>Optional map description.</p> <code>medals</code> <code>MedalsResponse | None</code> <p>Medal thresholds for the map.</p> <code>title</code> <code>str | None</code> <p>Optional display title for the map.</p> <code>map_banner</code> <code>str | None</code> <p>Banner asset URL.</p> <code>time</code> <code>float | None</code> <p>Best recorded time for the map.</p> <code>total_results</code> <code>int | None</code> <p>Total results when returned in paginated queries.</p> <code>linked_code</code> <code>OverwatchCode | None</code> <p>Workshop code linked to this map.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapResponse.primary_creator_id","title":"<code>primary_creator_id</code>  <code>property</code>","text":"<p>Get the primary creator.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapResponse.primary_creator_name","title":"<code>primary_creator_name</code>  <code>property</code>","text":"<p>Get the primary creator.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MapResponse.__post_init__","title":"<code>__post_init__()</code>","text":"<p>Post init.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MedalsResponse","title":"<code>MedalsResponse</code>","text":"<p>               Bases: <code>Struct</code></p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.MedalsResponse.__post_init__","title":"<code>__post_init__()</code>","text":"<p>Validate medals.</p> <p>All medals must be present and be in order.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PendingMapEditResponse","title":"<code>PendingMapEditResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Lightweight response for pending edits list.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestApproveRequest","title":"<code>PlaytestApproveRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for approving a playtest.</p> <p>Attributes:</p> Name Type Description <code>verifier_id</code> <code>int</code> <p>Identifier of the verifier approving the playtest.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestApprovedEvent","title":"<code>PlaytestApprovedEvent</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Event emitted when a playtest is approved.</p> <p>Attributes:</p> Name Type Description <code>verifier_id</code> <code>int</code> <p>Identifier of the verifier approving the playtest.</p> <code>difficulty</code> <code>DifficultyAll</code> <p>Final difficulty rating.</p> <code>thread_id</code> <code>int</code> <p>Discord thread identifier for the playtest.</p> <code>primary_creator_id</code> <code>int</code> <p>Identifier of the primary creator for the map.</p> <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestCreatePartialRequest","title":"<code>PlaytestCreatePartialRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Partial playtest creation payload when creating alongside a map.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>initial_difficulty</code> <code>DifficultyAll</code> <p>Initial difficulty estimate.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestCreateRequest","title":"<code>PlaytestCreateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for creating a playtest entry.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>thread_id</code> <code>int</code> <p>Discord thread identifier.</p> <code>initial_difficulty</code> <code>DifficultyAll</code> <p>Initial difficulty estimate.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestCreatedEvent","title":"<code>PlaytestCreatedEvent</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Event emitted when a playtest is created.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>playtest_id</code> <code>int</code> <p>Identifier of the playtest.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestForceAcceptRequest","title":"<code>PlaytestForceAcceptRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request to force-accept a playtest with a given difficulty.</p> <p>Attributes:</p> Name Type Description <code>difficulty</code> <code>DifficultyAll</code> <p>Difficulty rating to assign.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestForceDeniedEvent","title":"<code>PlaytestForceDeniedEvent</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Event emitted when a playtest is force-denied.</p> <p>Attributes:</p> Name Type Description <code>verifier_id</code> <code>int</code> <p>Identifier of the verifier denying the playtest.</p> <code>reason</code> <code>str</code> <p>Explanation for the denial.</p> <code>thread_id</code> <code>int</code> <p>Discord thread identifier for the playtest.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestForceDenyRequest","title":"<code>PlaytestForceDenyRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request to force-deny a playtest.</p> <p>Attributes:</p> Name Type Description <code>verifier_id</code> <code>int</code> <p>Identifier of the verifier denying the playtest.</p> <code>reason</code> <code>str</code> <p>Explanation for the denial.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestPatchRequest","title":"<code>PlaytestPatchRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Partial update payload for playtests.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestResetEvent","title":"<code>PlaytestResetEvent</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Event emitted when a playtest is reset.</p> <p>Attributes:</p> Name Type Description <code>verifier_id</code> <code>int</code> <p>Identifier of the verifier performing the reset.</p> <code>reason</code> <code>str</code> <p>Explanation for the reset.</p> <code>remove_votes</code> <code>bool</code> <p>Whether votes were removed.</p> <code>remove_completions</code> <code>bool</code> <p>Whether completions were removed.</p> <code>thread_id</code> <code>int</code> <p>Discord thread identifier for the playtest.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestResetRequest","title":"<code>PlaytestResetRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for resetting a playtest.</p> <p>Attributes:</p> Name Type Description <code>verifier_id</code> <code>int</code> <p>Identifier of the verifier performing the reset.</p> <code>reason</code> <code>str</code> <p>Explanation for the reset.</p> <code>remove_votes</code> <code>bool</code> <p>Whether to delete existing votes.</p> <code>remove_completions</code> <code>bool</code> <p>Whether to delete associated completions.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestResponse","title":"<code>PlaytestResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Playtest entry with status metadata.</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>int</code> <p>Identifier of the playtest.</p> <code>thread_id</code> <code>int | None</code> <p>Discord thread identifier for discussion.</p> <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>verification_id</code> <code>int | None</code> <p>Verification entry related to the playtest.</p> <code>initial_difficulty</code> <code>float</code> <p>Initial difficulty estimate.</p> <code>created_at</code> <code>datetime</code> <p>When the playtest was created.</p> <code>updated_at</code> <code>datetime</code> <p>When the playtest was last updated.</p> <code>completed</code> <code>bool</code> <p>Whether the playtest is complete.</p> <code>thread_creation_status</code> <code>Literal['pending', 'processing', 'success', 'failed'] | None</code> <p>Status of thread creation automation.</p> <code>thread_creation_failure_reason</code> <code>str | None</code> <p>Reason thread creation failed, if any.</p> <code>thread_creation_last_attempt_at</code> <code>datetime | None</code> <p>Timestamp of the last thread creation attempt.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestThreadAssociateRequest","title":"<code>PlaytestThreadAssociateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Associates an existing playtest with a Discord thread.</p> <p>Attributes:</p> Name Type Description <code>playtest_id</code> <code>int</code> <p>Identifier of the playtest.</p> <code>thread_id</code> <code>int</code> <p>Discord thread identifier.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestVote","title":"<code>PlaytestVote</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Difficulty vote value for a playtest.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestVoteCastEvent","title":"<code>PlaytestVoteCastEvent</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Event emitted when a playtest vote is cast.</p> <p>Attributes:</p> Name Type Description <code>voter_id</code> <code>int</code> <p>Identifier of the voter.</p> <code>difficulty_value</code> <code>float</code> <p>Difficulty vote value.</p> <code>thread_id</code> <code>int</code> <p>Discord thread identifier for the playtest.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestVoteCastRequest","title":"<code>PlaytestVoteCastRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Payload for casting a playtest difficulty vote.</p> <p>Attributes:</p> Name Type Description <code>voter_id</code> <code>int</code> <p>Identifier of the voter.</p> <code>difficulty_value</code> <code>float</code> <p>Difficulty vote value.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestVoteRemovedEvent","title":"<code>PlaytestVoteRemovedEvent</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Event emitted when a playtest vote is removed.</p> <p>Attributes:</p> Name Type Description <code>voter_id</code> <code>int</code> <p>Identifier of the voter whose vote is removed.</p> <code>thread_id</code> <code>int</code> <p>Discord thread identifier for the playtest.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestVoteRemovedRequest","title":"<code>PlaytestVoteRemovedRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for removing a playtest vote.</p> <p>Attributes:</p> Name Type Description <code>voter_id</code> <code>int</code> <p>Identifier of the voter whose vote is removed.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestVoteWithUser","title":"<code>PlaytestVoteWithUser</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Difficulty vote paired with user information.</p> <p>Attributes:</p> Name Type Description <code>user_id</code> <code>int</code> <p>Identifier of the voter.</p> <code>name</code> <code>str</code> <p>Display name of the voter.</p> <code>difficulty</code> <code>float</code> <p>Difficulty value submitted.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PlaytestVotesResponse","title":"<code>PlaytestVotesResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Collection of playtest votes with aggregates.</p> <p>Attributes:</p> Name Type Description <code>votes</code> <code>list[PlaytestVoteWithUser]</code> <p>Individual votes with user context.</p> <code>average</code> <code>float | None</code> <p>Average difficulty vote.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.PopularMapsStatisticsResponse","title":"<code>PopularMapsStatisticsResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Metrics summarizing popular maps.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>completions</code> <code>int</code> <p>Number of completions recorded.</p> <code>quality</code> <code>float</code> <p>Average quality score.</p> <code>difficulty</code> <code>DifficultyTop</code> <p>Difficulty rating for the map.</p> <code>ranking</code> <code>int</code> <p>Popularity ranking position.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.QualityValueRequest","title":"<code>QualityValueRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for submitting a quality value.</p> <p>Attributes:</p> Name Type Description <code>value</code> <code>Annotated[int, Meta(ge=1, le=6)]</code> <p>Quality score between 1 and 6.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.SendToPlaytestRequest","title":"<code>SendToPlaytestRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for initiating a playtest.</p> <p>Attributes:</p> Name Type Description <code>initial_difficulty</code> <code>DifficultyAll</code> <p>Initial difficulty estimate for the playtest.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.TopCreatorsResponse","title":"<code>TopCreatorsResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Summary of top-performing creators.</p> <p>Attributes:</p> Name Type Description <code>map_count</code> <code>int</code> <p>Number of maps created.</p> <code>name</code> <code>str</code> <p>Creator name.</p> <code>average_quality</code> <code>float</code> <p>Average quality score across maps.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.TrendingMapResponse","title":"<code>TrendingMapResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Trending map metrics used for surfacing content.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>map_name</code> <code>OverwatchMap</code> <p>Overwatch map name.</p> <code>clicks</code> <code>int</code> <p>Number of clicks on the map.</p> <code>completions</code> <code>int</code> <p>Number of completions recorded.</p> <code>upvotes</code> <code>int</code> <p>Number of upvotes received.</p> <code>momentum</code> <code>float</code> <p>Momentum score for the map.</p> <code>trend_score</code> <code>float</code> <p>Aggregate trend score.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.UnlinkMapsCreateRequest","title":"<code>UnlinkMapsCreateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for unlinking a map pair.</p> <p>Attributes:</p> Name Type Description <code>official_code</code> <code>OverwatchCode</code> <p>Workshop code of the official map.</p> <code>unofficial_code</code> <code>OverwatchCode</code> <p>Workshop code of the unofficial map.</p> <code>reason</code> <code>str</code> <p>Explanation for unlinking the maps.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.XPMultiplierRequest","title":"<code>XPMultiplierRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for setting an XP multiplier.</p> <p>Attributes:</p> Name Type Description <code>value</code> <code>Annotated[float, Meta(ge=1, le=10)]</code> <p>Multiplier value between 1 and 10.</p>"},{"location":"sdk/reference/maps/#genjishimada_sdk.maps.get_map_banner","title":"<code>get_map_banner(map_name)</code>","text":"<p>Get the applicable map banner.</p>"},{"location":"sdk/reference/newsfeed/","title":"Newsfeed","text":""},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed","title":"<code>genjishimada_sdk.newsfeed</code>","text":""},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedAnnouncement","title":"<code>NewsfeedAnnouncement</code>","text":"<p>               Bases: <code>_TaggedPayload</code></p> <p>Newsfeed entry for general announcements.</p> <p>Attributes:</p> Name Type Description <code>title</code> <code>str</code> <p>Announcement title.</p> <code>content</code> <code>str</code> <p>Body content of the announcement.</p> <code>url</code> <code>str | None</code> <p>Optional link for more details.</p> <code>banner_url</code> <code>GuideURL | None</code> <p>Optional banner image URL.</p> <code>thumbnail_url</code> <code>GuideURL | None</code> <p>Optional thumbnail image URL.</p> <code>from_discord</code> <code>bool</code> <p>Whether the announcement originated from Discord.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedArchive","title":"<code>NewsfeedArchive</code>","text":"<p>               Bases: <code>_TaggedPayload</code></p> <p>Newsfeed entry for archiving a map.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>map_name</code> <code>OverwatchMap</code> <p>Name of the Overwatch map.</p> <code>creators</code> <code>list[str]</code> <p>List of creator names.</p> <code>difficulty</code> <code>DifficultyAll</code> <p>Difficulty rating for the map.</p> <code>reason</code> <code>str</code> <p>Explanation for the archive action.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedBulkArchive","title":"<code>NewsfeedBulkArchive</code>","text":"<p>               Bases: <code>_TaggedPayload</code></p> <p>Newsfeed entry for bulk archiving multiple maps.</p> <p>Attributes:</p> Name Type Description <code>codes</code> <code>list[OverwatchCode]</code> <p>Workshop codes for the affected maps.</p> <code>reason</code> <code>str</code> <p>Explanation for the bulk archive action.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedBulkUnarchive","title":"<code>NewsfeedBulkUnarchive</code>","text":"<p>               Bases: <code>_TaggedPayload</code></p> <p>Newsfeed entry for restoring multiple maps.</p> <p>Attributes:</p> Name Type Description <code>codes</code> <code>list[OverwatchCode]</code> <p>Workshop codes for the affected maps.</p> <code>reason</code> <code>str</code> <p>Explanation for the bulk unarchive action.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedDispatchEvent","title":"<code>NewsfeedDispatchEvent</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Event dispatched when a newsfeed entry should be delivered.</p> <p>Attributes:</p> Name Type Description <code>newsfeed_id</code> <code>int</code> <p>Identifier of the newsfeed entry to dispatch.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedEvent","title":"<code>NewsfeedEvent</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Top-level newsfeed event record.</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>int | None</code> <p>Identifier of the newsfeed entry.</p> <code>timestamp</code> <code>datetime</code> <p>When the event occurred.</p> <code>payload</code> <code>NewsfeedPayload</code> <p>Typed payload for the event.</p> <code>event_type</code> <code>NewsfeedEventType | None</code> <p>Optional explicit event type override.</p> <code>total_results</code> <code>int | None</code> <p>Total items for paginated feeds.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedFieldChange","title":"<code>NewsfeedFieldChange</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Represents a field difference for map edit newsfeed items.</p> <p>Attributes:</p> Name Type Description <code>field</code> <code>str</code> <p>Name of the field that changed.</p> <code>old</code> <code>NewsfeedScalar</code> <p>Previous value.</p> <code>new</code> <code>NewsfeedScalar</code> <p>Updated value.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedGuide","title":"<code>NewsfeedGuide</code>","text":"<p>               Bases: <code>_TaggedPayload</code></p> <p>Newsfeed entry announcing a new guide for a map.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>guide_url</code> <code>GuideURL</code> <p>URL of the newly published guide.</p> <code>name</code> <code>str</code> <p>Name of the guide creator.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedLegacyRecord","title":"<code>NewsfeedLegacyRecord</code>","text":"<p>               Bases: <code>_TaggedPayload</code></p> <p>Newsfeed entry for legacy record adjustments.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>affected_count</code> <code>int</code> <p>Number of records affected.</p> <code>reason</code> <code>str</code> <p>Explanation for the legacy record change.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedLinkedMap","title":"<code>NewsfeedLinkedMap</code>","text":"<p>               Bases: <code>_TaggedPayload</code></p> <p>Newsfeed entry for linking an unofficial map to an official one.</p> <p>Attributes:</p> Name Type Description <code>official_code</code> <code>OverwatchCode</code> <p>Code for the official map.</p> <code>unofficial_code</code> <code>OverwatchCode</code> <p>Code for the unofficial map.</p> <code>playtest_id</code> <code>int | None</code> <p>Optional playtest identifier related to the link.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedMapEdit","title":"<code>NewsfeedMapEdit</code>","text":"<p>               Bases: <code>_TaggedPayload</code></p> <p>Newsfeed entry describing edits made to a map.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>changes</code> <code>list[NewsfeedFieldChange]</code> <p>List of field-level changes.</p> <code>reason</code> <code>str</code> <p>Explanation for the edits.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedNewMap","title":"<code>NewsfeedNewMap</code>","text":"<p>               Bases: <code>_TaggedPayload</code></p> <p>Newsfeed entry for publishing a new map.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the new map.</p> <code>map_name</code> <code>OverwatchMap</code> <p>Name of the Overwatch map.</p> <code>difficulty</code> <code>DifficultyAll</code> <p>Difficulty rating for the map.</p> <code>creators</code> <code>list[str]</code> <p>List of creator names.</p> <code>title</code> <code>str | None</code> <p>Optional display title for the map.</p> <code>banner_url</code> <code>str | None</code> <p>URL for the map banner.</p> <code>official</code> <code>bool</code> <p>Whether the map is official.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedNewMap.__post_init__","title":"<code>__post_init__()</code>","text":"<p>Set the map banner dynamically.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedRecord","title":"<code>NewsfeedRecord</code>","text":"<p>               Bases: <code>_TaggedPayload</code></p> <p>Newsfeed entry for a new completion record.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>map_name</code> <code>OverwatchMap</code> <p>Name of the Overwatch map.</p> <code>time</code> <code>float</code> <p>Completion time achieved.</p> <code>video</code> <code>GuideURL</code> <p>Video URL showcasing the run.</p> <code>rank_num</code> <code>int</code> <p>Leaderboard rank number.</p> <code>name</code> <code>str</code> <p>Player name for the run.</p> <code>medal</code> <code>MedalType | None</code> <p>Medal tier assigned.</p> <code>difficulty</code> <code>DifficultyAll</code> <p>Difficulty rating for the map.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedRole","title":"<code>NewsfeedRole</code>","text":"<p>               Bases: <code>_TaggedPayload</code></p> <p>Newsfeed entry for a role assignment change.</p> <p>Attributes:</p> Name Type Description <code>user_id</code> <code>int</code> <p>Identifier of the user receiving the role change.</p> <code>name</code> <code>str</code> <p>Name of the role.</p> <code>added</code> <code>list[str]</code> <p>List of permissions or scopes added.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedUnarchive","title":"<code>NewsfeedUnarchive</code>","text":"<p>               Bases: <code>_TaggedPayload</code></p> <p>Newsfeed entry for unarchiving a map.</p> <p>Attributes:</p> Name Type Description <code>code</code> <code>OverwatchCode</code> <p>Workshop code for the map.</p> <code>map_name</code> <code>OverwatchMap</code> <p>Name of the Overwatch map.</p> <code>creators</code> <code>list[str]</code> <p>List of creator names.</p> <code>difficulty</code> <code>DifficultyAll</code> <p>Difficulty rating for the map.</p> <code>reason</code> <code>str</code> <p>Explanation for restoring the map.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.NewsfeedUnlinkedMap","title":"<code>NewsfeedUnlinkedMap</code>","text":"<p>               Bases: <code>_TaggedPayload</code></p> <p>Newsfeed entry for unlinking maps.</p> <p>Attributes:</p> Name Type Description <code>official_code</code> <code>OverwatchCode</code> <p>Code for the official map.</p> <code>unofficial_code</code> <code>OverwatchCode</code> <p>Code for the unofficial map.</p> <code>reason</code> <code>str</code> <p>Explanation for unlinking.</p>"},{"location":"sdk/reference/newsfeed/#genjishimada_sdk.newsfeed.PublishNewsfeedJobResponse","title":"<code>PublishNewsfeedJobResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Job response after requesting newsfeed publication.</p> <p>Attributes:</p> Name Type Description <code>job_status</code> <code>JobStatusResponse</code> <p>Status of the publishing job.</p> <code>newsfeed_id</code> <code>int</code> <p>Identifier of the newsfeed entry being published.</p>"},{"location":"sdk/reference/notifications/","title":"Notifications","text":""},{"location":"sdk/reference/notifications/#genjishimada_sdk.notifications","title":"<code>genjishimada_sdk.notifications</code>","text":""},{"location":"sdk/reference/notifications/#genjishimada_sdk.notifications.NotificationChannel","title":"<code>NotificationChannel</code>","text":"<p>               Bases: <code>str</code>, <code>Enum</code></p> <p>Available notification delivery channels.</p>"},{"location":"sdk/reference/notifications/#genjishimada_sdk.notifications.NotificationCreateRequest","title":"<code>NotificationCreateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request to create a notification event.</p>"},{"location":"sdk/reference/notifications/#genjishimada_sdk.notifications.NotificationDeliveryEvent","title":"<code>NotificationDeliveryEvent</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Event published to RabbitMQ when a notification needs Discord delivery.</p> <p>Routing key: api.notification.delivery</p>"},{"location":"sdk/reference/notifications/#genjishimada_sdk.notifications.NotificationDeliveryResultRequest","title":"<code>NotificationDeliveryResultRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request to record delivery result from bot.</p>"},{"location":"sdk/reference/notifications/#genjishimada_sdk.notifications.NotificationEventResponse","title":"<code>NotificationEventResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Response for a notification event.</p>"},{"location":"sdk/reference/notifications/#genjishimada_sdk.notifications.NotificationEventType","title":"<code>NotificationEventType</code>","text":"<p>               Bases: <code>str</code>, <code>Enum</code></p> <p>Notification event types.</p>"},{"location":"sdk/reference/notifications/#genjishimada_sdk.notifications.NotificationPreference","title":"<code>NotificationPreference</code>","text":"<p>               Bases: <code>Struct</code></p> <p>User preference for a notification type and channel.</p>"},{"location":"sdk/reference/notifications/#genjishimada_sdk.notifications.NotificationPreferencesResponse","title":"<code>NotificationPreferencesResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>All preferences for a user for a single event type.</p>"},{"location":"sdk/reference/notifications/#genjishimada_sdk.notifications.NotificationUnreadCountResponse","title":"<code>NotificationUnreadCountResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Response for unread notification count.</p>"},{"location":"sdk/reference/notifications/#genjishimada_sdk.notifications.ShouldDeliverResponse","title":"<code>ShouldDeliverResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Response for should_deliver check.</p>"},{"location":"sdk/reference/users/","title":"Users","text":""},{"location":"sdk/reference/users/#genjishimada_sdk.users","title":"<code>genjishimada_sdk.users</code>","text":""},{"location":"sdk/reference/users/#genjishimada_sdk.users.CommunityLeaderboardResponse","title":"<code>CommunityLeaderboardResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Entry in the community leaderboard.</p> <p>Attributes:</p> Name Type Description <code>user_id</code> <code>int</code> <p>Identifier of the user.</p> <code>nickname</code> <code>str</code> <p>Display nickname for the leaderboard.</p> <code>xp_amount</code> <code>int</code> <p>Total XP accumulated.</p> <code>raw_tier</code> <code>int</code> <p>Raw tier value.</p> <code>normalized_tier</code> <code>int</code> <p>Normalized tier value.</p> <code>prestige_level</code> <code>int</code> <p>Prestige level achieved.</p> <code>tier_name</code> <code>str</code> <p>Name of the tier.</p> <code>wr_count</code> <code>int</code> <p>Number of world records.</p> <code>map_count</code> <code>int</code> <p>Number of maps created.</p> <code>playtest_count</code> <code>int</code> <p>Number of playtests performed.</p> <code>discord_tag</code> <code>str</code> <p>Discord tag for the user.</p> <code>skill_rank</code> <code>str</code> <p>Skill rank label.</p> <code>total_results</code> <code>int</code> <p>Total results in a paginated query.</p>"},{"location":"sdk/reference/users/#genjishimada_sdk.users.Creator","title":"<code>Creator</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Minimal creator details.</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>int</code> <p>Creator user identifier.</p> <code>is_primary</code> <code>bool</code> <p>Whether the creator is the primary author.</p>"},{"location":"sdk/reference/users/#genjishimada_sdk.users.CreatorFull","title":"<code>CreatorFull</code>","text":"<p>               Bases: <code>Creator</code></p> <p>Creator details including display name.</p>"},{"location":"sdk/reference/users/#genjishimada_sdk.users.Notification","title":"<code>Notification</code>","text":"<p>               Bases: <code>IntFlag</code></p> <p>Notification bitmask flags for user preferences.</p>"},{"location":"sdk/reference/users/#genjishimada_sdk.users.OverwatchUsernameItem","title":"<code>OverwatchUsernameItem</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Represents a single Overwatch username entry.</p> <p>Attributes:</p> Name Type Description <code>username</code> <code>str</code> <p>Overwatch username.</p> <code>is_primary</code> <code>bool</code> <p>Whether this username is the primary one.</p>"},{"location":"sdk/reference/users/#genjishimada_sdk.users.OverwatchUsernamesResponse","title":"<code>OverwatchUsernamesResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Response containing mapped Overwatch usernames for a user.</p> <p>Attributes:</p> Name Type Description <code>user_id</code> <code>int</code> <p>Identifier for the user.</p> <code>primary</code> <code>str | None</code> <p>Primary username.</p> <code>secondary</code> <code>str | None</code> <p>Secondary username.</p> <code>tertiary</code> <code>str | None</code> <p>Tertiary username.</p>"},{"location":"sdk/reference/users/#genjishimada_sdk.users.OverwatchUsernamesUpdateRequest","title":"<code>OverwatchUsernamesUpdateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Payload for updating Overwatch usernames.</p> <p>Attributes:</p> Name Type Description <code>usernames</code> <code>list[OverwatchUsernameItem]</code> <p>Collection of Overwatch usernames with primary marker.</p>"},{"location":"sdk/reference/users/#genjishimada_sdk.users.OverwatchUsernamesUpdateRequest.__post_init__","title":"<code>__post_init__()</code>","text":"<p>Post-initialization processing to enforce primary username constraints.</p>"},{"location":"sdk/reference/users/#genjishimada_sdk.users.RankDetailResponse","title":"<code>RankDetailResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Detailed rank breakdown for a user.</p> <p>Attributes:</p> Name Type Description <code>difficulty</code> <code>DifficultyTop</code> <p>Difficulty tier represented.</p> <code>completions</code> <code>int</code> <p>Number of completions.</p> <code>gold</code> <code>int</code> <p>Number of gold medals.</p> <code>silver</code> <code>int</code> <p>Number of silver medals.</p> <code>bronze</code> <code>int</code> <p>Number of bronze medals.</p> <code>rank_met</code> <code>bool</code> <p>Whether the rank criteria are met.</p> <code>gold_rank_met</code> <code>bool</code> <p>Whether gold rank criteria are met.</p> <code>silver_rank_met</code> <code>bool</code> <p>Whether silver rank criteria are met.</p> <code>bronze_rank_met</code> <code>bool</code> <p>Whether bronze rank criteria are met.</p>"},{"location":"sdk/reference/users/#genjishimada_sdk.users.SettingsUpdateRequest","title":"<code>SettingsUpdateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Update payload for user settings.</p> <p>Attributes:</p> Name Type Description <code>notifications</code> <code>list[NOTIFICATION_TYPES]</code> <p>List of notification preference names to enable.</p>"},{"location":"sdk/reference/users/#genjishimada_sdk.users.SettingsUpdateRequest.__post_init__","title":"<code>__post_init__()</code>","text":"<p>Post-initialization processing to validate notification names.</p>"},{"location":"sdk/reference/users/#genjishimada_sdk.users.SettingsUpdateRequest.to_bitmask","title":"<code>to_bitmask()</code>","text":"<p>Convert the list of notification names to a bitmask.</p>"},{"location":"sdk/reference/users/#genjishimada_sdk.users.UserCreateRequest","title":"<code>UserCreateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Payload for creating a user profile.</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>int</code> <p>Discord user identifier.</p> <code>global_name</code> <code>str</code> <p>Global display name.</p> <code>nickname</code> <code>str</code> <p>Server nickname.</p>"},{"location":"sdk/reference/users/#genjishimada_sdk.users.UserResponse","title":"<code>UserResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>User profile response.</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>int</code> <p>Discord user identifier.</p> <code>global_name</code> <code>str</code> <p>Global display name.</p> <code>nickname</code> <code>str</code> <p>Server nickname.</p> <code>overwatch_usernames</code> <code>list[str] | None</code> <p>Linked Overwatch usernames.</p> <code>coalesced_name</code> <code>str | None</code> <p>Combined display name for presentation.</p> <code>coins</code> <code>int</code> <p>Current coin balance.</p>"},{"location":"sdk/reference/users/#genjishimada_sdk.users.UserUpdateRequest","title":"<code>UserUpdateRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Payload for updating a user profile.</p> <p>Attributes:</p> Name Type Description <code>global_name</code> <code>str | UnsetType</code> <p>Updated global display name.</p> <code>nickname</code> <code>str | UnsetType</code> <p>Updated nickname.</p>"},{"location":"sdk/reference/xp/","title":"XP","text":""},{"location":"sdk/reference/xp/#genjishimada_sdk.xp","title":"<code>genjishimada_sdk.xp</code>","text":""},{"location":"sdk/reference/xp/#genjishimada_sdk.xp.PlayersPerSkillTierResponse","title":"<code>PlayersPerSkillTierResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Number of players per skill tier.</p> <p>Attributes:</p> Name Type Description <code>tier</code> <code>str</code> <p>Name of the skill tier.</p> <code>amount</code> <code>int</code> <p>Count of players in the tier.</p>"},{"location":"sdk/reference/xp/#genjishimada_sdk.xp.PlayersPerXPTierResponse","title":"<code>PlayersPerXPTierResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Number of players per XP tier.</p> <p>Attributes:</p> Name Type Description <code>tier</code> <code>str</code> <p>Name of the XP tier.</p> <code>amount</code> <code>int</code> <p>Count of players in the tier.</p>"},{"location":"sdk/reference/xp/#genjishimada_sdk.xp.TierChangeResponse","title":"<code>TierChangeResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Computed tier deltas between old and new XP.</p> <p>Attributes:</p> Name Type Description <code>old_xp</code> <code>int</code> <p>XP before the change.</p> <code>new_xp</code> <code>int</code> <p>XP after the change.</p> <code>old_main_tier_name</code> <code>str</code> <p>Main tier label before the change.</p> <code>new_main_tier_name</code> <code>str</code> <p>Main tier label after the change.</p> <code>old_sub_tier_name</code> <code>str</code> <p>Sub-tier label before the change.</p> <code>new_sub_tier_name</code> <code>str</code> <p>Sub-tier label after the change.</p> <code>old_prestige_level</code> <code>int</code> <p>Prestige level before the change.</p> <code>new_prestige_level</code> <code>int</code> <p>Prestige level after the change.</p> <code>rank_change_type</code> <code>str | None</code> <p>Description of the rank movement, if any.</p> <code>prestige_change</code> <code>bool</code> <p>Whether the prestige level changed.</p>"},{"location":"sdk/reference/xp/#genjishimada_sdk.xp.XpGrantEvent","title":"<code>XpGrantEvent</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Event emitted when XP is granted to a user.</p> <p>Attributes:</p> Name Type Description <code>user_id</code> <code>int</code> <p>Identifier of the user receiving XP.</p> <code>amount</code> <code>int</code> <p>Amount of XP granted.</p> <code>type</code> <code>XP_TYPES</code> <p>Category describing why XP is granted.</p> <code>previous_amount</code> <code>int</code> <p>XP total before the grant.</p> <code>new_amount</code> <code>int</code> <p>XP total after the grant.</p>"},{"location":"sdk/reference/xp/#genjishimada_sdk.xp.XpGrantRequest","title":"<code>XpGrantRequest</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Request payload for granting XP.</p> <p>Attributes:</p> Name Type Description <code>amount</code> <code>int</code> <p>Amount of XP to grant.</p> <code>type</code> <code>XP_TYPES</code> <p>Category describing why XP is granted.</p>"},{"location":"sdk/reference/xp/#genjishimada_sdk.xp.XpGrantResponse","title":"<code>XpGrantResponse</code>","text":"<p>               Bases: <code>Struct</code></p> <p>Return payload when XP is granted.</p> <p>Attributes:</p> Name Type Description <code>previous_amount</code> <code>int</code> <p>XP amount before the grant.</p> <code>new_amount</code> <code>int</code> <p>XP amount after the grant.</p>"},{"location":"services/","title":"Services Overview","text":"<p>This section documents the core services that make up the Genji Shimada platform.</p>"},{"location":"services/#services","title":"Services","text":"<ul> <li>Bot</li> <li>API</li> <li>Database</li> <li>RabbitMQ</li> <li>OCR</li> <li>Translate</li> </ul>"},{"location":"services/api/","title":"API Service","text":"<p>The Genji Shimada API is the primary backend service powering the Genji Parkour ecosystem. It exposes REST endpoints under <code>/api/v3</code> for maps, users, completions, playtests, ranking, lootboxes, and more.</p>"},{"location":"services/api/#what-the-api-does","title":"What the API does","text":"<ul> <li>Serves REST endpoints under <code>/api/v3</code>.</li> <li>Validates input using typed models from <code>genjishimada-sdk</code>.</li> <li>Acts as the authoritative interface to PostgreSQL.</li> <li>Publishes events to RabbitMQ (XP, playtests, completions, notifications).</li> <li>Powers the Discord bot and other internal tools.</li> </ul>"},{"location":"services/api/#technologies-used","title":"Technologies used","text":"<ul> <li>Litestar for async HTTP routing</li> <li>asyncpg for high-performance Postgres access</li> <li>aio-pika + RabbitMQ for async job publishing</li> <li>msgspec for fast JSON serialization and request validation</li> <li>Sentry for error tracking</li> <li>Docker for local and production deployment</li> </ul>"},{"location":"services/api/#code-organization-high-level","title":"Code organization (high-level)","text":"Area Purpose <code>apps/api/app.py</code> Creates and configures the Litestar application <code>apps/api/routes/</code> Controllers + routers for each domain feature <code>apps/api/di/</code> Dependency-injected service layer <code>apps/api/middleware/</code> API key authentication + guards <code>apps/api/utilities/</code> Shared helpers and exception wrappers"},{"location":"services/api/#dependencies-on-other-services","title":"Dependencies on other services","text":"<ul> <li>Database (Postgres) \u2014 persistent data store</li> <li>RabbitMQ \u2014 async job queue for XP, completions, rank updates, notifications</li> <li>OCR \u2014 used by completion submission flows</li> <li>Bot \u2014 consumes API events and publishes some back into the system</li> </ul>"},{"location":"services/api/#related-pages","title":"Related pages","text":"<ul> <li>API Overview</li> <li>Local Development</li> <li>Architecture</li> </ul>"},{"location":"services/bot/","title":"Bot Service","text":"<p>The Genji bot is a Discord application that interacts with players, moderators, and developers. It integrates with the REST API and RabbitMQ to deliver real-time updates, handle completions and playtests, and manage user notifications.</p>"},{"location":"services/bot/#what-the-bot-does","title":"What the bot does","text":"<ul> <li>Listens for events from RabbitMQ and processes them (newsfeed posts, completions, playtest updates, XP grants).</li> <li>Provides slash commands and context menus for players and moderators on Discord.</li> <li>Posts embeds to channels and threads when new maps, records, guides, or announcements are created.</li> <li>Handles playtest voting and updates rank cards in real time.</li> <li>Maintains user state by calling the API.</li> </ul>"},{"location":"services/bot/#technologies-used","title":"Technologies used","text":"Technology Purpose <code>discord.py</code> Asynchronous Discord bot framework. <code>aiohttp</code> HTTP client used by the API service. <code>aio-pika</code> RabbitMQ client library for consuming and publishing. <code>msgspec</code> Fast serialization of request and response models. <code>sentry_sdk</code> Error tracking and performance monitoring."},{"location":"services/bot/#how-it-is-started","title":"How it is started","text":"<p>The entry point in <code>apps/bot/main.py</code> configures Sentry and logging, then creates a <code>Genji</code> bot instance and starts it with the Discord token. A prefix of <code>?</code> is used in production and <code>!</code> otherwise. The <code>Genji</code> class loads extensions during <code>setup_hook</code> and schedules <code>rabbit.start()</code> to begin queue consumption.</p>"},{"location":"services/bot/#services-injected","title":"Services injected","text":"<p>Extensions attach services to the bot via an async <code>setup</code> function. The <code>Genji</code> class defines properties for each service (API, newsfeed, playtests, completions, XP, notifications, Rabbit, and thumbnail service) so they can be accessed from commands and other services.</p>"},{"location":"services/bot/#environment-variables","title":"Environment variables","text":"Variable Purpose <code>DISCORD_TOKEN</code> Bot token provided by Discord; required to start the bot. <code>APP_ENVIRONMENT</code> <code>production</code> or <code>development</code>; affects logging and prefixes. <code>RABBITMQ_USER</code> / <code>RABBITMQ_PASS</code> / <code>RABBITMQ_HOST</code> Credentials for connecting to RabbitMQ. <code>SENTRY_DSN</code> DSN for Sentry error tracking."},{"location":"services/bot/#related-pages","title":"Related pages","text":"<ul> <li>Bot Overview</li> <li>Newsfeed Pattern</li> <li>RabbitMQ Consumers</li> </ul>"},{"location":"services/database/","title":"Database Service","text":"<p>The PostgreSQL service provides the central data store for the Genji Shimada platform.</p>"},{"location":"services/database/#purpose","title":"Purpose","text":"<p>This Postgres service stores persistent state used by the API, bot, and other services. Without it, there would be no single source of truth for user data, map metadata, run results, or other records.</p>"},{"location":"services/database/#compose-configuration","title":"Compose configuration","text":"<p>The database is defined in:</p> <ul> <li><code>docker-compose.dev.yml</code> as <code>genjishimada-db-dev</code></li> <li><code>docker-compose.prod.yml</code> as <code>genjishimada-db</code></li> </ul>"},{"location":"services/database/#development","title":"Development","text":"<ul> <li>Uses the <code>postgres:17</code> image</li> <li>Exposes port <code>65432</code> on the host</li> <li>Includes health checks via <code>pg_isready</code></li> </ul>"},{"location":"services/database/#production","title":"Production","text":"<ul> <li>Uses the <code>postgres:17</code> image</li> <li>Exposes port <code>55432</code> on the host</li> <li>Includes health checks via <code>pg_isready</code></li> </ul>"},{"location":"services/database/#environment-variables","title":"Environment variables","text":"Variable Description <code>POSTGRES_USER</code> Username for the database <code>POSTGRES_PASSWORD</code> Password for the database <code>POSTGRES_DB</code> Name of the primary database"},{"location":"services/database/#local-development","title":"Local development","text":"<ol> <li>Create a <code>.env</code> file with <code>POSTGRES_USER</code>, <code>POSTGRES_PASSWORD</code>, and <code>POSTGRES_DB</code>.</li> <li>Start the service:    <pre><code>docker compose -f docker-compose.dev.yml up -d genjishimada-db-dev\n</code></pre></li> <li>Connect using:</li> <li>Host: <code>localhost</code></li> <li>Port: <code>65432</code></li> <li>User: value of <code>POSTGRES_USER</code></li> <li>Password: value of <code>POSTGRES_PASSWORD</code></li> <li>Database: value of <code>POSTGRES_DB</code></li> </ol>"},{"location":"services/ocr/","title":"OCR Service","text":"<p>The OCR service extracts player name, run time, and map code from Overwatch parkour screenshots. It is implemented in the <code>genjishimada-ocr</code> repository and is consumed by the API during completion submission flows.</p>"},{"location":"services/ocr/#purpose","title":"Purpose","text":"<p>The OCR service processes parkour screenshots and returns structured data including the player's name, run time (seconds), and map code. It also returns raw extracted text for debugging.</p>"},{"location":"services/ocr/#key-features","title":"Key features","text":"<ul> <li>Multi-language OCR with prewarmed models (English, Chinese, Korean, Japanese).</li> <li>Script-aware name selection to choose the most plausible player name.</li> <li>Robust time parsing with error correction for common OCR misreads.</li> <li>Flexible map code extraction using explicit and generic patterns.</li> </ul>"},{"location":"services/ocr/#api-endpoints","title":"API endpoints","text":"Method &amp; Path Description <code>GET /ping</code> Returns <code>{ \"ok\": true, \"models\": [...] }</code> and readiness info. <code>POST /extract</code> Accepts <code>{ \"image_b64\": \"data:image/png;base64,...\" }</code> and returns extracted data. <p>Interactive documentation is available at <code>/docs</code> (Swagger UI) and <code>/redoc</code> on the OCR service.</p>"},{"location":"services/ocr/#deployment-quickstart","title":"Deployment &amp; quickstart","text":"<p>The OCR service runs independently and is not deployed by this repo. See the <code>genjishimada-ocr</code> repository for Docker and local Python setup details.</p>"},{"location":"services/rabbitmq/","title":"RabbitMQ Service","text":"<p>RabbitMQ provides message brokering for asynchronous workflows. It enables decoupling between producers and consumers while enforcing delivery guarantees.</p>"},{"location":"services/rabbitmq/#responsibilities","title":"Responsibilities","text":"<ul> <li>Define exchanges, queues, and bindings that reflect business domains.</li> <li>Apply dead-lettering and retry policies for resilient processing.</li> <li>Monitor queue depth, consumer lag, and connection health.</li> </ul>"},{"location":"services/rabbitmq/#queue-naming","title":"Queue naming","text":"<p>Queues follow the pattern: <code>api.&lt;domain&gt;.&lt;action&gt;</code>.</p> <p>Examples:</p> <ul> <li><code>api.completion.submission</code></li> <li><code>api.notification.delivery</code></li> <li><code>api.map_edit.created</code></li> </ul>"},{"location":"services/rabbitmq/#access","title":"Access","text":"<p>RabbitMQ is not exposed directly in this repo. Production access is handled via your reverse proxy (e.g., Caddy). For local debugging, use container logs:</p> <pre><code>docker compose -f docker-compose.dev.yml logs -f genjishimada-rabbitmq-dev\n</code></pre>"},{"location":"services/translate/","title":"Translate Service","text":"<p>The translate service provides machine translation via LibreTranslate. It is implemented in the <code>genji-infra</code> repo and runs as the <code>libretranslate</code> container behind the reverse proxy at <code>translate.bkan0n.com</code>.</p>"},{"location":"services/translate/#purpose","title":"Purpose","text":"<p>LibreTranslate exposes an HTTP API for translating short text and localized strings used by internal tools.</p>"},{"location":"services/translate/#deployment-notes","title":"Deployment Notes","text":"<p>From <code>genji-infra</code>:</p> <ul> <li>Container: <code>libretranslate</code></li> <li>Port: <code>5000</code></li> <li>Web UI disabled (<code>LT_DISABLE_WEB_UI=true</code>)</li> <li>API keys enabled (<code>LT_API_KEYS=true</code>)</li> <li>Models auto-update (<code>LT_UPDATE_MODELS=true</code>)</li> </ul> <p>The reverse proxy routes <code>translate.bkan0n.com</code> -&gt; <code>libretranslate:5000</code>.</p>"},{"location":"services/translate/#configuration","title":"Configuration","text":"<p>LibreTranslate settings are configured via environment variables in <code>genji-infra/libretranslate/libretranslate.env</code>, including:</p> <ul> <li><code>LT_API_KEYS=true</code> (requires API keys)</li> <li><code>LT_REQ_LIMIT=0</code> (no rate limiting)</li> <li><code>LT_THREADS=12</code></li> <li><code>LT_FRONTEND_TIMEOUT=2000</code></li> </ul> <p>API keys are stored in <code>/app/db/api_keys.db</code> via the host volume.</p>"},{"location":"services/translate/#related-docs","title":"Related Docs","text":"<ul> <li>Reverse Proxy - Routing for translate</li> <li>Cloudflare - DNS entry for translate</li> </ul>"},{"location":"web/","title":"Website Overview","text":"<p>The Genji website code lives in https://github.com/bkan0n/genji.pk and serves the public site at <code>genji.pk</code> (with <code>dev.genji.pk</code> for development). This section documents how the Laravel app is structured, built, and deployed, plus how it connects to the rest of the Genji stack.</p>"},{"location":"web/#key-facts","title":"Key Facts","text":"<ul> <li>Laravel app served by Nginx Unit (<code>serversideup/php:8.3-unit</code>).</li> <li>Uses the same database as the bot and API, and relies on the Genji API for auth and session data.</li> <li>Frontend built with Vite and Tailwind, with per-page JS bundles.</li> <li>Integrates Discord OAuth, OCR, Translation API, Tenor GIFs, Sentry, and GitHub releases.</li> </ul>"},{"location":"web/#pages-in-this-section","title":"Pages In This Section","text":"<ul> <li>Repository Layout</li> <li>Runtime Container</li> <li>Deployment</li> <li>Frontend Build</li> <li>Backend Application</li> <li>Integrations</li> <li>Security And Sessions</li> <li>Localization And Translations</li> </ul>"},{"location":"web/backend/","title":"Backend Application","text":"<p>The backend is a Laravel app with route groups split between Blade pages and JSON API endpoints.</p>"},{"location":"web/backend/#web-routes","title":"Web Routes","text":"<p><code>routes/web.php</code> defines the public and authenticated pages: - Public pages: home, newsfeed, leaderboard, statistics, tutorials, search, convertor, game, infos. - Authenticated pages: rank card, submit, dashboard. - Moderator page: guarded by the Discord moderator middleware. - Email auth flows and Discord OAuth callbacks.</p>"},{"location":"web/backend/#api-routes","title":"API Routes","text":"<p><code>routes/api.php</code> groups endpoints by feature: - Community stats and leaderboards. - Maps, playtests, guides, and map edit requests. - Completions and rank cards. - Lootbox actions. - Newsfeed and translation endpoints. - Moderator utilities and cache controls. - Notifications and preferences. - Sentry tunnel endpoint (<code>/api/_/e</code>).</p>"},{"location":"web/backend/#controller-layout","title":"Controller Layout","text":"<p>Controllers are organized by domain: - <code>Community</code>, <code>Completions</code>, <code>Maps</code>, <code>Lootbox</code>, <code>Newsfeed</code>, <code>Users</code>, <code>Utilities</code>, <code>Notifications</code>, and <code>Mods</code>.</p>"},{"location":"web/backend/#middleware-and-session-behavior","title":"Middleware And Session Behavior","text":"<p>Key middleware: - <code>RememberTokenAuth</code> - Rehydrates sessions from a remember token cookie. - <code>RequireDiscordModerator</code> - Gates moderator routes based on Discord roles. - <code>DetectLanguage</code> - Sets locale based on query, cookie, or session. - <code>SentryUserContext</code> - Tags requests with user context.</p> <p>Sessions use the custom <code>api</code> driver (<code>config/session.php</code>), backed by <code>App\\Extensions\\ApiSessionHandler</code> and the Genji API. This keeps user sessions and moderation flags in sync with the platform services.</p>"},{"location":"web/deployment/","title":"Deployment","text":"<p>Deployments are handled by GitHub Actions using Docker contexts over SSH. There is one workflow for dev and one for prod.</p>"},{"location":"web/deployment/#dev-deployment-workflow","title":"Dev Deployment Workflow","text":"<p><code>/.github/workflows/dev-deploy.yml</code>:</p> <ul> <li>Triggers:<ul> <li>Manual <code>workflow_dispatch</code> (with a ref override).</li> <li>PR comment with <code>.deploy</code> using <code>github/branch-deploy</code>.</li> </ul> </li> <li>Uses a Docker context over SSH to the dev host.</li> <li>Runs <code>docker compose -f docker-compose.dev.yml up -d --build</code>.</li> </ul>"},{"location":"web/deployment/#prod-deployment-workflow","title":"Prod Deployment Workflow","text":"<p><code>/.github/workflows/prod-deploy.yml</code>:</p> <ul> <li>Triggers on <code>push</code> to <code>main</code> and manual dispatch.</li> <li>Uses a Docker context over SSH to the prod host.</li> <li>Runs <code>docker compose -f docker-compose.prod.yml up -d --build</code>.</li> </ul>"},{"location":"web/deployment/#compose-files","title":"Compose Files","text":"<p>Both compose files:</p> <ul> <li>Build the same Dockerfile.</li> <li>Inject the full environment set from GitHub secrets.</li> <li>Attach to the external <code>genji-network</code>.</li> </ul> <p>There is no database container defined here. The website uses the same database as the bot and API, and expects that database to be reachable on the shared network.</p>"},{"location":"web/deployment/#environment-variables","title":"Environment Variables","text":"<p>The workflows pass env vars for:</p> <ul> <li>Genji API access (<code>X_API_ROOT</code>, <code>X_API_KEY</code>, <code>X_API_VERIFY</code>).</li> <li>Discord OAuth + bot (<code>DISCORD_CLIENT_ID</code>, <code>DISCORD_CLIENT_SECRET</code>, <code>DISCORD_BOT_TOKEN</code>, <code>DISCORD_GUILD_ID</code>,   <code>DISCORD_MODERATOR_ROLE_IDS</code>).</li> <li>OCR + Translation API (<code>TRANSLATION_API_ROOT</code>, <code>TRANSLATION_API_KEY</code>, <code>TRANSLATION_API_VERIFY</code>).</li> <li>Sentry (backend + frontend).</li> <li>Session settings (<code>SESSION_SECURE_COOKIE</code>, <code>SESSION_DOMAIN</code>).</li> </ul>"},{"location":"web/frontend/","title":"Frontend Build","text":"<p>The frontend is built with Vite, Tailwind CSS v4, and page-specific bundles.</p>"},{"location":"web/frontend/#vite-inputs","title":"Vite Inputs","text":"<p><code>vite.config.js</code> defines the bundles: - Core: <code>resources/css/app.css</code>, <code>resources/js/app.js</code>. - Page bundles: <code>resources/js/pages/*.js</code> (index, leaderboard, newsfeed, statistics, tutorials, search, rank_card, convertor, lootbox, submit, game, moderator, dashboard, infos, prism).</p>"},{"location":"web/frontend/#tailwind-theme","title":"Tailwind Theme","text":"<p><code>tailwind.config.js</code>: - Dark mode via <code>class</code>. - Brand palette in <code>theme.extend.colors.brand</code>. - Custom <code>glow</code>/<code>soft</code> shadows and a <code>loading</code> animation.</p>"},{"location":"web/frontend/#app-bootstrap","title":"App Bootstrap","text":"<p><code>resources/js/app.js</code>: - Imports global CSS and UI modules (modals, notifications tray). - Initializes Sentry on the client, using Vite-provided DSN + environment. - Adds a CSRF header patch for <code>fetch()</code> on non-GET requests. - Lazy-loads Prism when the page needs it.</p>"},{"location":"web/frontend/#assets-and-views","title":"Assets And Views","text":"<ul> <li>Blade templates live under <code>resources/views/</code>.</li> <li>Page-specific JS runs alongside Blade views and API endpoints.</li> <li><code>public/build</code> is generated at build time and served by Unit with immutable cache headers.</li> </ul>"},{"location":"web/integrations/","title":"Integrations","text":"<p>This site relies on several external services configured in <code>config/services.php</code> and related config files.</p>"},{"location":"web/integrations/#genji-api","title":"Genji API","text":"<ul> <li>Config: <code>services.genji_api</code> (from <code>X_API_ROOT</code>, <code>X_API_KEY</code>, <code>X_API_VERIFY</code>).</li> <li>Used for user and session operations (login, registration, remember token, session I/O).</li> <li>See <code>App\\Services\\GenjiApiService</code> and <code>App\\Extensions\\ApiSessionHandler</code>.</li> </ul>"},{"location":"web/integrations/#discord-oauth-bot","title":"Discord OAuth + Bot","text":"<ul> <li>Socialite provider registered in <code>AppServiceProvider</code>.</li> <li>OAuth endpoints used for user sign-in.</li> <li>Bot token and guild info are used to hydrate avatars and moderator roles.</li> </ul>"},{"location":"web/integrations/#ocr-service","title":"OCR Service","text":"<ul> <li><code>services.ocr.base_url</code> resolves by environment.</li> <li><code>/api/ocr/extract</code> proxies OCR requests.</li> </ul>"},{"location":"web/integrations/#translation-service","title":"Translation Service","text":"<ul> <li><code>services.translation_api</code> provides translation endpoint and API key.</li> <li>Used by the newsfeed translation flow.</li> </ul>"},{"location":"web/integrations/#tenor-gifs","title":"Tenor GIFs","text":"<ul> <li><code>TENOR_API_KEY</code> enables GIF lookup in newsfeed.</li> </ul>"},{"location":"web/integrations/#github-releases","title":"GitHub Releases","text":"<ul> <li><code>App\\Services\\GitHubReleases</code> fetches releases for the Genji framework.</li> <li>Repo defaults to <code>tylovejoy/genji-framework</code> unless configured.</li> </ul>"},{"location":"web/integrations/#sentry","title":"Sentry","text":"<ul> <li>Backend Sentry configured in <code>config/sentry.php</code>.</li> <li>Frontend Sentry initialized in <code>resources/js/app.js</code>.</li> <li>Sentry tunnel endpoint exists at <code>/api/_/e</code> and validates the DSN.</li> </ul>"},{"location":"web/integrations/#cloudflare-integration","title":"Cloudflare Integration","text":"<ul> <li><code>config/laravelcloudflare.php</code> enables middleware for Cloudflare IPs.</li> <li><code>routes/web.php</code> includes <code>/api/my-ip</code> for debugging forwarded IPs.</li> </ul>"},{"location":"web/integrations/#cdn-helpers","title":"CDN Helpers","text":"<ul> <li><code>cdn_asset()</code> uses <code>config('app.cdn_url')</code> (default <code>https://cdn.genji.pk</code>).</li> </ul>"},{"location":"web/integrations/#optional-email-providers","title":"Optional Email Providers","text":"<p>Mailgun, Postmark, and SES are configured in <code>config/services.php</code>, but usage depends on environment setup.</p>"},{"location":"web/localization/","title":"Localization And Translations","text":"<p>The website ships with built-in localization support and a workflow for updating translation files.</p>"},{"location":"web/localization/#language-configuration","title":"Language Configuration","text":"<ul> <li><code>config/gp.php</code> defines available languages and a default (<code>en</code>).</li> <li>Each language entry includes display name, flag, and whether it is fully translated.</li> </ul>"},{"location":"web/localization/#translation-sources","title":"Translation Sources","text":"<ul> <li><code>resources/lang/</code> holds PHP translation files per locale.</li> <li><code>resources/translations/</code> contains JSON assets used by the client-side pages.</li> <li>The <code>DetectLanguage</code> middleware resolves locale based on <code>?lang=</code>, cookie, or session.</li> </ul>"},{"location":"web/localization/#client-side-translation-files","title":"Client-Side Translation Files","text":"<ul> <li>Pages like convertor and search read JSON from <code>public/translations/*</code>.</li> <li>The convertor page can compile translation JSON via <code>/api/compile</code>.</li> </ul>"},{"location":"web/localization/#moderator-cache-tools","title":"Moderator Cache Tools","text":"<ul> <li>Moderator UI includes controls for clearing translation caches.</li> <li>The API endpoint for cache clearing is <code>DELETE /api/mods/cache/translations</code>.</li> </ul>"},{"location":"web/repository-layout/","title":"Repository Layout","text":"<p>This repo follows a standard Laravel structure with a few custom additions for Genji.</p>"},{"location":"web/repository-layout/#top-level-structure","title":"Top-Level Structure","text":"<ul> <li><code>app/</code> - Application code.</li> <li><code>Http/Controllers</code> grouped by domain (Maps, Newsfeed, Lootbox, Mods, Users, Utilities).</li> <li><code>Http/Middleware</code> for auth, Discord moderation, locale detection, Sentry user context.</li> <li><code>Services</code> for Genji API and GitHub releases.</li> <li><code>Extensions/ApiSessionHandler</code> for API-backed sessions.</li> <li><code>Support</code> helpers and translation utilities.</li> <li><code>Providers</code> register services and middleware.</li> <li><code>routes/</code> - <code>web.php</code> pages and auth flows, <code>api.php</code> JSON endpoints, <code>console.php</code> for CLI hooks.</li> <li><code>resources/</code> - Blade views, JS, CSS, and language assets.</li> <li><code>public/</code> - Public assets and <code>public/build</code> output from Vite.</li> <li><code>config/</code> - App, services, CSP, sessions, Cloudflare middleware, Sentry, and custom settings.</li> <li><code>docker/</code> - Unit config and entrypoint.</li> <li><code>docker-compose.dev.yml</code> / <code>docker-compose.prod.yml</code> - Deployment entrypoints.</li> <li><code>Dockerfile</code> - Multi-stage build for frontend assets and PHP runtime.</li> <li><code>.github/workflows/</code> - Dev and prod deploy workflows.</li> </ul>"},{"location":"web/repository-layout/#important-files","title":"Important Files","text":"<ul> <li><code>Dockerfile</code> - Node build, Composer install, then Unit runtime image.</li> <li><code>docker/unit.json</code> - Unit routes, static caching, and PHP process settings.</li> <li><code>docker/entrypoint.sh</code> - Unit bootstrap and cache warming.</li> <li><code>vite.config.js</code> - Vite input bundles for each page.</li> <li><code>tailwind.config.js</code> - Theme, colors, and animation settings.</li> </ul>"},{"location":"web/runtime-container/","title":"Runtime Container","text":"<p>The container is built in three stages and runs on Nginx Unit.</p>"},{"location":"web/runtime-container/#multi-stage-build","title":"Multi-Stage Build","text":"<p>1) Node build - Uses <code>node:20-alpine</code>. - Runs <code>npm ci</code> and <code>npm run build</code> to generate <code>public/build</code>.</p> <p>2) Composer dependencies - Uses <code>composer:2</code> to install PHP deps without dev scripts.</p> <p>3) Runtime - Uses <code>serversideup/php:8.3-unit</code>. - Copies app code, <code>vendor/</code>, and <code>public/build</code>. - Configures opcache and memory limits. - Ensures <code>storage/</code> and <code>bootstrap/cache</code> permissions.</p>"},{"location":"web/runtime-container/#unit-configuration","title":"Unit Configuration","text":"<p><code>docker/unit.json</code>: - Listens on <code>*:8080</code>. - Serves static assets from <code>public/</code> with long-lived cache headers. - Falls back to <code>index.php</code> for dynamic routes. - Sets PHP process limits and upload size caps.</p>"},{"location":"web/runtime-container/#entrypoint-flow","title":"Entrypoint Flow","text":"<p><code>docker/entrypoint.sh</code>: - Fixes permissions for runtime write paths. - Starts Unit and waits for the control socket. - Loads Unit config via the control API. - Optionally warms caches (<code>package:discover</code>, <code>optimize</code>, <code>event:cache</code>, <code>route:cache</code>, <code>view:cache</code>).</p>"},{"location":"web/runtime-container/#healthcheck","title":"Healthcheck","text":"<p>The Dockerfile defines a healthcheck against <code>http://localhost:8080</code>.</p>"},{"location":"web/security-and-sessions/","title":"Security And Sessions","text":"<p>This app uses a mix of Laravel defaults and platform-specific session handling.</p>"},{"location":"web/security-and-sessions/#api-backed-sessions","title":"API-Backed Sessions","text":"<ul> <li><code>config/session.php</code> sets the driver to <code>api</code> and enables encryption.</li> <li><code>ApiSessionHandler</code> stores session data via the Genji API.</li> <li>Remember-token flows use <code>device_session_id</code> cookies to keep sessions consistent across devices.</li> </ul>"},{"location":"web/security-and-sessions/#auth-and-role-checks","title":"Auth And Role Checks","text":"<ul> <li>Discord moderator access is enforced in <code>RequireDiscordModerator</code>.</li> <li>Email users are still supported through the Genji API endpoints.</li> </ul>"},{"location":"web/security-and-sessions/#csrf","title":"CSRF","text":"<p><code>resources/js/app.js</code> patches <code>fetch()</code> to attach <code>X-CSRF-TOKEN</code> and <code>X-Requested-With</code> headers on non-GET requests.</p>"},{"location":"web/security-and-sessions/#csp-and-nonce","title":"CSP And Nonce","text":"<ul> <li><code>config/csp.php</code> defines a strict CSP and uses a nonce generator.</li> <li><code>AppServiceProvider</code> wires a CSP nonce into Vite via <code>Vite::useCspNonce()</code>.</li> </ul>"},{"location":"web/security-and-sessions/#sentry-tunnel","title":"Sentry Tunnel","text":"<ul> <li><code>/api/_/e</code> validates DSN headers and same-site origin before forwarding.</li> <li>Size limits are enforced to avoid oversized payloads.</li> </ul>"},{"location":"web/security-and-sessions/#cookies-and-domains","title":"Cookies And Domains","text":"<ul> <li>Session cookie domain and HTTPS requirements are controlled by <code>SESSION_DOMAIN</code> and <code>SESSION_SECURE_COOKIE</code>.</li> <li>SameSite is set to <code>lax</code> by default.</li> </ul>"}]}